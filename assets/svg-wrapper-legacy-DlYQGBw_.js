System.register(["./chakra-legacy-C795P1qx.js","./index-legacy-BKySo8Ci.js","./react-legacy-B9RkHKhm.js","./clipboard-legacy-CeWxt53z.js","./master-manager-legacy-CQYSLhcn.js","./misc-nodes-legacy-BUYqACfa.js"],(function(e,t){"use strict";var n,r,o,i,s,a,l,d,c,u,y,h,p,f,x,g,v,m,b,w,P,A,k,E,D,N,j,I,C,S,M,$,_,z,K,W,T,L,U,O,R,B,Y,F,X,V,q,Z;return{setters:[e=>{n=e.j},e=>{r=e.l,o=e.o,i=e.an,s=e.ao,a=e.ap,l=e.e,d=e.a,c=e.aq,u=e.ar,y=e.as,h=e.U,p=e.at,f=e.au,x=e.av,g=e.t,v=e.v,m=e.S,b=e.aw,w=e.n,P=e.m,A=e.p,k=e.r,E=e.E,D=e.w,N=e.y,j=e.V,I=e.ax,C=e.D,S=e.ay,M=e.a0,$=e.A,_=e.z,z=e.a7,K=e.ak,W=e.al},e=>{T=e.b},e=>{L=e.u,U=e.e,O=e.i},e=>{R=e.s,B=e.u,Y=e.f,F=e.F,X=e.l,V=e.b,q=e.c},e=>{Z=e.m}],execute:function(){const t=(e,t,n,r,o,i,s)=>{if(!("offsetFrom"in s)||!("offsetTo"in s))return;if(Number.isNaN(s.offsetFrom)||Number.isNaN(s.offsetTo))return;if(s.offsetFrom===s.offsetTo)return G(t,n,r,o,i)?{x1:n,y1:r,x2:o,y2:i,offset:s.offsetFrom}:void 0;const[a,l]=[s.offsetFrom,s.offsetTo];for(let d=0;d<Math.PI;d+=Math.PI/8)for(let e=d,s=0;s<2;s++,e+=Math.PI){const[s,c,u,y]=[Math.sin(d)*a,Math.cos(d)*a,Math.sin(e)*l,Math.cos(e)*l];if(G(t,n+s,r+c,o+u,i+y))return{x1:n+s,y1:r+c,x2:o+u,y2:i+y,offset:0}}},G=(e,t,n,o,i)=>!(t!==o&&n!==i||![r.Diagonal,r.Perpendicular].includes(e))||!(1!==Math.abs((i-n)/(o-t))||![r.Diagonal,r.RotatePerpendicular].includes(e)),H=(e,n)=>{if(!n.every((t=>e.hasEdge(t))))return;const i=n.map((n=>{var i,s,a;const[l,d]=e.extremities(n),c=e.getNodeAttributes(l),u=e.getNodeAttributes(d),y=e.getEdgeAttribute(n,"type"),h=null!==(i=e.getEdgeAttribute(n,y))&&void 0!==i?i:o[y].defaultAttrs,p=t(0,y,c.x,c.y,u.x,u.y,h);if(p){const{x1:e,y1:t,x2:n,y2:i,offset:s}=p;return o[r.Simple].generatePath(e,n,t,i,{offset:s})}return null!==(s=null===(a=o[y])||void 0===a?void 0:a.generatePath(c.x,u.x,c.y,u.y,h))&&void 0!==s?s:`M ${c.x} ${c.y} L ${u.x} ${u.y}`}));let s=`${i[0]} `;for(let t=1;t<n.length;t+=1)s+=i[t].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return s},J=e=>[...e.nodeEntries()].map((e=>e.node.startsWith("stn")?{id:e.node,type:"station",station:e.attributes}:{id:e.node,type:"misc-node",miscNode:e.attributes})),Q=e=>{const n={},a=[],l={},d=[];for(const i of e.edgeEntries()){const[e,s,c,u]=[i.sourceAttributes.x,i.sourceAttributes.y,i.targetAttributes.x,i.targetAttributes.y],y=t(i.edge,i.attributes.type,e,s,c,u,i.attributes[i.attributes.type]);if(y);else if(i.attributes.parallelIndex>=0){a.push(i);continue}if(""===i.attributes.reconcileId)if(y){const e=i.edge,t=i.attributes,{x1:s,y1:a,x2:l,y2:d,offset:c}=y;n[e]={id:e,attr:t,path:o[r.Simple].generatePath(s,l,a,d,{offset:c})}}else d.push(i);else{const e=i.attributes.reconcileId;e in l?l[e].push(i):l[e]=[i]}}const c=new Set;for(;a.length;){const t=a.pop();if(c.has(t.edge))continue;const{normal:r,parallel:o}=i(e,t);if(!o.length)continue;o.forEach((e=>c.add(e.edge))),d.push(...r);const l=s(o);for(const e of o){const t=e.edge;n[t]={id:e.edge,attr:e.attributes,path:l[t]}}}const{allReconciledLines:u,danglingLines:y}=((e,t)=>{const n=[],r=[];return Object.values(t).forEach((t=>{if(1===t.length)return void r.push(...t.map((e=>e.edge)));const o=e.getEdgeAttribute(t.at(0),"type");if(!t.every((t=>e.getEdgeAttribute(t,"type")===o)))return void r.push(...t.map((e=>e.edge)));const i=e.getEdgeAttribute(t.at(0),"style");if(!t.every((t=>e.getEdgeAttribute(t,"style")===i)))return void r.push(...t.map((e=>e.edge)));const s={},a=new Set,l=new Set,d=Object.fromEntries(t.map((t=>{var n,r;const[o,i]=e.extremities(t);return s[o]=(null!==(n=s[o])&&void 0!==n?n:0)+1,s[i]=(null!==(r=s[i])&&void 0!==r?r:0)+1,a.add(o),l.add(i),[o,[t.edge,i]]}))),c=Array.from(a).filter((e=>1===s[e])),u=Array.from(l).filter((e=>1===s[e]));if(1!==c.length||1!==u.length)return void r.push(...t.map((e=>e.edge)));const y=c[0],h=u[0];if(y===h)return void r.push(...t.map((e=>e.edge)));const p=[d[y][0]];let f=d[y][1];for(let e=1;e<t.length;e+=1){var x;const e=null===(x=d[f])||void 0===x?void 0:x.at(1);if(!e)return void r.push(...t.map((e=>e.edge)));p.push(d[f][0]),f=e}f===h&&p.length===t.length?n.push(p):r.push(...t.map((e=>e.edge)))})),{allReconciledLines:n,danglingLines:r}})(e,l);for(const t of u){const r=H(e,t);if(!r)continue;const o=t[0];n[o]={id:o,attr:e.getEdgeAttributes(o),path:r}}for(const t of y){const i=e.getEdgeAttributes(t),[s,a]=e.extremities(t),l=e.getNodeAttributes(s),d=e.getNodeAttributes(a);n[t]={id:t,attr:i,path:o[r.Simple].generatePath(l.x,d.x,l.y,d.y,o[r.Simple].defaultAttrs)}}for(const t of d){const e=t.edge,r=t.attributes.type,i=t.attributes,[s,a,l,d]=[t.sourceAttributes.x,t.sourceAttributes.y,t.targetAttributes.x,t.targetAttributes.y];n[e]=r in o?{id:e,attr:i,path:o[r].generatePath(s,l,a,d,i[r])}:{id:e,attr:i,path:`M ${s} ${a} L ${l} ${d}`}}return Object.values(n).map((e=>({id:e.id,type:"line",line:e})))},ee=e=>{const{id:t,x:r,y:o,handlePointerDown:i,handlePointerMove:s,handlePointerUp:a}=e,l=T.useCallback((e=>i(t,e)),[t,i]),d=T.useCallback((e=>s(t,e)),[t,s]),c=T.useCallback((e=>a(t,e)),[t,a]);return n.jsx("g",{id:t,transform:`translate(${r-6.4} ${o-6.4})scale(0.025)`,onPointerDown:l,onPointerMove:d,onPointerUp:c,style:{cursor:"move"},children:n.jsx("path",{id:`stn_core_${t}`,fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},te=e=>{const{id:t,path:r,handlePointerDown:o}=e,i=T.useCallback((e=>o(t,e)),[t,o]);return n.jsx("path",{id:t,d:r,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:i})},ne=e=>{const{elements:t,handlePointerDown:r,handlePointerMove:o,handlePointerUp:i,handleEdgePointerDown:s}=e,l=Object.fromEntries(Array.from({length:21},((e,t)=>[t-10,{pre:[],main:[],post:[]}])));for(const w of t)if("line"===w.type){var d,c,u,y;const e=w.line.attr.type,t=w.line.attr.style,r=w.line.attr[t],o=null===(d=a[t])||void 0===d?void 0:d.preComponent;o&&l[w.line.attr.zIndex].pre.push(n.jsx(o,{id:w.id,type:e,path:w.line.path,styleAttrs:r,newLine:!1,handlePointerDown:s},`${w.id}.pre`));const i=null!==(c=null===(u=a[t])||void 0===u?void 0:u.component)&&void 0!==c?c:te;l[w.line.attr.zIndex].main.push(n.jsx(i,{id:w.id,type:e,path:w.line.path,styleAttrs:r,newLine:!1,handlePointerDown:s},w.id));const h=null===(y=a[t])||void 0===y?void 0:y.postComponent;h&&l[w.line.attr.zIndex].post.push(n.jsx(h,{id:w.id,type:e,path:w.line.path,styleAttrs:r,newLine:!1,handlePointerDown:s},`${w.id}.post`))}else if("station"===w.type){var h,p,f,x;const e=w.station,t=e.type,s=null===(h=R[t])||void 0===h?void 0:h.preComponent;s&&l[w.station.zIndex].pre.push(n.jsx(s,{id:w.id,x:e.x,y:e.y,attrs:e,handlePointerDown:r,handlePointerMove:o,handlePointerUp:i},`${w.id}.pre`));const a=null!==(p=null===(f=R[t])||void 0===f?void 0:f.component)&&void 0!==p?p:ee;l[w.station.zIndex].main.push(n.jsx(a,{id:w.id,x:e.x,y:e.y,attrs:e,handlePointerDown:r,handlePointerMove:o,handlePointerUp:i},w.id));const d=null===(x=R[t])||void 0===x?void 0:x.postComponent;d&&l[w.station.zIndex].post.push(n.jsx(d,{id:w.id,x:e.x,y:e.y,attrs:e,handlePointerDown:r,handlePointerMove:o,handlePointerUp:i},`${w.id}.post`))}else if("misc-node"===w.type){var g,v,m,b;const e=w.miscNode,t=e.type,s=null===(g=Z[t])||void 0===g?void 0:g.preComponent;s&&l[w.miscNode.zIndex].pre.push(n.jsx(s,{id:w.id,x:e.x,y:e.y,attrs:e[t],handlePointerDown:r,handlePointerMove:o,handlePointerUp:i},`${w.id}.pre`));const a=null!==(v=null===(m=Z[t])||void 0===m?void 0:m.component)&&void 0!==v?v:ee;l[w.miscNode.zIndex].main.push(n.jsx(a,{id:w.id,x:e.x,y:e.y,attrs:e[t],handlePointerDown:r,handlePointerMove:o,handlePointerUp:i},w.id));const d=null===(b=Z[t])||void 0===b?void 0:b.postComponent;d&&l[w.miscNode.zIndex].post.push(n.jsx(d,{id:w.id,x:e.x,y:e.y,attrs:e[t],handlePointerDown:r,handlePointerMove:o,handlePointerUp:i},`${w.id}.post`))}return Array.from({length:21},((e,t)=>(t-10).toString())).map((e=>[...l[e].pre,...l[e].main,...l[e].post])).flat()},re=()=>{const e=l(),t=T.useRef(window.graph),{telemetry:{project:r},preference:{autoParallel:i}}=d((e=>e.app)),{svgViewBoxZoom:s,svgViewBoxMin:a}=d((e=>e.param)),{selected:C,refresh:{nodes:S,edges:M},mode:$,active:_,keepLastPath:z,theme:K}=d((e=>e.runtime)),[W,U]=T.useState({x:0,y:0}),[O,B]=T.useState({x:0,y:0}),Y=L(((t,n)=>{n.stopPropagation(),"select"===$&&e(c("free"));const r=n.currentTarget,{x:o,y:i}=u(n);r.setPointerCapture(n.pointerId),U({x:o,y:i}),e(y(t)),n.shiftKey?C.has(t)?e(p(t)):e(f(t)):C.has(t)||e(h(new Set([t])))})),F=L(((n,r)=>{const{x:o,y:i}=u(r);"free"===$&&_===n?(C.forEach((e=>{t.current.hasNode(e)&&t.current.updateNodeAttributes(e,(e=>({...e,x:x(e.x-(W.x-o)*s/100,r.altKey?1:5),y:x(e.y-(W.y-i)*s/100,r.altKey?1:5)})))})),e(g()),e(v())):$.startsWith("line")&&B({x:(W.x-o)*s/100,y:(W.y-i)*s/100})})),X=L(((n,s)=>{if($.startsWith("line")){z||e(c("free"));const n=[...Object.values(m),b.Virtual,b.Master],a=t.current.hasNode(_)&&n.includes(t.current.getNodeAttribute(_,"type"));["stn_core_","virtual_circle_"].forEach((e=>{var n;const l=null===(n=document.elementsFromPoint(s.clientX,s.clientY)[0].attributes)||void 0===n||null===(n=n.getNamedItem("id"))||void 0===n?void 0:n.value,d=null==l?void 0:l.startsWith(e);if(a&&d){const n=$.slice(5),s=`line_${w(10)}`,[a,d]=[_,l.slice(e.length)],c=i?P(t.current,n,a,d,"from"):-1;t.current.addDirectedEdgeWithKey(s,a,d,{visible:!0,zIndex:0,type:n,[n]:structuredClone(o[n].defaultAttrs),style:A.SingleColor,[A.SingleColor]:{color:K},reconcileId:"",parallelIndex:c}),r&&k.event(E.ADD_LINE,{type:n})}})),e(v()),e(D(t.current.export()))}else if("free"===$&&_){const{x:n,y:r}=u(s);W.x-n==0&&W.y-r==0||e(D(t.current.export()))}e(y(void 0))})),V=L(((n,o)=>{if(o.stopPropagation(),o.shiftKey||e(N()),o.shiftKey&&C.has(n)?e(p(n)):e(f(n)),$.startsWith("station")||$.startsWith("misc-node-virtual")||$.startsWith("misc-node-master")){const l=o.clientX-document.getElementById("canvas").getBoundingClientRect().left,d=o.clientY-document.getElementById("canvas").getBoundingClientRect().top,u=$.startsWith("station"),y=w(10),p=u?`stn_${y}`:`misc_node_${y}`,f=u?$.slice(8):$.slice(10),{x:m,y:b}=j(l,d,s,a),P=u?structuredClone(R[f].defaultAttrs):structuredClone(Z[f].defaultAttrs);"color"in P&&(P.color=K),t.current.addNode(p,{visible:!0,zIndex:0,x:x(m,5),y:x(b,5),type:f,[f]:P});const A=t.current.getEdgeAttributes(n),{zIndex:N,type:I,style:C}=A,S=A[I],M=A[C],[_,z]=t.current.extremities(n),W=i?0:-1;t.current.addDirectedEdgeWithKey(`line_${w(10)}`,_,p,{visible:!0,zIndex:N,type:I,[I]:structuredClone(S),style:C,[C]:structuredClone(M),reconcileId:"",parallelIndex:W}),t.current.addDirectedEdgeWithKey(`line_${w(10)}`,p,z,{visible:!0,zIndex:N,type:I,[I]:structuredClone(S),style:C,[C]:structuredClone(M),reconcileId:"",parallelIndex:W}),t.current.dropEdge(n),e(g()),e(v()),e(D(t.current.export())),r&&(k.event(E.ADD_STATION,{type:f}),k.event(E.ADD_LINE,{type:I})),e(c("free")),e(h(new Set([p])))}})),q=T.useMemo((()=>[...Q(t.current),...J(t.current)]),[M,S]),G=I.component;return n.jsxs(n.Fragment,{children:[n.jsx(ne,{elements:q,handlePointerDown:Y,handlePointerMove:F,handlePointerUp:X,handleEdgePointerDown:V}),$.startsWith("line")&&_&&"background"!==_&&n.jsx(G,{id:"line_create_in_progress___no_use",type:$.slice(5),path:o[$.slice(5)].generatePath(t.current.getNodeAttribute(_,"x"),t.current.getNodeAttribute(_,"x")-O.x,t.current.getNodeAttribute(_,"y"),t.current.getNodeAttribute(_,"y")-O.y,o[$.slice(5)].defaultAttrs),styleAttrs:{color:K},newLine:!0,handlePointerDown:()=>{}})]})};e("default",(()=>{const e=l(),t=T.useRef(window.graph),r=()=>{e(g()),e(v()),e(D(t.current.export()))},{activeSubscriptions:o}=d((e=>e.account)),{telemetry:{project:i}}=d((e=>e.app)),{svgViewBoxZoom:s,svgViewBoxMin:a}=d((e=>e.param)),{mode:p,lastTool:f,active:m,selected:b,keepLastPath:P,theme:A,refresh:{nodes:I},masterNodesCount:G}=d((e=>e.runtime)),H=B(),{height:J,width:Q}=C(H),ee=!o.RMP_CLOUD&&G+1>S;T.useEffect((()=>{const e=Y(t.current);Object.entries(e).filter((([e,t])=>t&&e in F)).forEach((([e])=>X(e)))}),[I]);const[te,ne]=T.useState({x:0,y:0}),[oe,ie]=T.useState({x:0,y:0}),[se,ae]=T.useState({x:0,y:0}),[le,de]=T.useState({x:0,y:0}),ce=L((n=>{const{x:o,y:l}=u(n);if(p.startsWith("station")){e(c("free"));const n=`stn_${w(10)}`,d=p.slice(8),u=structuredClone(R[d].defaultAttrs);"color"in u&&(u.color=A);const{x:y,y:f}=j(o,l,s,a);t.current.addNode(n,{visible:!0,zIndex:0,x:x(y,5),y:x(f,5),type:d,[d]:u}),r(),i&&k.event(E.ADD_STATION,{type:d}),e(h(new Set([n])))}else if(p.startsWith("misc-node")){e(c("free"));const n=`misc_node_${w(10)}`,d=p.slice(10),{x:u,y:y}=j(o,l,s,a);t.current.addNode(n,{visible:!0,zIndex:0,x:x(u,5),y:x(y,5),type:d,[d]:structuredClone(Z[d].defaultAttrs)}),r(),i&&k.event(E.ADD_STATION,{type:d}),e(h(new Set([n])))}else"free"===p||p.startsWith("line")?(p.startsWith("line")&&(e(c("free")),P&&e(M(!1))),ae({x:o,y:l}),de(a),n.shiftKey||(e(y("background")),e(N()))):"select"===p&&(ne(j(o,l,s,a)),ie(j(o,l,s,a)))})),ue=L((t=>{if("select"===p){if(0!=te.x&&0!=te.y){const{x:e,y:n}=u(t);ie(j(e,n,s,a))}}else if("background"===m){const{x:n,y:r}=u(t);e($({x:le.x+(se.x-n)*s/100,y:le.y+(se.y-r)*s/100}))}})),ye=L((n=>{if("select"===p){const{x:r,y:o}=u(n),{x:i,y:l}=j(r,o,s,a),d=V(t.current,te.x,te.y,i,l),y=q(t.current,new Set(d));e(h(new Set([...n.shiftKey?b:[],...d,...y]))),e(c("free")),ne({x:0,y:0}),ie({x:0,y:0})}"background"!==m||n.shiftKey||e(y(void 0))})),he=L((t=>{let n=s;t.deltaY>0&&s+10<400?n=s+10:t.deltaY<0&&s-10>0&&(n=s-10),e(_(n));const{x:r,y:o}=u(t),i=t.currentTarget.getBoundingClientRect(),[l,d]=[r/i.width,o/i.height];e($({x:a.x+r*s/100-Q*n/100*l,y:a.y+o*s/100-J*n/100*d}))})),pe=L((async n=>{if(z?"Backspace"===n.key:"Delete"===n.key)b.size>0&&(b.forEach((e=>{t.current.hasNode(e)?t.current.dropNode(e):t.current.hasEdge(e)&&t.current.dropEdge(e)})),e(N()),r());else if(n.key.startsWith("Arrow")){const t=100,r=n.key.endsWith("Left")?-1:n.key.endsWith("Right")?1:0,o=n.key.endsWith("Up")?-1:n.key.endsWith("Down")?1:0;e($(j(t*r,t*o,s,a)))}else if("i"===n.key||"j"===n.key||"k"===n.key||"l"===n.key){const e=10,o=("j"===n.key?-1:"l"===n.key?1:0)*e,i=("i"===n.key?-1:"k"===n.key?1:0)*e;b.size>0&&b.forEach((e=>{t.current.hasNode(e)&&(t.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)+o)),t.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)+i)),r())}))}else if("f"===n.key&&f)e(c(f));else if("z"===n.key&&(z?n.metaKey&&!n.shiftKey:n.ctrlKey))z&&n.preventDefault(),e(K()),e(g()),e(v());else if("s"===n.key)e(c("select"));else if("c"!==n.key&&"x"!==n.key||!(z?n.metaKey&&!n.shiftKey:n.ctrlKey))if("v"===n.key&&(z?n.metaKey&&!n.shiftKey:n.ctrlKey)){const n=await navigator.clipboard.readText(),{x:o,y:i}=j(Q/2,J/2,s,a),{nodes:l,edges:d}=O(n,t.current,ee,x(o,5),x(i,5));r();const c=structuredClone(l);d.forEach((e=>c.add(e))),e(h(c))}else(z&&"z"===n.key&&n.metaKey&&n.shiftKey||!z&&"y"===n.key&&n.ctrlKey)&&(e(W()),e(g()),e(v()));else{const o=U(t.current,b);navigator.clipboard.writeText(o),"x"===n.key&&(e(N()),b.forEach((e=>{t.current.hasNode(e)?t.current.dropNode(e):t.current.hasEdge(e)&&t.current.dropEdge(e)})),r())}})),[fe,xe]=T.useState(0),ge=L((t=>{if(2===t.touches.length){e(y(void 0));const[n,r]=[t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY];xe(n*n+r*r)}})),ve=L((t=>{if(0!==fe&&2===t.touches.length){const[n,r]=[t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY],o=n*n+r*r;let i=s;o-fe<0&&s+10<=390?i=s+10:o-fe>0&&s-10>=10&&(i=s-10),e(_(i)),xe(o);const l=t.currentTarget.getBoundingClientRect(),[d,c]=[(t.touches[0].clientX+t.touches[1].clientX)/2-l.left,(t.touches[0].clientY+t.touches[1].clientY)/2-l.top],[u,y]=[d/l.width,c/l.height];e($({x:a.x+d*s/100-Q*i/100*u,y:a.y+c*s/100-J*i/100*y}))}})),me=L((e=>{0!==fe&&xe(0)})),[be,we]=T.useState({sx:0,sy:0,ex:0,ey:0});return T.useEffect((()=>{we({sx:te.x<=oe.x?te.x:oe.x,ex:te.x>oe.x?te.x:oe.x,sy:te.y<=oe.y?te.y:oe.y,ey:te.y>oe.y?te.y:oe.y})}),[oe.x,oe.y]),n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:J,width:Q,viewBox:`${a.x} ${a.y} ${Q*s/100} ${J*s/100}`,onPointerDown:ce,onPointerMove:ue,onPointerUp:ye,onTouchStart:ge,onTouchMove:ve,onTouchEnd:me,onWheel:he,tabIndex:0,onKeyDown:pe,children:[n.jsx(re,{}),"select"===p&&0!=te.x&&0!=te.y&&n.jsx("rect",{x:be.sx,y:be.sy,width:be.ex-be.sx,height:be.ey-be.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),n.jsx("defs",{children:n.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[n.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),n.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})}))}}}));
