import{j as e,$ as W,a0 as k,a1 as ee,s as w,A as $,M as q,m as G,n as Z,p as J,r as K,ae as te}from"./chakra-594c63ee.js";import{c as v,j as C,d as A,D as P,ah as _,z as b,A as x,t as Q,N as I,q as ne,v as se,aj as B,ak as U,y as N,n as F,al as ae,am as re,an as ie,ao as oe,p as H}from"./index-36d664af.js";import{b as c}from"./react-2c0b8364.js";import{b as le}from"./graph-114557d9.js";import{d as ce,e as de,f as pe}from"./change-types-223ffdcb.js";import{s as X}from"./stations-63b72bf0.js";import{u as V,e as ue}from"./clipboard-19c63802.js";import{m as he}from"./misc-nodes-e9a575f6.js";function ge(){const{t:n}=v(),r=C(),{selected:a}=A(t=>t.runtime),o=c.useRef(window.graph),s=t=>{r(P()),r(_(t))};return e.jsxs(W,{p:1,children:[e.jsxs(k,{as:"h5",size:"sm",children:[n("Selected Objects: ")," ",a.length]}),e.jsx(ee,{m:"var(--chakra-space-1)",children:a.map(t=>{const i=o.current.getNodeAttributes(t),p=i.type,l=t.startsWith("stn")?i[p].names.join("/"):p;return e.jsx(w,{width:"100%",size:"sm",variant:"solid",onClick:()=>s(t),overflow:"hidden",maxW:"270",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:l},t)})})]})}function me(){const{t:n}=v(),r=C(),a=c.useCallback(()=>{r(b()),r(x(i.current.export()))},[r,b,x]),{selected:o,theme:s}=A(f=>f.runtime),t=o.at(0),i=c.useRef(window.graph),[p,l]=c.useState(!1),h=c.useRef(null),d=Object.fromEntries(Object.entries(Q).map(([f,M])=>[f,n(M.metadata.displayName).toString()])),[u,g]=c.useState(i.current.getEdgeAttribute(t,"type")),[m,y]=c.useState(void 0),j=Object.fromEntries(Object.entries(I).map(([f,M])=>[f,n(M.metadata.displayName).toString()])),[S,z]=c.useState(i.current.getEdgeAttribute(t,"style")),[T,O]=c.useState(void 0),E=Object.values(ne).filter(f=>!I[S].metadata.supportLinePathType.includes(f)),R=Object.values(se).filter(f=>!I[f].metadata.supportLinePathType.includes(u)),L=()=>{m&&(ce(i.current,t,m),g(i.current.getEdgeAttribute(t,"type")),a())},Y=()=>{T&&(de(i.current,t,T,s),z(i.current.getEdgeAttribute(t,"style")),a())},D=f=>{f&&(m?(L(),y(void 0)):T&&(Y(),O(void 0))),l(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("panel.details.info.linePathType"),minW:"276",children:e.jsx(U,{options:d,disabledOptions:E,defaultValue:u,value:u,onChange:({target:{value:f}})=>{y(f),l(!0)}})}),e.jsx(B,{label:n("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(U,{options:j,disabledOptions:R,defaultValue:S,value:S,onChange:({target:{value:f}})=>{O(f),l(!0)}})}),e.jsx($,{isOpen:p,leastDestructiveRef:h,onClose:()=>D(!1),children:e.jsx(q,{children:e.jsxs(G,{children:[e.jsx(Z,{children:n("warning")}),e.jsx(J,{children:n("panel.details.changeLineTypeContent")}),e.jsxs(K,{children:[e.jsx(w,{ref:h,onClick:()=>D(!1),children:n("cancel")}),e.jsx(w,{ml:"2",colorScheme:"red",onClick:()=>D(!0),children:n("panel.details.changeType")})]})]})})})]})}function fe(){const{t:n}=v(),r=C(),a=c.useCallback(()=>{r(N()),r(x(t.current.export()))},[r,N,x]),{selected:o}=A(j=>j.runtime),s=o.at(0),t=c.useRef(window.graph),[i,p]=c.useState(!1),l=c.useRef(null),[h,d]=c.useState(void 0),u=t.current.getNodeAttribute(s,"type"),g=Object.fromEntries(Object.entries(X).map(([j,S])=>[j,n(S.metadata.displayName).toString()])),m=()=>{h&&(pe(t.current,s,h),a())},y=j=>{j&&m(),d(void 0),p(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:n("panel.details.info.stationType"),minW:"276",children:e.jsx(U,{options:g,disabledOptions:[u],value:u,onChange:({target:{value:j}})=>{d(j),p(!0)}})}),e.jsx($,{isOpen:i,leastDestructiveRef:l,onClose:()=>y(!1),children:e.jsx(q,{children:e.jsxs(G,{children:[e.jsx(Z,{children:n("warning")}),e.jsx(J,{children:n("panel.details.changeStationTypeContent")}),e.jsxs(K,{children:[e.jsx(w,{ref:l,onClick:()=>y(!1),children:n("cancel")}),e.jsx(w,{ml:"2",colorScheme:"red",onClick:()=>y(!0),children:n("panel.details.changeType")})]})]})})})]})}function xe(){const{t:n}=v(),r=C(),a=c.useCallback(()=>{r(N()),r(b()),r(x(t.current.export()))},[r,b,x]),{selected:o}=A(l=>l.runtime),s=o.at(0),t=c.useRef(window.graph),i=l=>{const h=Math.min(Math.max(l,-5),5);t.current.hasNode(s)&&t.current.setNodeAttribute(s,"zIndex",h),t.current.hasEdge(s)&&t.current.setEdgeAttribute(s,"zIndex",h),a()},p=[{type:"input",label:n("panel.details.info.id"),value:o.length>0?o.join(", "):"undefined",minW:276},{type:"select",label:n("panel.details.info.zIndex"),value:s?t.current.hasNode(s)?t.current.getNodeAttribute(s,"zIndex"):t.current.hasEdge(s)?t.current.getEdgeAttribute(s,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(l,h)=>[h-5,(h-5).toString()])),onChange:l=>i(Number(l))}];return o.length===0||o.length>1&&p.push({type:"input",label:n("panel.details.info.type"),value:"multiple selection",minW:276}),e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.info.title")}),e.jsx(F,{fields:p,minW:130}),o.length===1&&s.startsWith("stn")&&t.current.hasNode(s)&&e.jsx(fe,{}),o.length===1&&s.startsWith("line")&&t.current.hasEdge(s)&&e.jsx(me,{}),o.length>1&&e.jsx(ge,{})]})}function ye(){const{t:n}=v(),r=C(),{selected:a}=A(S=>S.runtime),o=a.at(0),s=c.useRef(window.graph),[t,i]=c.useState("undefined"),[p,l]=c.useState("undefined"),[h,d]=c.useState("undefined"),[u,g]=c.useState("undefined");c.useEffect(()=>{var S,z,T,O;if(o!=null&&o.startsWith("line")){const[E,R]=s.current.extremities(o);if(i(E),l(R),E.startsWith("stn")){const L=s.current.getNodeAttribute(E,"type");d((z=(S=s.current.getNodeAttribute(E,L))==null?void 0:S.names.at(0))!=null?z:"undefined")}if(R.startsWith("stn")){const L=s.current.getNodeAttribute(R,"type");g((O=(T=s.current.getNodeAttribute(R,L))==null?void 0:T.names.at(0))!=null?O:"undefined")}}},[a]);const m=V(()=>{r(P()),r(_(t))}),y=V(()=>{r(P()),r(_(p))}),j=[{type:"custom",label:n("panel.details.lineExtremities.source"),component:e.jsx(w,{flex:1,size:"sm",variant:"link",onClick:m,children:t})},{type:"custom",label:n("panel.details.lineExtremities.target"),component:e.jsx(w,{flex:1,size:"sm",variant:"link",onClick:y,children:p})},{type:"input",label:n("panel.details.lineExtremities.sourceName"),value:h},{type:"input",label:n("panel.details.lineExtremities.targetName"),value:u}];return e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.lineExtremities.title")}),e.jsx(F,{fields:j,minW:130})]})}function je(){const{t:n}=v(),r=C(),a=c.useCallback(()=>{r(N()),r(b()),r(x(i.current.export()))},[r,N,b,x]),{selected:o,refresh:{nodes:s}}=A(d=>d.runtime),t=o.at(0),i=c.useRef(window.graph),[p,l]=c.useState({x:0,y:0});c.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const d=i.current.getNodeAttribute(t,"x"),u=i.current.getNodeAttribute(t,"y");l({x:d,y:u})}},[s,o]);const h=[{type:"input",label:n("panel.details.nodePosition.pos.x"),value:p.x.toString(),validator:d=>!Number.isNaN(d),onChange:d=>{i.current.mergeNodeAttributes(t,{x:Number(d)}),a()}},{type:"input",label:n("panel.details.nodePosition.pos.y"),value:p.y.toString(),validator:d=>!Number.isNaN(d),onChange:d=>{i.current.mergeNodeAttributes(t,{y:Number(d)}),a()}}];return e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.nodePosition.title")}),e.jsx(F,{fields:h,minW:130})]})}const be={...X,...he},Se=()=>{var p;const n=C(),{selected:r}=A(l=>l.runtime),a=r.at(0),o=window.graph.getNodeAttribute(a,"type"),s=be[o].attrsComponent,t=(p=window.graph.getNodeAttribute(a,o))!=null?p:{},i=(l,h)=>{const d=window.graph.getNodeAttribute(l,"type");window.graph.mergeNodeAttributes(l,{[d]:h}),n(N()),n(x(window.graph.export()))};return s&&e.jsx(s,{id:a,attrs:t,handleAttrsUpdate:i})},we=()=>{var u,g;const n=C(),{selected:r}=A(m=>m.runtime),a=r.at(0),o=window.graph.getEdgeAttribute(a,"type"),s=(u=window.graph.getEdgeAttribute(a,o))!=null?u:{},t=Q[o].attrsComponent,i=window.graph.getEdgeAttribute(a,"style"),p=(g=window.graph.getEdgeAttribute(a,i))!=null?g:{},l=I[i].attrsComponent,h=(m,y)=>{window.graph.mergeEdgeAttributes(m,{[o]:y}),n(b()),n(x(window.graph.export()))},d=(m,y)=>{window.graph.mergeEdgeAttributes(m,{[i]:y}),n(b()),n(x(window.graph.export()))};return e.jsxs(e.Fragment,{children:[t&&e.jsx(t,{id:a,attrs:s,handleAttrsUpdate:h}),l&&e.jsx(l,{id:a,attrs:p,handleAttrsUpdate:d})]})},Le=()=>{const{t:n}=v(),r=C(),a=c.useRef(window.graph),o=c.useCallback(()=>{r(N()),r(b()),r(x(a.current.export()))},[r,N,b,x]),{selected:s,mode:t}=A(u=>u.runtime),i=s.at(0),p=()=>r(P()),l=u=>{const g=structuredClone(a.current.getNodeAttributes(u));g.x+=50,g.y+=50;const m=u.startsWith("stn")?`stn_${H(10)}`:`misc_node_${H(10)}`;a.current.addNode(m,g),r(N()),r(x(a.current.export()))},h=u=>{const g=new Set(u),m=le(a.current,g),y=ue(a.current,g,new Set(m));navigator.clipboard.writeText(y)},d=u=>{r(P()),u.forEach(g=>{a.current.hasNode(g)?(a.current.dropNode(g),o()):a.current.hasEdge(g)&&(a.current.dropEdge(g),r(b()),r(x(a.current.export())))})};return e.jsxs(ae,{isOpen:s.length>0&&!t.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(re,{onClose:p,children:n("panel.details.header")}),e.jsxs(ie,{children:[e.jsx(xe,{}),s.length===1&&a.current.hasNode(i)&&e.jsx(je,{}),s.length===1&&a.current.hasEdge(i)&&e.jsx(ye,{}),s.length===1&&e.jsxs(W,{p:1,children:[e.jsx(k,{as:"h5",size:"sm",children:n("panel.details.specificAttrsTitle")}),window.graph.hasNode(i)&&e.jsx(Se,{}),window.graph.hasEdge(i)&&e.jsx(we,{})]})]}),e.jsx(oe,{children:e.jsxs(te,{children:[s.length===1&&a.current.hasNode(s.at(0))&&e.jsx(w,{size:"sm",variant:"outline",onClick:()=>l(s.at(0)),children:n("panel.details.footer.duplicate")}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>h(s),children:n("panel.details.footer.copy")}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>d(s),children:n("panel.details.footer.remove")})]})})]})};export{Le as default};
