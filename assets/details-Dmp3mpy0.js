import{j as e,B as W,aw as z,ax as ie,aK as F,O as A,aM as re,U as le,D as oe,_ as Z,$ as q,a0 as J,a1 as Y,a3 as ee,a5 as te,a4 as U}from"./chakra-Dqj68bqe.js";import{e as L,a as S,az as ce,U as de,at as ue,aA as pe,v as C,w,o as I,ap as k,l as he,p as ge,Q as B,aB as H,t as E,_ as me,$ as xe,j as V,m as ne,y as D,au as X,ay as fe,aC as ye,aD as be,aE as je,aF as we,aw as Se,n as G}from"./index-DspUkl9i.js";import{u as P,b as p}from"./react-DV6nCJb6.js";import{u as K,e as Ae}from"./clipboard-Djj6WMgJ.js";import{s as $}from"./master-manager-aBdOwaxj.js";import{C as Ce,c as Ne,a as Ee,b as ve}from"./change-type-modal-JpBf45Fv.js";import{LearnHowToAdd as Te}from"./tools-4panZnKf.js";import{m as Le}from"./misc-nodes-CnzmwXLY.js";import"./index-D_e6V_B7.js";function Pe(){const{t}=P(),r=L(),{selected:c}=S(s=>s.runtime),h=p.useRef(window.graph),l=s=>{if(h.current.hasNode(s)){const o=h.current.getNodeAttributes(s),g=o.type;return s.startsWith("stn")?o[g].names.join("/"):g}else if(h.current.hasEdge(s)){const[o,g]=h.current.extremities(s),u=h.current.getSourceAttributes(s),m=h.current.getTargetAttributes(s),b=u.type,d=m.type;return(o.startsWith("stn")?u[b].names[0]:b)+" - "+(g.startsWith("stn")?m[d].names[0]:d)}},[i,n]=p.useState([]);p.useEffect(()=>{n(["station","misc-node","line"])},[c]);const[a,y]=p.useState(!1);return e.jsxs(W,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[t("panel.details.multipleSelection.selected")," ",c.size]}),e.jsxs(ie,{m:"var(--chakra-space-1)",children:[e.jsxs(F,{w:"100%",children:[e.jsx(z,{as:"h5",size:"xs",w:"100%",children:t("panel.details.multipleSelection.show")}),e.jsx(ce,{selections:[{label:t("panel.details.multipleSelection.station"),value:"station"},{label:t("panel.details.multipleSelection.miscNode"),value:"misc-node"},{label:t("panel.details.multipleSelection.edge"),value:"line"}],defaultValue:i,multiSelect:!0,onChange:s=>n(s)})]}),i.length!==0&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{width:"100%",size:"sm",onClick:()=>y(!0),children:[t("panel.details.multipleSelection.change"),e.jsx(re,{label:t("header.settings.pro"),children:e.jsx(le,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",children:"PRO"})})]}),e.jsx(oe,{})]}),[...c].filter(s=>i.includes("station")||!s.startsWith("stn")).filter(s=>i.includes("misc-node")||!s.startsWith("misc")).filter(s=>i.includes("line")||!s.startsWith("line")).map(s=>{var o;return e.jsxs(F,{width:"100%",children:[e.jsx(A,{width:"100%",size:"sm",variant:"solid",onClick:()=>r(de(new Set([s]))),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:(o=l(s))==null?void 0:o.replaceAll("\\","âŽ")}),e.jsx(A,{size:"sm",onClick:()=>r(ue(s)),children:e.jsx(pe,{})})]},s)})]}),e.jsx(Ce,{isOpen:a,onClose:()=>y(!1),isSelect:!0,filter:i})]})}function Re(){const{t}=P(),r=L(),c=p.useCallback(()=>{r(C()),r(w(a.current.export()))},[r,C,w]),{preference:{autoParallel:h}}=S(j=>j.app),{selected:l,theme:i}=S(j=>j.runtime),[n]=l,a=p.useRef(window.graph),[y,s]=p.useState(!1),o=p.useRef(null),g=Object.fromEntries(Object.entries(I).map(([j,_])=>[j,t(_.metadata.displayName).toString()])),[u,m]=p.useState(a.current.getEdgeAttribute(n,"type")),[b,d]=p.useState(void 0),x=Object.fromEntries(Object.entries(k).map(([j,_])=>[j,t(_.metadata.displayName).toString()])),[f,N]=p.useState(a.current.getEdgeAttribute(n,"style")),[v,T]=p.useState(void 0);p.useEffect(()=>{m(a.current.getEdgeAttribute(n,"type")),N(a.current.getEdgeAttribute(n,"style"))},[n]);const R=Object.values(he).filter(j=>!k[f].metadata.supportLinePathType.includes(j)),O=Object.values(ge).filter(j=>!k[j].metadata.supportLinePathType.includes(u)),se=()=>{b&&(Ne(a.current,n,b,h),m(a.current.getEdgeAttribute(n,"type")),c())},ae=()=>{v&&(Ee(a.current,n,v,i),N(a.current.getEdgeAttribute(n,"style")),c())},M=j=>{j&&(b?(se(),d(void 0)):v&&(ae(),T(void 0))),s(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:t("panel.details.info.linePathType"),minW:"276",children:e.jsx(H,{options:g,disabledOptions:R,defaultValue:u,value:u,onChange:({target:{value:j}})=>{d(j),s(!0)}})}),e.jsx(B,{label:t("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(H,{options:x,disabledOptions:O,defaultValue:f,value:f,onChange:({target:{value:j}})=>{T(j),s(!0)}})}),e.jsx(Te,{type:"line",expand:!0}),e.jsx(Z,{isOpen:y,leastDestructiveRef:o,onClose:()=>M(!1),children:e.jsx(q,{children:e.jsxs(J,{children:[e.jsx(Y,{children:t("warning")}),e.jsx(ee,{children:t("panel.details.changeLineTypeContent")}),e.jsxs(te,{children:[e.jsx(A,{ref:o,onClick:()=>M(!1),children:t("cancel")}),e.jsx(A,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:t("panel.details.changeType")})]})]})})})]})}function ke(){const{t}=P(),r=L(),c=p.useCallback(()=>{r(E()),r(w(i.current.export()))},[r,E,w]),{selected:h}=S(d=>d.runtime),[l]=h,i=p.useRef(window.graph),[n,a]=p.useState(!1),y=p.useRef(null),[s,o]=p.useState(void 0),g=i.current.getNodeAttribute(l,"type"),u=Object.fromEntries(Object.entries($).map(([d,x])=>[d,t(x.metadata.displayName).toString()])),m=()=>{s&&(ve(i.current,l,s),c())},b=d=>{d&&m(),o(void 0),a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(B,{label:t("panel.details.info.stationType"),minW:"276",children:e.jsx(H,{options:u,disabledOptions:[g],value:g,onChange:({target:{value:d}})=>{o(d),a(!0)}})}),e.jsx(Z,{isOpen:n,leastDestructiveRef:y,onClose:()=>b(!1),children:e.jsx(q,{children:e.jsxs(J,{children:[e.jsx(Y,{children:t("warning")}),e.jsx(ee,{children:t("panel.details.changeStationTypeContent")}),e.jsxs(te,{children:[e.jsx(A,{ref:y,onClick:()=>b(!1),children:t("cancel")}),e.jsx(A,{ml:"2",colorScheme:"red",onClick:()=>b(!0),children:t("panel.details.changeType")})]})]})})})]})}function ze(){const{t}=P(),r=L(),c=p.useCallback(()=>{r(E()),r(C()),r(w(a.current.export()))},[r,E,C,w]),{activeSubscriptions:h}=S(u=>u.account),{selected:l,parallelLinesCount:i}=S(u=>u.runtime),[n]=l,a=p.useRef(window.graph),y=u=>{const m=Math.min(Math.max(u,-10),10);a.current.hasNode(n)&&a.current.setNodeAttribute(n,"zIndex",m),a.current.hasEdge(n)&&a.current.setEdgeAttribute(n,"zIndex",m),c()},s=(u,m)=>{let b=-1;if(u){const d=a.current.getEdgeAttributes(n),[x,f]=a.current.extremities(n);b=ne(a.current,d.type,x,f,m)}o(b)},o=u=>{a.current.setEdgeAttribute(n,"parallelIndex",u),r(C()),r(w(a.current.export()))},g=[];if(l.size!==0)if(l.size===1){if(g.push({type:"input",label:t("panel.details.info.id"),value:n,minW:276}),g.push({type:"select",label:t("panel.details.info.zIndex"),value:n?a.current.hasNode(n)?a.current.getNodeAttribute(n,"zIndex"):a.current.hasEdge(n)?a.current.getEdgeAttribute(n,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:21},(u,m)=>[m-10,(m-10).toString()])),onChange:u=>y(Number(u))}),a.current.hasEdge(n)){const u=a.current.getEdgeAttributes(n),m=u.parallelIndex,b=h.RMP_CLOUD?me:xe,d=i>b&&m<0,x=i>b&&m>=0;g.push({type:"switch",label:t("panel.details.info.parallel"),isDisabled:d,isChecked:m>=0,onChange:f=>s(f,u[u.type].startFrom),oneLine:!0,minW:276}),m>=0&&g.push({type:"input",label:t("panel.details.info.parallelIndex"),variant:"number",isDisabled:x,value:u.parallelIndex.toString(),onChange:f=>o(Number(f)),minW:276})}}else l.size>1&&g.push({type:"input",label:t("panel.details.info.type"),value:t("panel.details.multipleSelection.title"),minW:276});return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.info.title")}),e.jsx(V,{fields:g,minW:130}),l.size===1&&n.startsWith("stn")&&a.current.hasNode(n)&&a.current.getNodeAttribute(n,"type")in $&&e.jsx(ke,{}),l.size===1&&n.startsWith("line")&&a.current.hasEdge(n)&&a.current.getEdgeAttribute(n,"type")in I&&a.current.getEdgeAttribute(n,"style")in k&&e.jsx(Re,{}),l.size>1&&e.jsx(Pe,{})]})}function Oe(){const{t}=P(),r=L(),{selected:c}=S(x=>x.runtime),[h]=c,l=p.useRef(window.graph),[i,n]=p.useState("undefined"),[a,y]=p.useState("undefined"),[s,o]=p.useState("undefined"),[g,u]=p.useState("undefined");p.useEffect(()=>{var x,f,N,v;if(h!=null&&h.startsWith("line")){const[T,R]=l.current.extremities(h);if(n(T),y(R),T.startsWith("stn")){const O=l.current.getNodeAttribute(T,"type");o((f=(x=l.current.getNodeAttribute(T,O))==null?void 0:x.names.at(0))!=null?f:"undefined")}if(R.startsWith("stn")){const O=l.current.getNodeAttribute(R,"type");u((v=(N=l.current.getNodeAttribute(R,O))==null?void 0:N.names.at(0))!=null?v:"undefined")}}},[c]);const m=K(()=>{r(D()),r(X(i))}),b=K(()=>{r(D()),r(X(a))}),d=[{type:"custom",label:t("panel.details.lineExtremities.source"),component:e.jsx(A,{ml:"auto",size:"sm",variant:"link",onClick:m,children:i}),oneLine:!0,minW:"full"},{type:"input",label:t("panel.details.lineExtremities.sourceName"),value:s,minW:"full"},{type:"custom",label:t("panel.details.lineExtremities.target"),component:e.jsx(A,{ml:"auto",size:"sm",variant:"link",onClick:b,children:a}),oneLine:!0,minW:"full"},{type:"input",label:t("panel.details.lineExtremities.targetName"),value:g,minW:"full"}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.lineExtremities.title")}),e.jsx(V,{fields:d,minW:130})]})}function We(){const{t}=P(),r=L(),c=p.useCallback(()=>{r(E()),r(C()),r(w(n.current.export()))},[r,E,C,w]),{selected:h,refresh:{nodes:l}}=S(o=>o.runtime),[i]=h,n=p.useRef(window.graph),[a,y]=p.useState({x:0,y:0});p.useEffect(()=>{if(i!=null&&i.startsWith("stn")||i!=null&&i.startsWith("misc_node_")){const o=n.current.getNodeAttribute(i,"x"),g=n.current.getNodeAttribute(i,"y");y({x:o,y:g})}},[l,h]);const s=[{type:"input",label:t("panel.details.nodePosition.pos.x"),value:a.x.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{n.current.mergeNodeAttributes(i,{x:Number(o)}),c()}},{type:"input",label:t("panel.details.nodePosition.pos.y"),value:a.y.toString(),validator:o=>!Number.isNaN(o),onChange:o=>{n.current.mergeNodeAttributes(i,{y:Number(o)}),c()}}];return e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.nodePosition.title")}),e.jsx(V,{fields:s,minW:130})]})}const Q={...$,...Le},Ie=()=>{var y;const t=L(),{selected:r}=S(s=>s.runtime),{t:c}=P(),[h]=r,l=window.graph.getNodeAttribute(h,"type"),i=l in Q&&Q[l].attrsComponent,n=(y=window.graph.getNodeAttribute(h,l))!=null?y:{},a=(s,o)=>{const g=window.graph.getNodeAttribute(s,"type");window.graph.mergeNodeAttributes(s,{[g]:o}),t(E()),t(w(window.graph.export()))};return i?e.jsx(i,{id:h,attrs:n,handleAttrsUpdate:a}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:c("panel.details.unknown.error",{category:c("panel.details.unknown.node")})})},De=()=>{var d,x;const t=L(),{preference:{autoParallel:r}}=S(f=>f.app),{selected:c}=S(f=>f.runtime),{t:h}=P(),[l]=c,i=window.graph.getEdgeAttribute(l,"type"),n=(d=window.graph.getEdgeAttribute(l,i))!=null?d:{},a=i in I&&I[i].attrsComponent,y=window.graph.getEdgeAttribute(l,"style"),s=(x=window.graph.getEdgeAttribute(l,y))!=null?x:{},o=y in k&&k[y].attrsComponent,g=window.graph.getEdgeAttribute(l,"parallelIndex"),u=window.graph.getEdgeAttribute(l,"reconcileId"),m=(f,N)=>{let v=-1;if(r){const[T,R]=window.graph.extremities(f);v=ne(window.graph,i,T,R,N.startFrom)}window.graph.setEdgeAttribute(f,"parallelIndex",v),window.graph.mergeEdgeAttributes(f,{[i]:N}),t(C()),t(w(window.graph.export()))},b=(f,N)=>{window.graph.mergeEdgeAttributes(f,{[y]:N}),t(C()),t(w(window.graph.export()))};return e.jsxs(e.Fragment,{children:[a?e.jsx(a,{id:l,attrs:n,handleAttrsUpdate:m,parallelIndex:g}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:h("panel.details.unknown.error",{category:h("panel.details.unknown.linePath")})}),o?e.jsx(o,{id:l,attrs:s,handleAttrsUpdate:b,reconcileId:u}):e.jsx(U,{fontSize:"xs",m:"var(--chakra-space-1)",children:h("panel.details.unknown.error",{category:h("panel.details.unknown.lineStyle")})})]})},Ge=()=>{const{t}=P(),r=L(),c=p.useRef(window.graph),h=p.useCallback(()=>{r(E()),r(C()),r(w(c.current.export()))},[r,E,C,w]),{activeSubscriptions:l}=S(d=>d.account),{selected:i,mode:n,active:a,masterNodesCount:y}=S(d=>d.runtime),[s]=i,o=!l.RMP_CLOUD&&y+1>fe,g=()=>r(D()),u=d=>{const x=structuredClone(c.current.getNodeAttributes(d));x.x+=50,x.y+=50;const f=d.startsWith("stn")?"stn_".concat(G(10)):"misc_node_".concat(G(10));c.current.addNode(f,x),r(E()),r(w(c.current.export()))},m=d=>{const x=Ae(c.current,d);navigator.clipboard.writeText(x)},b=d=>{r(D()),d.forEach(x=>{c.current.hasNode(x)?c.current.dropNode(x):c.current.hasEdge(x)&&c.current.dropEdge(x)}),h()};return e.jsxs(ye,{isOpen:i.size>0&&!n.startsWith("line")&&!a,width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(be,{onClose:g,children:t("panel.details.header")}),e.jsxs(je,{children:[e.jsx(ze,{}),i.size===1&&c.current.hasNode(s)&&e.jsx(We,{}),i.size===1&&c.current.hasEdge(s)&&e.jsx(Oe,{}),i.size===1&&e.jsxs(W,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:t("panel.details.specificAttrsTitle")}),window.graph.hasNode(s)&&e.jsx(Ie,{}),window.graph.hasEdge(s)&&e.jsx(De,{})]})]}),e.jsx(we,{children:e.jsxs(F,{children:[i.size===1&&c.current.hasNode(s)&&e.jsx(A,{size:"sm",variant:"outline",onClick:()=>u(s),isDisabled:c.current.getNodeAttributes(s).type===Se.Master&&o,children:t("panel.details.footer.duplicate")}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>m(i),children:t("panel.details.footer.copy")}),e.jsx(A,{size:"sm",variant:"outline",onClick:()=>b(i),children:t("panel.details.footer.remove")})]})})]})};export{Ge as default};
