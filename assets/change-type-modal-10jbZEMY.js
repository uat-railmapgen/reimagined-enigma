import{j as c,at as fe,$ as ye,au as me,a1 as be,a4 as G,a2 as Se,a3 as Ce,aM as Ae,aN as Te,aO as xe,B as je,aP as Ee,aQ as Oe,a5 as ve,O as Q}from"./chakra-sjIlidOs.js";import{S as F,ao as $,ac as C,m as ee,L as b,o as te,f as Le,a as Ne,q as J,t as K,v as U,C as Ie,c as Pe,l as we,_ as Be,R as Re,T as Me,H as We,j as ze}from"./index--5STxKHF.js";import{u as ke,b as r}from"./react-hBmrxY6U.js";import{c as Ze}from"./graph-_hHJsW04.js";import{s as S}from"./stations-UUVejM1T.js";const V=[F.ShmetroBasic2020],_e=(a,s,o)=>{const i=a.getNodeAttribute(s,"type"),n=structuredClone(a.getNodeAttribute(s,i).names);for(let l=0;l<Math.abs(S[o].defaultAttrs.names.length-n.length);l++)S[o].defaultAttrs.names.length>n.length?n.push("Stn"):n.pop();const e={...S[o].defaultAttrs,names:n};(!Object.values(V).includes(i)||!Object.values(V).includes(o))&&(e.nameOffsetX=a.getNodeAttribute(s,i).nameOffsetX,e.nameOffsetY=a.getNodeAttribute(s,i).nameOffsetY),$.includes(o)&&$.includes(i)&&(e.color=structuredClone(a.getNodeAttribute(s,i).color)),a.removeNodeAttribute(s,i),a.mergeNodeAttributes(s,{type:o,[o]:e})},De=(a,s,o,i)=>i.filter(n=>s==="any"||a.getNodeAttribute(n,"type")===s).forEach(n=>{_e(a,n,o)}),He=(a,s,o)=>{const i=a.getEdgeAttribute(s,"type"),n=a.getEdgeAttribute(s,"style");if(C[n].metadata.supportLinePathType.includes(o)){a.removeEdgeAttribute(s,i);const e=structuredClone(ee[o].defaultAttrs);a.mergeEdgeAttributes(s,{type:o,[o]:e})}},qe=(a,s,o,i)=>i.filter(n=>s==="any"||a.getEdgeAttribute(n,"type")===s).forEach(n=>{He(a,n,o)}),Xe=(a,s,o,i)=>{const n=a.getEdgeAttribute(s,"type"),e=a.getEdgeAttribute(s,"style");if(C[o].metadata.supportLinePathType.includes(n)){const l=a.getEdgeAttribute(s,"zIndex"),h=a.getEdgeAttribute(s,e);a.removeEdgeAttribute(s,e);const g=structuredClone(C[o].defaultAttrs);b.includes(e)&&b.includes(o)?g.color=h.color:b.includes(o)&&i&&(g.color=i),a.mergeEdgeAttributes(s,{style:o,[o]:g}),o===te.River?a.setEdgeAttribute(s,"zIndex",-5):a.setEdgeAttribute(s,"zIndex",l!=null?l:0)}},Ye=(a,s,o,i,n)=>n.filter(e=>s==="any"||a.getEdgeAttribute(e,"style")===s).forEach(e=>{Xe(a,e,o,i)}),Ge=(a,s,o,i)=>i.filter(n=>b.includes(a.getEdgeAttribute(n,"style"))).forEach(n=>{const e=a.getEdgeAttributes(n),l=e[e.style].color;(s==="any"||l[0]==s[0]&&l[1]==s[1]&&l[2]==s[2]&&l[3]==s[3])&&a.mergeEdgeAttributes(n,{[e.style]:{color:o}})}),Qe=(a,s,o,i,n)=>{[...i,...n].forEach(e=>{const l=a.getNodeAttributes(e).type,h=a.getNodeAttribute(e,l);if(h.color!==void 0){const g=h.color;(s==="any"||g[0]==s[0]&&g[1]==s[1]&&g[2]==s[2]&&g[3]==s[3])&&(h.color=o)}a.mergeNodeAttributes(e,{[l]:h})})},$e=(a,s,o,i,n)=>{[...s,...o].forEach(e=>{a.setNodeAttribute(e,"zIndex",n)}),i.forEach(e=>{a.setEdgeAttribute(e,"zIndex",n)})},et=a=>{const{isOpen:s,onClose:o,isSelect:i,filter:n}=a,{t:e}=ke(),l=Le(),{selected:h,theme:g,paletteAppClip:{output:y}}=Ne(t=>t.runtime),se=r.useCallback(()=>{l(J()),l(K()),l(U(u.current.export()))},[l,J,K,U]),u=r.useRef(window.graph),R={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(ee).map(([t,d])=>[t,e(d.metadata.displayName).toString()]))},M={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(C).map(([t,d])=>[t,e(d.metadata.displayName).toString()]))},W={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(S).map(([t,d])=>[t,e(d.metadata.displayName).toString()]))},A={id:"any",theme:[Ie.Other,"other","#ffffff",Pe.black],value:e("header.settings.procedures.changeType.any")},[T,z]=r.useState(!1),[k,Z]=r.useState(0),[x,_]=r.useState(!1),[j,ne]=r.useState("any"),[E,ae]=r.useState(F.ShmetroBasic),[O,D]=r.useState(!1),[v,oe]=r.useState("any"),[L,ie]=r.useState(te.SingleColor),[N,H]=r.useState(!1),[I,ce]=r.useState("any"),[P,le]=r.useState(we.Diagonal),[w,q]=r.useState(!1),[m,X]=r.useState(A),[B,re]=r.useState(g),[de,Y]=r.useState(!1);r.useEffect(()=>{de&&y&&(re(y),Y(!1))},[y==null?void 0:y.toString()]);const[ue,he]=r.useState([]),ge=[{id:"changeZIndex",title:e("header.settings.procedures.changeZIndex"),onClose:()=>z(!T),field:[{type:"select",label:e("panel.details.info.zIndex"),value:k,options:Object.fromEntries(Array.from({length:11},(t,d)=>[d-5,(d-5).toString()])),onChange:t=>Z(Number(t))}]},{id:"changeStationType",title:e("header.settings.procedures.changeStationType.title"),onClose:()=>_(!x),field:[{type:"select",label:e("header.settings.procedures.changeStationType.changeFrom"),options:W,value:j,disabledOptions:[E],onChange:t=>ne(t)},{type:"select",label:e("header.settings.procedures.changeStationType.changeTo"),options:W,value:E,disabledOptions:["any",j],onChange:t=>ae(t)}]},{id:"changeLineStyleType",title:e("header.settings.procedures.changeLineStyleType.title"),onClose:()=>D(!O),field:[{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeFrom"),options:M,value:v,disabledOptions:[L],onChange:t=>oe(t)},{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeTo"),options:M,value:L,disabledOptions:["any",v],onChange:t=>ie(t)}]},{id:"changeLinePathType",title:e("header.settings.procedures.changeLinePathType.title"),onClose:()=>H(!N),field:[{type:"select",label:e("header.settings.procedures.changeLinePathType.changeFrom"),options:R,value:I,disabledOptions:[P],onChange:t=>ce(t)},{type:"select",label:e("header.settings.procedures.changeLinePathType.changeTo"),options:R,value:P,disabledOptions:["any","simple",I],onChange:t=>le(t)}]},{id:"changeColor",title:e("header.settings.procedures.changeColor.title"),onClose:()=>q(!w),field:[{type:"custom",label:e("header.settings.procedures.changeColor.changeFrom"),component:c.jsx(Be,{data:ue,displayHandler:t=>c.jsx(Re,{name:t.value,fg:t.theme[3],bg:t.theme[2],title:t.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(t,d)=>d.id.toLowerCase().includes(t.toLowerCase())||Object.values(d.id).some(f=>f.toLowerCase().includes(t.toLowerCase())),value:m.value,onChange:t=>X(t)})},{type:"custom",label:e("header.settings.procedures.changeColor.changeTo"),component:c.jsx(Me,{theme:B,onClick:()=>{Y(!0),l(We(g))}})}]}];r.useEffect(()=>{s&&(z(!1),_(!1),D(!1),H(!1),q(!1),Z(0),he([A,...Ze(u.current,i?[...h].filter(t=>t.startsWith("stn")||t.startsWith("misc_node")):u.current.nodes(),i?[...h].filter(t=>t.startsWith("line")):u.current.edges()).map(t=>({id:t.toString(),theme:t,value:t[1]==="other"?t[2]:t[1]}))]),X(A))},[s]);const pe=()=>{const t=n!=null&&n.includes("station")?[...h].filter(p=>p.startsWith("stn")):i?[]:u.current.filterNodes(p=>p.startsWith("stn")),d=n!=null&&n.includes("misc-node")?[...h].filter(p=>p.startsWith("misc_node")):i?[]:u.current.filterNodes(p=>p.startsWith("misc_node")),f=i?[...h].filter(p=>p.startsWith("line")):u.current.edges();(!n||n.includes("station"))&&x&&De(u.current,j,E,t),(!n||n.includes("line"))&&O&&Ye(u.current,v,L,g,f),(!n||n.includes("line"))&&N&&qe(u.current,I,P,f),w&&((!n||n.includes("line"))&&Ge(u.current,m.id==="any"?"any":m.theme,B,f),(!n||n.includes("misc-node")||n.includes("station"))&&Qe(u.current,m.id==="any"?"any":m.theme,B,t,d)),T&&$e(u.current,t,d,f,k),se(),o()};return c.jsxs(fe,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[c.jsx(ye,{}),c.jsxs(me,{children:[c.jsxs(be,{children:[c.jsx(G,{as:"b",fontSize:"xl",children:e(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),c.jsx(Se,{})]}),c.jsx(Ce,{children:c.jsx(Ae,{allowMultiple:!0,children:ge.map(t=>c.jsxs(Te,{children:[c.jsxs(xe,{onClick:t.onClose,children:[c.jsx(je,{as:"span",flex:"1",textAlign:"left",children:c.jsx(G,{as:"b",fontSize:"md",children:t.title})}),c.jsx(Ee,{})]}),c.jsx(Oe,{pb:4,children:c.jsx(ze,{fields:t.field,minW:270})})]},t.id))})}),c.jsxs(ve,{children:[c.jsx(Q,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:e("cancel")}),c.jsx(Q,{colorScheme:"red",mr:"1",onClick:pe,isDisabled:!T&&!x&&!O&&!N&&!w,children:e("apply")})]})]})]})};export{et as C,Xe as a,_e as b,He as c};
