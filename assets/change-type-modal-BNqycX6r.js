import{j as c,at as Se,$ as Ce,au as Ae,a1 as Te,a4 as Q,a2 as xe,a3 as je,aV as Ee,aW as Oe,aX as Le,B as ve,aY as Ie,aZ as Ne,a5 as Pe,O as $,aM as Be}from"./chakra-xNcrfRXW.js";import{S as b,aK as J,at as A,l as ne,k as ae,m as we,L as S,o as oe,c as Re,d as W,q as F,t as ee,v as te,C as Me,M as We,Q as ke,R as ze,V as Ze,W as _e,i as De}from"./index-T5lxQXkJ.js";import{u as Xe,b as r}from"./react-D-_si4LB.js";import{s as C,e as Ye}from"./master-manager-DWJdXOvp.js";const se=[b.ShmetroBasic2020,b.LondonTubeBasic,b.ShanghaiSuburbanRailway],qe=(n,s,o)=>{const i=n.getNodeAttribute(s,"type"),a=structuredClone(n.getNodeAttribute(s,i).names);for(let l=0;l<Math.abs(C[o].defaultAttrs.names.length-a.length);l++)C[o].defaultAttrs.names.length>a.length?a.push("Stn"):a.pop();const e={...C[o].defaultAttrs,names:a};(!Object.values(se).includes(i)||!Object.values(se).includes(o))&&(e.nameOffsetX=n.getNodeAttribute(s,i).nameOffsetX,e.nameOffsetY=n.getNodeAttribute(s,i).nameOffsetY),J.includes(o)&&J.includes(i)&&(e.color=structuredClone(n.getNodeAttribute(s,i).color)),n.removeNodeAttribute(s,i),n.mergeNodeAttributes(s,{type:o,[o]:e})},He=(n,s,o,i)=>i.filter(a=>s==="any"||n.getNodeAttribute(a,"type")===s).forEach(a=>{qe(n,a,o)}),Ue=(n,s,o,i)=>{const a=n.getEdgeAttribute(s,"type"),e=n.getEdgeAttribute(s,"style");if(A[e].metadata.supportLinePathType.includes(o)){const l=structuredClone(ne[o].defaultAttrs);let d=-1;if(i&&o!==ae.Simple){const[u,f]=n.extremities(s),T=l.startFrom;d=we(n,o,u,f,T)}n.setEdgeAttribute(s,"parallelIndex",d),n.removeEdgeAttribute(s,a),n.mergeEdgeAttributes(s,{type:o,[o]:l})}},Ve=(n,s,o,i,a)=>i.filter(e=>s==="any"||n.getEdgeAttribute(e,"type")===s).forEach(e=>{Ue(n,e,o,a)}),Ge=(n,s,o,i)=>{const a=n.getEdgeAttribute(s,"type"),e=n.getEdgeAttribute(s,"style");if(A[o].metadata.supportLinePathType.includes(a)){const l=n.getEdgeAttribute(s,"zIndex"),d=n.getEdgeAttribute(s,e);n.removeEdgeAttribute(s,e);const u=structuredClone(A[o].defaultAttrs);S.includes(e)&&S.includes(o)?u.color=d.color:S.includes(o)&&i&&(u.color=i),n.mergeEdgeAttributes(s,{style:o,[o]:u}),o===oe.River?n.setEdgeAttribute(s,"zIndex",-5):n.setEdgeAttribute(s,"zIndex",l!=null?l:0)}},Ke=(n,s,o,i,a)=>a.filter(e=>s==="any"||n.getEdgeAttribute(e,"style")===s).forEach(e=>{Ge(n,e,o,i)}),Qe=(n,s,o,i)=>i.filter(a=>S.includes(n.getEdgeAttribute(a,"style"))).forEach(a=>{const e=n.getEdgeAttributes(a),l=e[e.style].color;(s==="any"||l[0]==s[0]&&l[1]==s[1]&&l[2]==s[2]&&l[3]==s[3])&&n.mergeEdgeAttributes(a,{[e.style]:{color:o}})}),$e=(n,s,o,i,a)=>{[...i,...a].forEach(e=>{const l=n.getNodeAttributes(e).type,d=n.getNodeAttribute(e,l);if(d.color!==void 0){const u=d.color;(s==="any"||u[0]==s[0]&&u[1]==s[1]&&u[2]==s[2]&&u[3]==s[3])&&(d.color=o)}n.mergeNodeAttributes(e,{[l]:d})})},Je=(n,s,o,i,a)=>{[...s,...o].forEach(e=>{n.setNodeAttribute(e,"zIndex",a)}),i.forEach(e=>{n.setEdgeAttribute(e,"zIndex",a)})},nt=n=>{const{isOpen:s,onClose:o,isSelect:i,filter:a}=n,{t:e}=Xe(),l=Re(),{selected:d,theme:u,paletteAppClip:{output:f}}=W(t=>t.runtime),{preference:{autoParallel:T}}=W(t=>t.app),{activeSubscriptions:k}=W(t=>t.account),ie=r.useCallback(()=>{l(F()),l(ee()),l(te(p.current.export()))},[l,F,ee,te]),p=r.useRef(window.graph),z={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(ne).map(([t,h])=>[t,e(h.metadata.displayName).toString()]))},Z={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(A).map(([t,h])=>[t,e(h.metadata.displayName).toString()]))},_={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(C).map(([t,h])=>[t,e(h.metadata.displayName).toString()]))},x={id:"any",theme:[Me.Other,"other","#ffffff",We.black],value:e("header.settings.procedures.changeType.any")},[j,D]=r.useState(!1),[X,Y]=r.useState(0),[E,q]=r.useState(!1),[O,le]=r.useState("any"),[L,ce]=r.useState(b.ShmetroBasic),[v,H]=r.useState(!1),[I,re]=r.useState("any"),[N,de]=r.useState(oe.SingleColor),[P,U]=r.useState(!1),[B,ue]=r.useState("any"),[w,he]=r.useState(ae.Diagonal),[R,V]=r.useState(!1),[m,G]=r.useState(x),[M,pe]=r.useState(u),[ge,K]=r.useState(!1);r.useEffect(()=>{ge&&f&&(pe(f),K(!1))},[f==null?void 0:f.toString()]);const[fe,ye]=r.useState([]),me=[{id:"changeZIndex",title:e("header.settings.procedures.changeZIndex"),onClose:()=>D(!j),field:[{type:"select",label:e("panel.details.info.zIndex"),value:X,options:Object.fromEntries(Array.from({length:11},(t,h)=>[h-5,(h-5).toString()])),onChange:t=>Y(Number(t))}]},{id:"changeStationType",title:e("header.settings.procedures.changeStationType.title"),onClose:()=>q(!E),field:[{type:"select",label:e("header.settings.procedures.changeStationType.changeFrom"),options:_,value:O,disabledOptions:[L],onChange:t=>le(t)},{type:"select",label:e("header.settings.procedures.changeStationType.changeTo"),options:_,value:L,disabledOptions:["any",O],onChange:t=>ce(t)}]},{id:"changeLineStyleType",title:e("header.settings.procedures.changeLineStyleType.title"),onClose:()=>H(!v),field:[{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeFrom"),options:Z,value:I,disabledOptions:[N],onChange:t=>re(t)},{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeTo"),options:Z,value:N,disabledOptions:["any",I],onChange:t=>de(t)}]},{id:"changeLinePathType",title:e("header.settings.procedures.changeLinePathType.title"),onClose:()=>U(!P),field:[{type:"select",label:e("header.settings.procedures.changeLinePathType.changeFrom"),options:z,value:B,disabledOptions:[w],onChange:t=>ue(t)},{type:"select",label:e("header.settings.procedures.changeLinePathType.changeTo"),options:z,value:w,disabledOptions:["any","simple",B],onChange:t=>he(t)}]},{id:"changeColor",title:e("header.settings.procedures.changeColor.title"),onClose:()=>V(!R),field:[{type:"custom",label:e("header.settings.procedures.changeColor.changeFrom"),component:c.jsx(ke,{data:fe,displayHandler:t=>c.jsx(ze,{name:t.value,fg:t.theme[3],bg:t.theme[2],title:t.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(t,h)=>h.id.toLowerCase().includes(t.toLowerCase())||Object.values(h.id).some(y=>y.toLowerCase().includes(t.toLowerCase())),value:m.value,onChange:t=>G(t)})},{type:"custom",label:e("header.settings.procedures.changeColor.changeTo"),component:c.jsx(Ze,{theme:M,onClick:()=>{K(!0),l(_e(u))}})}]}];r.useEffect(()=>{s&&(D(!1),q(!1),H(!1),U(!1),V(!1),Y(0),ye([x,...Ye(p.current,i?[...d].filter(t=>t.startsWith("stn")||t.startsWith("misc_node")):p.current.nodes(),i?[...d].filter(t=>t.startsWith("line")):p.current.edges()).map(t=>({id:t.toString(),theme:t,value:t[1]==="other"?t[2]:t[1]}))]),G(x))},[s]);const be=()=>{const t=a!=null&&a.includes("station")?[...d].filter(g=>g.startsWith("stn")):i?[]:p.current.filterNodes(g=>g.startsWith("stn")),h=a!=null&&a.includes("misc-node")?[...d].filter(g=>g.startsWith("misc_node")):i?[]:p.current.filterNodes(g=>g.startsWith("misc_node")),y=i?[...d].filter(g=>g.startsWith("line")):p.current.edges();(!a||a.includes("station"))&&E&&He(p.current,O,L,t),(!a||a.includes("line"))&&v&&Ke(p.current,I,N,u,y),(!a||a.includes("line"))&&P&&Ve(p.current,B,w,y,T),R&&((!a||a.includes("line"))&&Qe(p.current,m.id==="any"?"any":m.theme,M,y),(!a||a.includes("misc-node")||a.includes("station"))&&$e(p.current,m.id==="any"?"any":m.theme,M,t,h)),j&&Je(p.current,t,h,y,X),ie(),o()};return c.jsxs(Se,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[c.jsx(Ce,{}),c.jsxs(Ae,{children:[c.jsxs(Te,{children:[c.jsx(Q,{as:"b",fontSize:"xl",children:e(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),c.jsx(xe,{})]}),c.jsx(je,{children:c.jsx(Ee,{allowMultiple:!0,children:me.map(t=>c.jsxs(Oe,{children:[c.jsxs(Le,{onClick:t.onClose,children:[c.jsx(ve,{as:"span",flex:"1",textAlign:"left",children:c.jsx(Q,{as:"b",fontSize:"md",children:t.title})}),c.jsx(Ie,{})]}),c.jsx(Ne,{pb:4,children:c.jsx(De,{fields:t.field,minW:270})})]},t.id))})}),c.jsxs(Pe,{children:[c.jsx($,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:e("cancel")}),c.jsx(Be,{label:e("header.settings.pro"),isOpen:!k.RMP_CLOUD,children:c.jsx($,{colorScheme:"red",mr:"1",onClick:be,isDisabled:!k.RMP_CLOUD||!j&&!E&&!v&&!P&&!R,children:e("apply")})})]})]})]})};export{nt as C,Ge as a,qe as b,Ue as c};
