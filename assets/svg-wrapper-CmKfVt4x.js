import{j as N}from"./chakra-C3T8NphC.js";import{l as q,o as X,an as kt,ao as Et,ap as yt,e as St,a as et,aq as Z,ar as G,as as nt,U as Q,at as pt,au as xt,av as U,t as ht,v as lt,S as Ct,aw as gt,n as tt,m as It,p as mt,r as ot,E as rt,w as dt,y as ut,V as R,ax as Nt,D as Dt,a0 as Mt,A as at,z as vt,a7 as H,ak as jt,al as _t}from"./index-B6b8-P2I.js";import{b as j}from"./react-DV6nCJb6.js";import{u as z,e as Lt,i as Tt}from"./clipboard-CO7diKSX.js";import{s as it,u as $t,f as Kt,F as Wt,l as Bt,b as zt,c as Ot}from"./stations-C40IfkzD.js";import{m as ct}from"./misc-nodes-CKlvIQLj.js";const wt=(t,s,h,d,n,u,l)=>{if(!("offsetFrom"in l)||!("offsetTo"in l)||Number.isNaN(l.offsetFrom)||Number.isNaN(l.offsetTo))return;if(l.offsetFrom===l.offsetTo)return bt(s,h,d,n,u)?{x1:h,y1:d,x2:n,y2:u,offset:l.offsetFrom}:void 0;const[A,o]=[l.offsetFrom,l.offsetTo];for(let f=0;f<Math.PI;f+=Math.PI/8)for(let i=f,x=0;x<2;x++,i+=Math.PI){const[S,m,g,E]=[Math.sin(f)*A,Math.cos(f)*A,Math.sin(i)*o,Math.cos(i)*o];if(bt(s,h+S,d+m,n+g,u+E))return{x1:h+S,y1:d+m,x2:n+g,y2:u+E,offset:0}}},bt=(t,s,h,d,n)=>!!((s===d||h===n)&&[q.Diagonal,q.Perpendicular].includes(t)||Math.abs((n-h)/(d-s))===1&&[q.Diagonal,q.RotatePerpendicular].includes(t)),Yt=(t,s)=>{const h=[],d=[];return Object.values(s).forEach(n=>{var L;if(n.length===1){d.push(...n.map(a=>a.edge));return}const u=t.getEdgeAttribute(n.at(0),"type");if(!n.every(a=>t.getEdgeAttribute(a,"type")===u)){d.push(...n.map(a=>a.edge));return}const l=t.getEdgeAttribute(n.at(0),"style");if(!n.every(a=>t.getEdgeAttribute(a,"style")===l)){d.push(...n.map(a=>a.edge));return}const A={},o=new Set,f=new Set,i=Object.fromEntries(n.map(a=>{var p,C;const[D,r]=t.extremities(a);return A[D]=((p=A[D])!=null?p:0)+1,A[r]=((C=A[r])!=null?C:0)+1,o.add(D),f.add(r),[D,[a.edge,r]]})),x=Array.from(o).filter(a=>A[a]===1),S=Array.from(f).filter(a=>A[a]===1);if(x.length!==1||S.length!==1){d.push(...n.map(a=>a.edge));return}const m=x[0],g=S[0];if(m===g){d.push(...n.map(a=>a.edge));return}const E=[i[m][0]];let w=i[m][1];for(let a=1;a<n.length;a=a+1){const D=(L=i[w])==null?void 0:L.at(1);if(!D){d.push(...n.map(r=>r.edge));return}E.push(i[w][0]),w=D}if(w!==g||E.length!==n.length){d.push(...n.map(a=>a.edge));return}h.push(E)}),{allReconciledLines:h,danglingLines:d}},Vt=(t,s)=>{if(!s.every(n=>t.hasEdge(n)))return;const h=s.map(n=>{var S,m,g;const[u,l]=t.extremities(n),A=t.getNodeAttributes(u),o=t.getNodeAttributes(l),f=t.getEdgeAttribute(n,"type"),i=(S=t.getEdgeAttribute(n,f))!=null?S:X[f].defaultAttrs,x=wt(n,f,A.x,A.y,o.x,o.y,i);if(x){const{x1:E,y1:w,x2:L,y2:a,offset:D}=x;return X[q.Simple].generatePath(E,L,w,a,{offset:D})}return(g=(m=X[f])==null?void 0:m.generatePath(A.x,o.x,A.y,o.y,i))!=null?g:"M ".concat(A.x," ").concat(A.y," L ").concat(o.x," ").concat(o.y)});let d="".concat(h[0]," ");for(let n=1;n<s.length;n=n+1)d+=h[n].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return d},Xt=t=>[...t.nodeEntries()].map(s=>s.node.startsWith("stn")?{id:s.node,type:"station",station:s.attributes}:{id:s.node,type:"misc-node",miscNode:s.attributes}),Ut=t=>{const s={},h=[],d={},n=[];for(const o of t.edgeEntries()){const[f,i,x,S]=[o.sourceAttributes.x,o.sourceAttributes.y,o.targetAttributes.x,o.targetAttributes.y],m=wt(o.edge,o.attributes.type,f,i,x,S,o.attributes[o.attributes.type]);if(!m){if(o.attributes.parallelIndex>=0){h.push(o);continue}}if(o.attributes.reconcileId!==""){const g=o.attributes.reconcileId;g in d?d[g].push(o):d[g]=[o];continue}if(m){const g=o.edge,E=o.attributes,{x1:w,y1:L,x2:a,y2:D,offset:r}=m;s[g]={id:g,attr:E,path:X[q.Simple].generatePath(w,a,L,D,{offset:r})};continue}n.push(o)}const u=new Set;for(;h.length;){const o=h.pop();if(u.has(o.edge))continue;const{normal:f,parallel:i}=kt(t,o);if(!i.length)continue;i.forEach(S=>u.add(S.edge)),n.push(...f);const x=Et(i);for(const S of i){const m=S.edge;s[m]={id:S.edge,attr:S.attributes,path:x[m]}}}const{allReconciledLines:l,danglingLines:A}=Yt(t,d);for(const o of l){const f=Vt(t,o);if(!f)continue;const i=o[0];s[i]={id:i,attr:t.getEdgeAttributes(i),path:f}}for(const o of A){const f=t.getEdgeAttributes(o),[i,x]=t.extremities(o),S=t.getNodeAttributes(i),m=t.getNodeAttributes(x);s[o]={id:o,attr:f,path:X[q.Simple].generatePath(S.x,m.x,S.y,m.y,X[q.Simple].defaultAttrs)}}for(const o of n){const f=o.edge,i=o.attributes.type,x=o.attributes,[S,m,g,E]=[o.sourceAttributes.x,o.sourceAttributes.y,o.targetAttributes.x,o.targetAttributes.y];if(!(i in X)){s[f]={id:f,attr:x,path:"M ".concat(S," ").concat(m," L ").concat(g," ").concat(E)};continue}s[f]={id:f,attr:x,path:X[i].generatePath(S,g,m,E,x[i])}}return Object.values(s).map(o=>({id:o.id,type:"line",line:o}))},At=t=>{const{id:s,x:h,y:d,handlePointerDown:n,handlePointerMove:u,handlePointerUp:l}=t,A=j.useCallback(i=>n(s,i),[s,n]),o=j.useCallback(i=>u(s,i),[s,u]),f=j.useCallback(i=>l(s,i),[s,l]);return N.jsx("g",{id:s,transform:"translate(".concat(h-6.4," ").concat(d-6.4,")scale(0.025)"),onPointerDown:A,onPointerMove:o,onPointerUp:f,style:{cursor:"move"},children:N.jsx("path",{id:"stn_core_".concat(s),fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},Ft=t=>{const{id:s,path:h,handlePointerDown:d}=t,n=j.useCallback(u=>d(s,u),[s,d]);return N.jsx("path",{id:s,d:h,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:n})},Rt=t=>{var o,f,i,x,S,m,g,E,w,L,a,D;const{elements:s,handlePointerDown:h,handlePointerMove:d,handlePointerUp:n,handleEdgePointerDown:u}=t,l=Object.fromEntries(Array.from({length:21},(r,p)=>[p-10,{pre:[],main:[],post:[]}]));for(const r of s)if(r.type==="line"){const p=r.line.attr.type,C=r.line.attr.style,$=r.line.attr[C],v=(o=yt[C])==null?void 0:o.preComponent;v&&l[r.line.attr.zIndex].pre.push(N.jsx(v,{id:r.id,type:p,path:r.line.path,styleAttrs:$,newLine:!1,handlePointerDown:u},"".concat(r.id,".pre")));const P=(i=(f=yt[C])==null?void 0:f.component)!=null?i:Ft;l[r.line.attr.zIndex].main.push(N.jsx(P,{id:r.id,type:p,path:r.line.path,styleAttrs:$,newLine:!1,handlePointerDown:u},r.id));const _=(x=yt[C])==null?void 0:x.postComponent;_&&l[r.line.attr.zIndex].post.push(N.jsx(_,{id:r.id,type:p,path:r.line.path,styleAttrs:$,newLine:!1,handlePointerDown:u},"".concat(r.id,".post")))}else if(r.type==="station"){const p=r.station,C=p.type,$=(S=it[C])==null?void 0:S.preComponent;$&&l[r.station.zIndex].pre.push(N.jsx($,{id:r.id,x:p.x,y:p.y,attrs:p,handlePointerDown:h,handlePointerMove:d,handlePointerUp:n},"".concat(r.id,".pre")));const v=(g=(m=it[C])==null?void 0:m.component)!=null?g:At;l[r.station.zIndex].main.push(N.jsx(v,{id:r.id,x:p.x,y:p.y,attrs:p,handlePointerDown:h,handlePointerMove:d,handlePointerUp:n},r.id));const P=(E=it[C])==null?void 0:E.postComponent;P&&l[r.station.zIndex].post.push(N.jsx(P,{id:r.id,x:p.x,y:p.y,attrs:p,handlePointerDown:h,handlePointerMove:d,handlePointerUp:n},"".concat(r.id,".post")))}else if(r.type==="misc-node"){const p=r.miscNode,C=p.type,$=(w=ct[C])==null?void 0:w.preComponent;$&&l[r.miscNode.zIndex].pre.push(N.jsx($,{id:r.id,x:p.x,y:p.y,attrs:p[C],handlePointerDown:h,handlePointerMove:d,handlePointerUp:n},"".concat(r.id,".pre")));const v=(a=(L=ct[C])==null?void 0:L.component)!=null?a:At;l[r.miscNode.zIndex].main.push(N.jsx(v,{id:r.id,x:p.x,y:p.y,attrs:p[C],handlePointerDown:h,handlePointerMove:d,handlePointerUp:n},r.id));const P=(D=ct[C])==null?void 0:D.postComponent;P&&l[r.miscNode.zIndex].post.push(N.jsx(P,{id:r.id,x:p.x,y:p.y,attrs:p[C],handlePointerDown:h,handlePointerMove:d,handlePointerUp:n},"".concat(r.id,".post")))}return Array.from({length:21},(r,p)=>(p-10).toString()).map(r=>[...l[r].pre,...l[r].main,...l[r].post]).flat()},Zt=()=>{const t=St(),s=j.useRef(window.graph),h=()=>{t(ht()),t(lt()),t(dt(s.current.export()))},{telemetry:{project:d},preference:{autoParallel:n}}=et(v=>v.app),{svgViewBoxZoom:u,svgViewBoxMin:l}=et(v=>v.param),{selected:A,refresh:{nodes:o,edges:f},mode:i,active:x,keepLastPath:S,theme:m}=et(v=>v.runtime),[g,E]=j.useState({x:0,y:0}),[w,L]=j.useState({x:0,y:0}),a=z((v,P)=>{P.stopPropagation(),i==="select"&&t(Z("free"));const _=P.currentTarget,{x:W,y:O}=G(P);_.setPointerCapture(P.pointerId),E({x:W,y:O}),t(nt(v)),P.shiftKey?A.has(v)?t(pt(v)):t(xt(v)):A.has(v)||t(Q(new Set([v])))}),D=z((v,P)=>{const{x:_,y:W}=G(P);i==="free"&&x===v?(A.forEach(O=>{s.current.hasNode(O)&&s.current.updateNodeAttributes(O,T=>({...T,x:U(T.x-(g.x-_)*u/100,P.altKey?1:5),y:U(T.y-(g.y-W)*u/100,P.altKey?1:5)}))}),t(ht()),t(lt())):i.startsWith("line")&&L({x:(g.x-_)*u/100,y:(g.y-W)*u/100})}),r=z((v,P)=>{if(i.startsWith("line")){S||t(Z("free"));const _=[...Object.values(Ct),gt.Virtual,gt.Master],W=s.current.hasNode(x)&&_.includes(s.current.getNodeAttribute(x,"type"));["stn_core_","virtual_circle_"].forEach(T=>{var J,K;const B=(K=(J=document.elementsFromPoint(P.clientX,P.clientY)[0].attributes)==null?void 0:J.getNamedItem("id"))==null?void 0:K.value,st=B==null?void 0:B.startsWith(T);if(W&&st){const Y=i.slice(5),e="line_".concat(tt(10)),[c,y]=[x,B.slice(T.length)],I=n?It(s.current,Y,c,y,"from"):-1;s.current.addDirectedEdgeWithKey(e,c,y,{visible:!0,zIndex:0,type:Y,[Y]:structuredClone(X[Y].defaultAttrs),style:mt.SingleColor,[mt.SingleColor]:{color:m},reconcileId:"",parallelIndex:I}),d&&ot.event(rt.ADD_LINE,{type:Y})}}),t(lt()),t(dt(s.current.export()))}else if(i==="free"&&x){const{x:_,y:W}=G(P);g.x-_===0&&g.y-W===0||t(dt(s.current.export()))}t(nt(void 0))}),p=z((v,P)=>{if(P.stopPropagation(),P.shiftKey||t(ut()),P.shiftKey&&A.has(v)?t(pt(v)):t(xt(v)),i.startsWith("station")||i.startsWith("misc-node-virtual")||i.startsWith("misc-node-master")){const _=P.clientX-document.getElementById("canvas").getBoundingClientRect().left,W=P.clientY-document.getElementById("canvas").getBoundingClientRect().top,O=i.startsWith("station"),T=tt(10),F=O?"stn_".concat(T):"misc_node_".concat(T),B=O?i.slice(8):i.slice(10),{x:st,y:J}=R(_,W,u,l),K=O?structuredClone(it[B].defaultAttrs):structuredClone(ct[B].defaultAttrs);"color"in K&&(K.color=m),s.current.addNode(F,{visible:!0,zIndex:0,x:U(st,5),y:U(J,5),type:B,[B]:K});const Y=s.current.getEdgeAttributes(v),{zIndex:e,type:c,style:y}=Y,I=Y[c],k=Y[y],[b,M]=s.current.extremities(v),V=n?0:-1;s.current.addDirectedEdgeWithKey("line_".concat(tt(10)),b,F,{visible:!0,zIndex:e,type:c,[c]:structuredClone(I),style:y,[y]:structuredClone(k),reconcileId:"",parallelIndex:V}),s.current.addDirectedEdgeWithKey("line_".concat(tt(10)),F,M,{visible:!0,zIndex:e,type:c,[c]:structuredClone(I),style:y,[y]:structuredClone(k),reconcileId:"",parallelIndex:V}),s.current.dropEdge(v),h(),d&&(ot.event(rt.ADD_STATION,{type:B}),ot.event(rt.ADD_LINE,{type:c})),t(Z("free")),t(Q(new Set([F])))}}),C=j.useMemo(()=>[...Ut(s.current),...Xt(s.current)],[f,o]),$=Nt.component;return N.jsxs(N.Fragment,{children:[N.jsx(Rt,{elements:C,handlePointerDown:a,handlePointerMove:D,handlePointerUp:r,handleEdgePointerDown:p}),i.startsWith("line")&&x&&x!=="background"&&N.jsx($,{id:"line_create_in_progress___no_use",type:i.slice(5),path:X[i.slice(5)].generatePath(s.current.getNodeAttribute(x,"x"),s.current.getNodeAttribute(x,"x")-w.x,s.current.getNodeAttribute(x,"y"),s.current.getNodeAttribute(x,"y")-w.y,X[i.slice(5)].defaultAttrs),styleAttrs:{color:m},newLine:!0,handlePointerDown:()=>{}})]})},ee=()=>{const t=St(),s=j.useRef(window.graph),h=()=>{t(ht()),t(lt()),t(dt(s.current.export()))},{telemetry:{project:d}}=et(e=>e.app),{svgViewBoxZoom:n,svgViewBoxMin:u}=et(e=>e.param),{mode:l,lastTool:A,active:o,selected:f,keepLastPath:i,theme:x,refresh:{nodes:S}}=et(e=>e.runtime),m=$t(),{height:g,width:E}=Dt(m);j.useEffect(()=>{const e=Kt(s.current);Object.entries(e).filter(([c,y])=>y&&c in Wt).forEach(([c])=>Bt(c))},[S]);const[w,L]=j.useState({x:0,y:0}),[a,D]=j.useState({x:0,y:0}),[r,p]=j.useState({x:0,y:0}),[C,$]=j.useState({x:0,y:0}),v=z(e=>{const{x:c,y}=G(e);if(l.startsWith("station")){t(Z("free"));const I=tt(10),k="stn_".concat(I),b=l.slice(8),M=structuredClone(it[b].defaultAttrs);"color"in M&&(M.color=x);const{x:V,y:ft}=R(c,y,n,u);s.current.addNode(k,{visible:!0,zIndex:0,x:U(V,5),y:U(ft,5),type:b,[b]:M}),h(),d&&ot.event(rt.ADD_STATION,{type:b}),t(Q(new Set([k])))}else if(l.startsWith("misc-node")){t(Z("free"));const I=tt(10),k="misc_node_".concat(I),b=l.slice(10),{x:M,y:V}=R(c,y,n,u);s.current.addNode(k,{visible:!0,zIndex:0,x:U(M,5),y:U(V,5),type:b,[b]:structuredClone(ct[b].defaultAttrs)}),h(),d&&ot.event(rt.ADD_STATION,{type:b}),t(Q(new Set([k])))}else l==="free"||l.startsWith("line")?(l.startsWith("line")&&(t(Z("free")),i&&t(Mt(!1))),p({x:c,y}),$(u),e.shiftKey||(t(nt("background")),t(ut()))):l==="select"&&(L(R(c,y,n,u)),D(R(c,y,n,u)))}),P=z(e=>{if(l==="select"){if(w.x!=0&&w.y!=0){const{x:c,y}=G(e);D(R(c,y,n,u))}}else if(o==="background"){const{x:c,y}=G(e);t(at({x:C.x+(r.x-c)*n/100,y:C.y+(r.y-y)*n/100}))}}),_=z(e=>{if(l==="select"){const{x:c,y}=G(e),{x:I,y:k}=R(c,y,n,u),b=zt(s.current,w.x,w.y,I,k),M=Ot(s.current,new Set(b));t(Q(new Set([...e.shiftKey?f:[],...b,...M]))),t(Z("free")),L({x:0,y:0}),D({x:0,y:0})}o==="background"&&!e.shiftKey&&t(nt(void 0))}),W=z(e=>{let c=n;e.deltaY>0&&n+10<400?c=n+10:e.deltaY<0&&n-10>0&&(c=n-10),t(vt(c));const{x:y,y:I}=G(e),k=e.currentTarget.getBoundingClientRect(),[b,M]=[y/k.width,I/k.height];t(at({x:u.x+y*n/100-E*c/100*b,y:u.y+I*n/100-g*c/100*M}))}),O=z(async e=>{if(H?e.key==="Backspace":e.key==="Delete")f.size>0&&(f.forEach(c=>{s.current.hasNode(c)?s.current.dropNode(c):s.current.hasEdge(c)&&s.current.dropEdge(c)}),t(ut()),h());else if(e.key.startsWith("Arrow")){const y=e.key.endsWith("Left")?-1:e.key.endsWith("Right")?1:0,I=e.key.endsWith("Up")?-1:e.key.endsWith("Down")?1:0;t(at(R(100*y,100*I,n,u)))}else if(e.key==="i"||e.key==="j"||e.key==="k"||e.key==="l"){const y=(e.key==="j"?-1:e.key==="l"?1:0)*10,I=(e.key==="i"?-1:e.key==="k"?1:0)*10;f.size>0&&f.forEach(k=>{s.current.hasNode(k)&&(s.current.updateNodeAttribute(k,"x",b=>(b!=null?b:0)+y),s.current.updateNodeAttribute(k,"y",b=>(b!=null?b:0)+I),h())})}else if(e.key==="f"&&A)t(Z(A));else if(e.key==="z"&&(H?e.metaKey&&!e.shiftKey:e.ctrlKey))H&&e.preventDefault(),t(jt()),h();else if(e.key==="s")t(Z("select"));else if((e.key==="c"||e.key==="x")&&(H?e.metaKey&&!e.shiftKey:e.ctrlKey)){const c=Lt(s.current,f);navigator.clipboard.writeText(c),e.key==="x"&&(t(ut()),f.forEach(y=>{s.current.hasNode(y)?s.current.dropNode(y):s.current.hasEdge(y)&&s.current.dropEdge(y)}),h())}else if(e.key==="v"&&(H?e.metaKey&&!e.shiftKey:e.ctrlKey)){const c=await navigator.clipboard.readText(),{x:y,y:I}=R(E/2,g/2,n,u),{nodes:k,edges:b}=Tt(c,s.current,U(y,5),U(I,5));h();const M=structuredClone(k);b.forEach(V=>M.add(V)),t(Q(M))}else(H&&e.key==="z"&&e.metaKey&&e.shiftKey||!H&&e.key==="y"&&e.ctrlKey)&&(t(_t()),h())}),[T,F]=j.useState(0),B=z(e=>{if(e.touches.length===2){t(nt(void 0));const[c,y]=[e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY];F(c*c+y*y)}}),st=z(e=>{if(T!==0&&e.touches.length===2){const[c,y]=[e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY],I=c*c+y*y;let k=n;I-T<0&&n+10<=390?k=n+10:I-T>0&&n-10>=10&&(k=n-10),t(vt(k)),F(I);const b=e.currentTarget.getBoundingClientRect(),[M,V]=[(e.touches[0].clientX+e.touches[1].clientX)/2-b.left,(e.touches[0].clientY+e.touches[1].clientY)/2-b.top],[ft,Pt]=[M/b.width,V/b.height];t(at({x:u.x+M*n/100-E*k/100*ft,y:u.y+V*n/100-g*k/100*Pt}))}}),J=z(e=>{T!==0&&F(0)}),[K,Y]=j.useState({sx:0,sy:0,ex:0,ey:0});return j.useEffect(()=>{Y({sx:w.x<=a.x?w.x:a.x,ex:w.x>a.x?w.x:a.x,sy:w.y<=a.y?w.y:a.y,ey:w.y>a.y?w.y:a.y})},[a.x,a.y]),N.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:g,width:E,viewBox:"".concat(u.x," ").concat(u.y," ").concat(E*n/100," ").concat(g*n/100),onPointerDown:v,onPointerMove:P,onPointerUp:_,onTouchStart:B,onTouchMove:st,onTouchEnd:J,onWheel:W,tabIndex:0,onKeyDown:O,children:[N.jsx(Zt,{}),l==="select"&&w.x!=0&&w.y!=0&&N.jsx("rect",{x:K.sx,y:K.sy,width:K.ex-K.sx,height:K.ey-K.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),N.jsx("defs",{children:N.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[N.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),N.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})};export{ee as default};
