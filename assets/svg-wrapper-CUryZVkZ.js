import{j as C}from"./chakra-Dqj68bqe.js";import{l as Q,o as X,an as Dt,ao as Nt,ap as gt,e as Et,a as st,aq as R,ar as J,as as ct,U as ot,at as mt,au as vt,av as V,t as at,v as it,S as It,aw as bt,n as rt,m as Mt,p as At,r as lt,E as dt,w as ht,y as pt,V as F,ax as _t,D as jt,ay as Lt,a0 as Tt,A as yt,z as St,a7 as et,ak as $t,al as Kt}from"./index-DspUkl9i.js";import{b as _}from"./react-DV6nCJb6.js";import{u as B,e as Wt,i as Bt}from"./clipboard-Djj6WMgJ.js";import{s as ut,u as zt,f as Ot,F as Yt,l as Xt,b as Ut,c as Vt}from"./master-manager-aBdOwaxj.js";import{m as ft}from"./misc-nodes-CnzmwXLY.js";const kt=(t,s,y,d,i,c,a)=>{if(!("offsetFrom"in a)||!("offsetTo"in a)||Number.isNaN(a.offsetFrom)||Number.isNaN(a.offsetTo))return;if(a.offsetFrom===a.offsetTo)return wt(s,y,d,i,c)?{x1:y,y1:d,x2:i,y2:c,offset:a.offsetFrom}:void 0;const[f,n]=[a.offsetFrom,a.offsetTo];for(let h=0;h<Math.PI;h+=Math.PI/8)for(let o=h,x=0;x<2;x++,o+=Math.PI){const[w,m,A,D]=[Math.sin(h)*f,Math.cos(h)*f,Math.sin(o)*n,Math.cos(o)*n];if(wt(s,y+w,d+m,i+A,c+D))return{x1:y+w,y1:d+m,x2:i+A,y2:c+D,offset:0}}},wt=(t,s,y,d,i)=>!!((s===d||y===i)&&[Q.Diagonal,Q.Perpendicular].includes(t)||Math.abs((i-y)/(d-s))===1&&[Q.Diagonal,Q.RotatePerpendicular].includes(t)),Ft=(t,s)=>{const y=[],d=[];return Object.values(s).forEach(i=>{var M;if(i.length===1){d.push(...i.map(p=>p.edge));return}const c=t.getEdgeAttribute(i.at(0),"type");if(!i.every(p=>t.getEdgeAttribute(p,"type")===c)){d.push(...i.map(p=>p.edge));return}const a=t.getEdgeAttribute(i.at(0),"style");if(!i.every(p=>t.getEdgeAttribute(p,"style")===a)){d.push(...i.map(p=>p.edge));return}const f={},n=new Set,h=new Set,o=Object.fromEntries(i.map(p=>{var l,k;const[v,r]=t.extremities(p);return f[v]=((l=f[v])!=null?l:0)+1,f[r]=((k=f[r])!=null?k:0)+1,n.add(v),h.add(r),[v,[p.edge,r]]})),x=Array.from(n).filter(p=>f[p]===1),w=Array.from(h).filter(p=>f[p]===1);if(x.length!==1||w.length!==1){d.push(...i.map(p=>p.edge));return}const m=x[0],A=w[0];if(m===A){d.push(...i.map(p=>p.edge));return}const D=[o[m][0]];let N=o[m][1];for(let p=1;p<i.length;p=p+1){const v=(M=o[N])==null?void 0:M.at(1);if(!v){d.push(...i.map(r=>r.edge));return}D.push(o[N][0]),N=v}if(N!==A||D.length!==i.length){d.push(...i.map(p=>p.edge));return}y.push(D)}),{allReconciledLines:y,danglingLines:d}},Rt=(t,s)=>{if(!s.every(i=>t.hasEdge(i)))return;const y=s.map(i=>{var w,m,A;const[c,a]=t.extremities(i),f=t.getNodeAttributes(c),n=t.getNodeAttributes(a),h=t.getEdgeAttribute(i,"type"),o=(w=t.getEdgeAttribute(i,h))!=null?w:X[h].defaultAttrs,x=kt(i,h,f.x,f.y,n.x,n.y,o);if(x){const{x1:D,y1:N,x2:M,y2:p,offset:v}=x;return X[Q.Simple].generatePath(D,M,N,p,{offset:v})}return(A=(m=X[h])==null?void 0:m.generatePath(f.x,n.x,f.y,n.y,o))!=null?A:"M ".concat(f.x," ").concat(f.y," L ").concat(n.x," ").concat(n.y)});let d="".concat(y[0]," ");for(let i=1;i<s.length;i=i+1)d+=y[i].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return d},Zt=t=>[...t.nodeEntries()].map(s=>s.node.startsWith("stn")?{id:s.node,type:"station",station:s.attributes}:{id:s.node,type:"misc-node",miscNode:s.attributes}),Gt=t=>{const s={},y=[],d={},i=[];for(const n of t.edgeEntries()){const[h,o,x,w]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y],m=kt(n.edge,n.attributes.type,h,o,x,w,n.attributes[n.attributes.type]);if(!m){if(n.attributes.parallelIndex>=0){y.push(n);continue}}if(n.attributes.reconcileId!==""){const A=n.attributes.reconcileId;A in d?d[A].push(n):d[A]=[n];continue}if(m){const A=n.edge,D=n.attributes,{x1:N,y1:M,x2:p,y2:v,offset:r}=m;s[A]={id:A,attr:D,path:X[Q.Simple].generatePath(N,p,M,v,{offset:r})};continue}i.push(n)}const c=new Set;for(;y.length;){const n=y.pop();if(c.has(n.edge))continue;const{normal:h,parallel:o}=Dt(t,n);if(!o.length)continue;o.forEach(w=>c.add(w.edge)),i.push(...h);const x=Nt(o);for(const w of o){const m=w.edge;s[m]={id:w.edge,attr:w.attributes,path:x[m]}}}const{allReconciledLines:a,danglingLines:f}=Ft(t,d);for(const n of a){const h=Rt(t,n);if(!h)continue;const o=n[0];s[o]={id:o,attr:t.getEdgeAttributes(o),path:h}}for(const n of f){const h=t.getEdgeAttributes(n),[o,x]=t.extremities(n),w=t.getNodeAttributes(o),m=t.getNodeAttributes(x);s[n]={id:n,attr:h,path:X[Q.Simple].generatePath(w.x,m.x,w.y,m.y,X[Q.Simple].defaultAttrs)}}for(const n of i){const h=n.edge,o=n.attributes.type,x=n.attributes,[w,m,A,D]=[n.sourceAttributes.x,n.sourceAttributes.y,n.targetAttributes.x,n.targetAttributes.y];if(!(o in X)){s[h]={id:h,attr:x,path:"M ".concat(w," ").concat(m," L ").concat(A," ").concat(D)};continue}s[h]={id:h,attr:x,path:X[o].generatePath(w,A,m,D,x[o])}}return Object.values(s).map(n=>({id:n.id,type:"line",line:n}))},Pt=t=>{const{id:s,x:y,y:d,handlePointerDown:i,handlePointerMove:c,handlePointerUp:a}=t,f=_.useCallback(o=>i(s,o),[s,i]),n=_.useCallback(o=>c(s,o),[s,c]),h=_.useCallback(o=>a(s,o),[s,a]);return C.jsx("g",{id:s,transform:"translate(".concat(y-6.4," ").concat(d-6.4,")scale(0.025)"),onPointerDown:f,onPointerMove:n,onPointerUp:h,style:{cursor:"move"},children:C.jsx("path",{id:"stn_core_".concat(s),fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},qt=t=>{const{id:s,path:y,handlePointerDown:d}=t,i=_.useCallback(c=>d(s,c),[s,d]);return C.jsx("path",{id:s,d:y,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:i})},Ht=t=>{var n,h,o,x,w,m,A,D,N,M,p,v;const{elements:s,handlePointerDown:y,handlePointerMove:d,handlePointerUp:i,handleEdgePointerDown:c}=t,a=Object.fromEntries(Array.from({length:21},(r,l)=>[l-10,{pre:[],main:[],post:[]}]));for(const r of s)if(r.type==="line"){const l=r.line.attr.type,k=r.line.attr.style,$=r.line.attr[k],b=(n=gt[k])==null?void 0:n.preComponent;b&&a[r.line.attr.zIndex].pre.push(C.jsx(b,{id:r.id,type:l,path:r.line.path,styleAttrs:$,newLine:!1,handlePointerDown:c},"".concat(r.id,".pre")));const S=(o=(h=gt[k])==null?void 0:h.component)!=null?o:qt;a[r.line.attr.zIndex].main.push(C.jsx(S,{id:r.id,type:l,path:r.line.path,styleAttrs:$,newLine:!1,handlePointerDown:c},r.id));const L=(x=gt[k])==null?void 0:x.postComponent;L&&a[r.line.attr.zIndex].post.push(C.jsx(L,{id:r.id,type:l,path:r.line.path,styleAttrs:$,newLine:!1,handlePointerDown:c},"".concat(r.id,".post")))}else if(r.type==="station"){const l=r.station,k=l.type,$=(w=ut[k])==null?void 0:w.preComponent;$&&a[r.station.zIndex].pre.push(C.jsx($,{id:r.id,x:l.x,y:l.y,attrs:l,handlePointerDown:y,handlePointerMove:d,handlePointerUp:i},"".concat(r.id,".pre")));const b=(A=(m=ut[k])==null?void 0:m.component)!=null?A:Pt;a[r.station.zIndex].main.push(C.jsx(b,{id:r.id,x:l.x,y:l.y,attrs:l,handlePointerDown:y,handlePointerMove:d,handlePointerUp:i},r.id));const S=(D=ut[k])==null?void 0:D.postComponent;S&&a[r.station.zIndex].post.push(C.jsx(S,{id:r.id,x:l.x,y:l.y,attrs:l,handlePointerDown:y,handlePointerMove:d,handlePointerUp:i},"".concat(r.id,".post")))}else if(r.type==="misc-node"){const l=r.miscNode,k=l.type,$=(N=ft[k])==null?void 0:N.preComponent;$&&a[r.miscNode.zIndex].pre.push(C.jsx($,{id:r.id,x:l.x,y:l.y,attrs:l[k],handlePointerDown:y,handlePointerMove:d,handlePointerUp:i},"".concat(r.id,".pre")));const b=(p=(M=ft[k])==null?void 0:M.component)!=null?p:Pt;a[r.miscNode.zIndex].main.push(C.jsx(b,{id:r.id,x:l.x,y:l.y,attrs:l[k],handlePointerDown:y,handlePointerMove:d,handlePointerUp:i},r.id));const S=(v=ft[k])==null?void 0:v.postComponent;S&&a[r.miscNode.zIndex].post.push(C.jsx(S,{id:r.id,x:l.x,y:l.y,attrs:l[k],handlePointerDown:y,handlePointerMove:d,handlePointerUp:i},"".concat(r.id,".post")))}return Array.from({length:21},(r,l)=>(l-10).toString()).map(r=>[...a[r].pre,...a[r].main,...a[r].post]).flat()},Jt=()=>{const t=Et(),s=_.useRef(window.graph),y=()=>{t(at()),t(it()),t(ht(s.current.export()))},{telemetry:{project:d},preference:{autoParallel:i}}=st(b=>b.app),{svgViewBoxZoom:c,svgViewBoxMin:a}=st(b=>b.param),{selected:f,refresh:{nodes:n,edges:h},mode:o,active:x,keepLastPath:w,theme:m}=st(b=>b.runtime),[A,D]=_.useState({x:0,y:0}),[N,M]=_.useState({x:0,y:0}),p=B((b,S)=>{S.stopPropagation(),o==="select"&&t(R("free"));const L=S.currentTarget,{x:K,y:z}=J(S);L.setPointerCapture(S.pointerId),D({x:K,y:z}),t(ct(b)),S.shiftKey?f.has(b)?t(mt(b)):t(vt(b)):f.has(b)||t(ot(new Set([b])))}),v=B((b,S)=>{const{x:L,y:K}=J(S);o==="free"&&x===b?(f.forEach(z=>{s.current.hasNode(z)&&s.current.updateNodeAttributes(z,O=>({...O,x:V(O.x-(A.x-L)*c/100,S.altKey?1:5),y:V(O.y-(A.y-K)*c/100,S.altKey?1:5)}))}),t(at()),t(it())):o.startsWith("line")&&M({x:(A.x-L)*c/100,y:(A.y-K)*c/100})}),r=B((b,S)=>{if(o.startsWith("line")){w||t(R("free"));const L=[...Object.values(It),bt.Virtual,bt.Master],K=s.current.hasNode(x)&&L.includes(s.current.getNodeAttribute(x,"type"));["stn_core_","virtual_circle_"].forEach(O=>{var G,q;const W=(q=(G=document.elementsFromPoint(S.clientX,S.clientY)[0].attributes)==null?void 0:G.getNamedItem("id"))==null?void 0:q.value,Z=W==null?void 0:W.startsWith(O);if(K&&Z){const Y=o.slice(5),nt="line_".concat(rt(10)),[j,U]=[x,W.slice(O.length)],e=i?Mt(s.current,Y,j,U,"from"):-1;s.current.addDirectedEdgeWithKey(nt,j,U,{visible:!0,zIndex:0,type:Y,[Y]:structuredClone(X[Y].defaultAttrs),style:At.SingleColor,[At.SingleColor]:{color:m},reconcileId:"",parallelIndex:e}),d&&lt.event(dt.ADD_LINE,{type:Y})}}),t(it()),t(ht(s.current.export()))}else if(o==="free"&&x){const{x:L,y:K}=J(S);A.x-L===0&&A.y-K===0||t(ht(s.current.export()))}t(ct(void 0))}),l=B((b,S)=>{if(S.stopPropagation(),S.shiftKey||t(pt()),S.shiftKey&&f.has(b)?t(mt(b)):t(vt(b)),o.startsWith("station")||o.startsWith("misc-node-virtual")||o.startsWith("misc-node-master")){const L=S.clientX-document.getElementById("canvas").getBoundingClientRect().left,K=S.clientY-document.getElementById("canvas").getBoundingClientRect().top,z=o.startsWith("station"),O=rt(10),tt=z?"stn_".concat(O):"misc_node_".concat(O),W=z?o.slice(8):o.slice(10),{x:Z,y:G}=F(L,K,c,a),q=z?structuredClone(ut[W].defaultAttrs):structuredClone(ft[W].defaultAttrs);"color"in q&&(q.color=m),s.current.addNode(tt,{visible:!0,zIndex:0,x:V(Z,5),y:V(G,5),type:W,[W]:q});const Y=s.current.getEdgeAttributes(b),{zIndex:nt,type:j,style:U}=Y,e=Y[j],u=Y[U],[g,I]=s.current.extremities(b),E=i?0:-1;s.current.addDirectedEdgeWithKey("line_".concat(rt(10)),g,tt,{visible:!0,zIndex:nt,type:j,[j]:structuredClone(e),style:U,[U]:structuredClone(u),reconcileId:"",parallelIndex:E}),s.current.addDirectedEdgeWithKey("line_".concat(rt(10)),tt,I,{visible:!0,zIndex:nt,type:j,[j]:structuredClone(e),style:U,[U]:structuredClone(u),reconcileId:"",parallelIndex:E}),s.current.dropEdge(b),y(),d&&(lt.event(dt.ADD_STATION,{type:W}),lt.event(dt.ADD_LINE,{type:j})),t(R("free")),t(ot(new Set([tt])))}}),k=_.useMemo(()=>[...Gt(s.current),...Zt(s.current)],[h,n]),$=_t.component;return C.jsxs(C.Fragment,{children:[C.jsx(Ht,{elements:k,handlePointerDown:p,handlePointerMove:v,handlePointerUp:r,handleEdgePointerDown:l}),o.startsWith("line")&&x&&x!=="background"&&C.jsx($,{id:"line_create_in_progress___no_use",type:o.slice(5),path:X[o.slice(5)].generatePath(s.current.getNodeAttribute(x,"x"),s.current.getNodeAttribute(x,"x")-N.x,s.current.getNodeAttribute(x,"y"),s.current.getNodeAttribute(x,"y")-N.y,X[o.slice(5)].defaultAttrs),styleAttrs:{color:m},newLine:!0,handlePointerDown:()=>{}})]})},re=()=>{const t=Et(),s=_.useRef(window.graph),y=()=>{t(at()),t(it()),t(ht(s.current.export()))},{activeSubscriptions:d}=st(e=>e.account),{telemetry:{project:i}}=st(e=>e.app),{svgViewBoxZoom:c,svgViewBoxMin:a}=st(e=>e.param),{mode:f,lastTool:n,active:h,selected:o,keepLastPath:x,theme:w,refresh:{nodes:m},masterNodesCount:A}=st(e=>e.runtime),D=zt(),{height:N,width:M}=jt(D),p=!d.RMP_CLOUD&&A+1>Lt;_.useEffect(()=>{const e=Ot(s.current);Object.entries(e).filter(([u,g])=>g&&u in Yt).forEach(([u])=>Xt(u))},[m]);const[v,r]=_.useState({x:0,y:0}),[l,k]=_.useState({x:0,y:0}),[$,b]=_.useState({x:0,y:0}),[S,L]=_.useState({x:0,y:0}),K=B(e=>{const{x:u,y:g}=J(e);if(f.startsWith("station")){t(R("free"));const I=rt(10),E="stn_".concat(I),P=f.slice(8),T=structuredClone(ut[P].defaultAttrs);"color"in T&&(T.color=w);const{x:H,y:xt}=F(u,g,c,a);s.current.addNode(E,{visible:!0,zIndex:0,x:V(H,5),y:V(xt,5),type:P,[P]:T}),y(),i&&lt.event(dt.ADD_STATION,{type:P}),t(ot(new Set([E])))}else if(f.startsWith("misc-node")){t(R("free"));const I=rt(10),E="misc_node_".concat(I),P=f.slice(10),{x:T,y:H}=F(u,g,c,a);s.current.addNode(E,{visible:!0,zIndex:0,x:V(T,5),y:V(H,5),type:P,[P]:structuredClone(ft[P].defaultAttrs)}),y(),i&&lt.event(dt.ADD_STATION,{type:P}),t(ot(new Set([E])))}else f==="free"||f.startsWith("line")?(f.startsWith("line")&&(t(R("free")),x&&t(Tt(!1))),b({x:u,y:g}),L(a),e.shiftKey||(t(ct("background")),t(pt()))):f==="select"&&(r(F(u,g,c,a)),k(F(u,g,c,a)))}),z=B(e=>{if(f==="select"){if(v.x!=0&&v.y!=0){const{x:u,y:g}=J(e);k(F(u,g,c,a))}}else if(h==="background"){const{x:u,y:g}=J(e);t(yt({x:S.x+($.x-u)*c/100,y:S.y+($.y-g)*c/100}))}}),O=B(e=>{if(f==="select"){const{x:u,y:g}=J(e),{x:I,y:E}=F(u,g,c,a),P=Ut(s.current,v.x,v.y,I,E),T=Vt(s.current,new Set(P));t(ot(new Set([...e.shiftKey?o:[],...P,...T]))),t(R("free")),r({x:0,y:0}),k({x:0,y:0})}h==="background"&&!e.shiftKey&&t(ct(void 0))}),tt=B(e=>{let u=c;e.deltaY>0&&c+10<400?u=c+10:e.deltaY<0&&c-10>0&&(u=c-10),t(St(u));const{x:g,y:I}=J(e),E=e.currentTarget.getBoundingClientRect(),[P,T]=[g/E.width,I/E.height];t(yt({x:a.x+g*c/100-M*u/100*P,y:a.y+I*c/100-N*u/100*T}))}),W=B(async e=>{if(et?e.key==="Backspace":e.key==="Delete")o.size>0&&(o.forEach(u=>{s.current.hasNode(u)?s.current.dropNode(u):s.current.hasEdge(u)&&s.current.dropEdge(u)}),t(pt()),y());else if(e.key.startsWith("Arrow")){const g=e.key.endsWith("Left")?-1:e.key.endsWith("Right")?1:0,I=e.key.endsWith("Up")?-1:e.key.endsWith("Down")?1:0;t(yt(F(100*g,100*I,c,a)))}else if(e.key==="i"||e.key==="j"||e.key==="k"||e.key==="l"){const g=(e.key==="j"?-1:e.key==="l"?1:0)*10,I=(e.key==="i"?-1:e.key==="k"?1:0)*10;o.size>0&&o.forEach(E=>{s.current.hasNode(E)&&(s.current.updateNodeAttribute(E,"x",P=>(P!=null?P:0)+g),s.current.updateNodeAttribute(E,"y",P=>(P!=null?P:0)+I),y())})}else if(e.key==="f"&&n)t(R(n));else if(e.key==="z"&&(et?e.metaKey&&!e.shiftKey:e.ctrlKey))et&&e.preventDefault(),t($t()),t(at()),t(it());else if(e.key==="s")t(R("select"));else if((e.key==="c"||e.key==="x")&&(et?e.metaKey&&!e.shiftKey:e.ctrlKey)){const u=Wt(s.current,o);navigator.clipboard.writeText(u),e.key==="x"&&(t(pt()),o.forEach(g=>{s.current.hasNode(g)?s.current.dropNode(g):s.current.hasEdge(g)&&s.current.dropEdge(g)}),y())}else if(e.key==="v"&&(et?e.metaKey&&!e.shiftKey:e.ctrlKey)){const u=await navigator.clipboard.readText(),{x:g,y:I}=F(M/2,N/2,c,a),{nodes:E,edges:P}=Bt(u,s.current,p,V(g,5),V(I,5));y();const T=structuredClone(E);P.forEach(H=>T.add(H)),t(ot(T))}else(et&&e.key==="z"&&e.metaKey&&e.shiftKey||!et&&e.key==="y"&&e.ctrlKey)&&(t(Kt()),t(at()),t(it()))}),[Z,G]=_.useState(0),q=B(e=>{if(e.touches.length===2){t(ct(void 0));const[u,g]=[e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY];G(u*u+g*g)}}),Y=B(e=>{if(Z!==0&&e.touches.length===2){const[u,g]=[e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientY-e.touches[1].clientY],I=u*u+g*g;let E=c;I-Z<0&&c+10<=390?E=c+10:I-Z>0&&c-10>=10&&(E=c-10),t(St(E)),G(I);const P=e.currentTarget.getBoundingClientRect(),[T,H]=[(e.touches[0].clientX+e.touches[1].clientX)/2-P.left,(e.touches[0].clientY+e.touches[1].clientY)/2-P.top],[xt,Ct]=[T/P.width,H/P.height];t(yt({x:a.x+T*c/100-M*E/100*xt,y:a.y+H*c/100-N*E/100*Ct}))}}),nt=B(e=>{Z!==0&&G(0)}),[j,U]=_.useState({sx:0,sy:0,ex:0,ey:0});return _.useEffect(()=>{U({sx:v.x<=l.x?v.x:l.x,ex:v.x>l.x?v.x:l.x,sy:v.y<=l.y?v.y:l.y,ey:v.y>l.y?v.y:l.y})},[l.x,l.y]),C.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:N,width:M,viewBox:"".concat(a.x," ").concat(a.y," ").concat(M*c/100," ").concat(N*c/100),onPointerDown:K,onPointerMove:z,onPointerUp:O,onTouchStart:q,onTouchMove:Y,onTouchEnd:nt,onWheel:tt,tabIndex:0,onKeyDown:W,children:[C.jsx(Jt,{}),f==="select"&&v.x!=0&&v.y!=0&&C.jsx("rect",{x:j.sx,y:j.sy,width:j.ex-j.sx,height:j.ey-j.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),C.jsx("defs",{children:C.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[C.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),C.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})};export{re as default};
