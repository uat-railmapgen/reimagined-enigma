import{j as l,at as fe,$ as ye,au as me,a1 as be,a4 as Y,a2 as Se,a3 as Ce,aM as Ae,aN as Te,aO as xe,B as je,aP as Ee,aQ as Oe,a5 as Le,O as Q}from"./chakra-D_OByU5d.js";import{S as F,ao as $,ab as C,l as ee,L as b,m as te,e as Ne,a as ve,p as J,q as K,t as U,C as Ie,b as Pe,k as we,Z as Be,R as Re,T as Me,G as We,i as ze}from"./index-COuyUzdX.js";import{u as ke,b as r}from"./react-BuIY-1St.js";import{s as S,n as Ze}from"./stations-D2eZAWwX.js";const V=[F.ShmetroBasic2020],_e=(a,s,o)=>{const i=a.getNodeAttribute(s,"type"),n=structuredClone(a.getNodeAttribute(s,i).names);for(let c=0;c<Math.abs(S[o].defaultAttrs.names.length-n.length);c++)S[o].defaultAttrs.names.length>n.length?n.push("Stn"):n.pop();const e={...S[o].defaultAttrs,names:n};(!Object.values(V).includes(i)||!Object.values(V).includes(o))&&(e.nameOffsetX=a.getNodeAttribute(s,i).nameOffsetX,e.nameOffsetY=a.getNodeAttribute(s,i).nameOffsetY),$.includes(o)&&$.includes(i)&&(e.color=structuredClone(a.getNodeAttribute(s,i).color)),a.removeNodeAttribute(s,i),a.mergeNodeAttributes(s,{type:o,[o]:e})},De=(a,s,o,i)=>i.filter(n=>s==="any"||a.getNodeAttribute(n,"type")===s).forEach(n=>{_e(a,n,o)}),qe=(a,s,o)=>{const i=a.getEdgeAttribute(s,"type"),n=a.getEdgeAttribute(s,"style");if(C[n].metadata.supportLinePathType.includes(o)){a.removeEdgeAttribute(s,i);const e=structuredClone(ee[o].defaultAttrs);a.mergeEdgeAttributes(s,{type:o,[o]:e})}},Ge=(a,s,o,i)=>i.filter(n=>s==="any"||a.getEdgeAttribute(n,"type")===s).forEach(n=>{qe(a,n,o)}),He=(a,s,o,i)=>{const n=a.getEdgeAttribute(s,"type"),e=a.getEdgeAttribute(s,"style");if(C[o].metadata.supportLinePathType.includes(n)){const c=a.getEdgeAttribute(s,"zIndex"),h=a.getEdgeAttribute(s,e);a.removeEdgeAttribute(s,e);const g=structuredClone(C[o].defaultAttrs);b.includes(e)&&b.includes(o)?g.color=h.color:b.includes(o)&&i&&(g.color=i),a.mergeEdgeAttributes(s,{style:o,[o]:g}),o===te.River?a.setEdgeAttribute(s,"zIndex",-5):a.setEdgeAttribute(s,"zIndex",c!=null?c:0)}},Xe=(a,s,o,i,n)=>n.filter(e=>s==="any"||a.getEdgeAttribute(e,"style")===s).forEach(e=>{He(a,e,o,i)}),Ye=(a,s,o,i)=>i.filter(n=>b.includes(a.getEdgeAttribute(n,"style"))).forEach(n=>{const e=a.getEdgeAttributes(n),c=e[e.style].color;(s==="any"||c[0]==s[0]&&c[1]==s[1]&&c[2]==s[2]&&c[3]==s[3])&&a.mergeEdgeAttributes(n,{[e.style]:{color:o}})}),Qe=(a,s,o,i,n)=>{[...i,...n].forEach(e=>{const c=a.getNodeAttributes(e).type,h=a.getNodeAttribute(e,c);if(h.color!==void 0){const g=h.color;(s==="any"||g[0]==s[0]&&g[1]==s[1]&&g[2]==s[2]&&g[3]==s[3])&&(h.color=o)}a.mergeNodeAttributes(e,{[c]:h})})},$e=(a,s,o,i,n)=>{[...s,...o].forEach(e=>{a.setNodeAttribute(e,"zIndex",n)}),i.forEach(e=>{a.setEdgeAttribute(e,"zIndex",n)})},Fe=a=>{const{isOpen:s,onClose:o,isSelect:i,filter:n}=a,{t:e}=ke(),c=Ne(),{selected:h,theme:g,paletteAppClip:{output:y}}=ve(t=>t.runtime),se=r.useCallback(()=>{c(J()),c(K()),c(U(u.current.export()))},[c,J,K,U]),u=r.useRef(window.graph),R={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(ee).map(([t,d])=>[t,e(d.metadata.displayName).toString()]))},M={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(C).map(([t,d])=>[t,e(d.metadata.displayName).toString()]))},W={any:e("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(S).map(([t,d])=>[t,e(d.metadata.displayName).toString()]))},A={id:"any",theme:[Ie.Other,"other","#ffffff",Pe.black],value:e("header.settings.procedures.changeType.any")},[T,z]=r.useState(!1),[k,Z]=r.useState(0),[x,_]=r.useState(!1),[j,ne]=r.useState("any"),[E,ae]=r.useState(F.ShmetroBasic),[O,D]=r.useState(!1),[L,oe]=r.useState("any"),[N,ie]=r.useState(te.SingleColor),[v,q]=r.useState(!1),[I,le]=r.useState("any"),[P,ce]=r.useState(we.Diagonal),[w,G]=r.useState(!1),[m,H]=r.useState(A),[B,re]=r.useState(g),[de,X]=r.useState(!1);r.useEffect(()=>{de&&y&&(re(y),X(!1))},[y==null?void 0:y.toString()]);const[ue,he]=r.useState([]),ge=[{id:"changeZIndex",title:e("header.settings.procedures.changeZIndex"),onClose:()=>z(!T),field:[{type:"select",label:e("panel.details.info.zIndex"),value:k,options:Object.fromEntries(Array.from({length:11},(t,d)=>[d-5,(d-5).toString()])),onChange:t=>Z(Number(t))}]},{id:"changeStationType",title:e("header.settings.procedures.changeStationType.title"),onClose:()=>_(!x),field:[{type:"select",label:e("header.settings.procedures.changeStationType.changeFrom"),options:W,value:j,disabledOptions:[E],onChange:t=>ne(t)},{type:"select",label:e("header.settings.procedures.changeStationType.changeTo"),options:W,value:E,disabledOptions:["any",j],onChange:t=>ae(t)}]},{id:"changeLineStyleType",title:e("header.settings.procedures.changeLineStyleType.title"),onClose:()=>D(!O),field:[{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeFrom"),options:M,value:L,disabledOptions:[N],onChange:t=>oe(t)},{type:"select",label:e("header.settings.procedures.changeLineStyleType.changeTo"),options:M,value:N,disabledOptions:["any",L],onChange:t=>ie(t)}]},{id:"changeLinePathType",title:e("header.settings.procedures.changeLinePathType.title"),onClose:()=>q(!v),field:[{type:"select",label:e("header.settings.procedures.changeLinePathType.changeFrom"),options:R,value:I,disabledOptions:[P],onChange:t=>le(t)},{type:"select",label:e("header.settings.procedures.changeLinePathType.changeTo"),options:R,value:P,disabledOptions:["any","simple",I],onChange:t=>ce(t)}]},{id:"changeColor",title:e("header.settings.procedures.changeColor.title"),onClose:()=>G(!w),field:[{type:"custom",label:e("header.settings.procedures.changeColor.changeFrom"),component:l.jsx(Be,{data:ue,displayHandler:t=>l.jsx(Re,{name:t.value,fg:t.theme[3],bg:t.theme[2],title:t.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(t,d)=>d.id.toLowerCase().includes(t.toLowerCase())||Object.values(d.id).some(f=>f.toLowerCase().includes(t.toLowerCase())),value:m.value,onChange:t=>H(t)})},{type:"custom",label:e("header.settings.procedures.changeColor.changeTo"),component:l.jsx(Me,{theme:B,onClick:()=>{X(!0),c(We(g))}})}]}];r.useEffect(()=>{s&&(z(!1),_(!1),D(!1),q(!1),G(!1),Z(0),he([A,...Ze(u.current,i?[...h].filter(t=>t.startsWith("stn")||t.startsWith("misc_node")):u.current.nodes(),i?[...h].filter(t=>t.startsWith("line")):u.current.edges()).map(t=>({id:t.toString(),theme:t,value:t[1]==="other"?t[2]:t[1]}))]),H(A))},[s]);const pe=()=>{const t=n!=null&&n.includes("station")?[...h].filter(p=>p.startsWith("stn")):i?[]:u.current.filterNodes(p=>p.startsWith("stn")),d=n!=null&&n.includes("misc-node")?[...h].filter(p=>p.startsWith("misc_node")):i?[]:u.current.filterNodes(p=>p.startsWith("misc_node")),f=i?[...h].filter(p=>p.startsWith("line")):u.current.edges();(!n||n.includes("station"))&&x&&De(u.current,j,E,t),(!n||n.includes("line"))&&O&&Xe(u.current,L,N,g,f),(!n||n.includes("line"))&&v&&Ge(u.current,I,P,f),w&&((!n||n.includes("line"))&&Ye(u.current,m.id==="any"?"any":m.theme,B,f),(!n||n.includes("misc-node")||n.includes("station"))&&Qe(u.current,m.id==="any"?"any":m.theme,B,t,d)),T&&$e(u.current,t,d,f,k),se(),o()};return l.jsxs(fe,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[l.jsx(ye,{}),l.jsxs(me,{children:[l.jsxs(be,{children:[l.jsx(Y,{as:"b",fontSize:"xl",children:e(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),l.jsx(Se,{})]}),l.jsx(Ce,{children:l.jsx(Ae,{allowMultiple:!0,children:ge.map(t=>l.jsxs(Te,{children:[l.jsxs(xe,{onClick:t.onClose,children:[l.jsx(je,{as:"span",flex:"1",textAlign:"left",children:l.jsx(Y,{as:"b",fontSize:"md",children:t.title})}),l.jsx(Ee,{})]}),l.jsx(Oe,{pb:4,children:l.jsx(ze,{fields:t.field,minW:270})})]},t.id))})}),l.jsxs(Le,{children:[l.jsx(Q,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:e("cancel")}),l.jsx(Q,{colorScheme:"red",mr:"1",onClick:pe,isDisabled:!T&&!x&&!O&&!v&&!w,children:e("apply")})]})]})]})};export{Fe as C,He as a,_e as b,qe as c};
