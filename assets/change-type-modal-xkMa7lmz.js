import{j as c,at as de,$ as ue,au as he,a1 as pe,a4 as _,a2 as ye,a3 as ge,aM as fe,aN as me,aO as be,B as Se,aP as Te,aQ as Ce,a5 as Ae,O as q}from"./chakra-77DnoTeR.js";import{S as $,ab as S,m as J,L as b,o as K,f as xe,a as je,q as X,t as Y,v as G,C as ve,c as Ee,l as Le,ao as Oe,R as Ne,T as we,H as Pe,j as Be}from"./index-eCpU7cNs.js";import{u as Re,b as l}from"./react-hBmrxY6U.js";import{c as Ie}from"./graph-4Zqjdtj7.js";import{s as U}from"./stations-0qwJ0NEP.js";const Q=[$.ShmetroBasic2020],Me=(a,t,o)=>{const i=a.getNodeAttribute(t,"type"),n=a.getNodeAttribute(t,i).names,s={...U[o].defaultAttrs,names:n};(!Object.values(Q).includes(i)||!Object.values(Q).includes(o))&&(s.nameOffsetX=a.getNodeAttribute(t,i).nameOffsetX,s.nameOffsetY=a.getNodeAttribute(t,i).nameOffsetY),a.removeNodeAttribute(t,i),a.mergeNodeAttributes(t,{type:o,[o]:s})},We=(a,t,o,i)=>i.filter(n=>t==="any"||a.getNodeAttribute(n,"type")===t).forEach(n=>{Me(a,n,o)}),ke=(a,t,o)=>{const i=a.getEdgeAttribute(t,"type"),n=a.getEdgeAttribute(t,"style");if(S[n].metadata.supportLinePathType.includes(o)){a.removeEdgeAttribute(t,i);const s=structuredClone(J[o].defaultAttrs);a.mergeEdgeAttributes(t,{type:o,[o]:s})}},ze=(a,t,o,i)=>i.filter(n=>t==="any"||a.getEdgeAttribute(n,"type")===t).forEach(n=>{ke(a,n,o)}),De=(a,t,o,i)=>{const n=a.getEdgeAttribute(t,"type"),s=a.getEdgeAttribute(t,"style");if(S[o].metadata.supportLinePathType.includes(n)){const r=a.getEdgeAttribute(t,"zIndex"),d=a.getEdgeAttribute(t,s);a.removeEdgeAttribute(t,s);const u=structuredClone(S[o].defaultAttrs);b.includes(s)&&b.includes(o)?u.color=d.color:b.includes(o)&&i&&(u.color=i),a.mergeEdgeAttributes(t,{style:o,[o]:u}),o===K.River?a.setEdgeAttribute(t,"zIndex",-5):a.setEdgeAttribute(t,"zIndex",r!=null?r:0)}},He=(a,t,o,i,n)=>n.filter(s=>t==="any"||a.getEdgeAttribute(s,"style")===t).forEach(s=>{De(a,s,o,i)}),_e=(a,t,o,i)=>i.filter(n=>b.includes(a.getEdgeAttribute(n,"style"))).forEach(n=>{const s=a.getEdgeAttributes(n),r=s[s.style].color;(t==="any"||r[0]==t[0]&&r[1]==t[1]&&r[2]==t[2]&&r[3]==t[3])&&a.mergeEdgeAttributes(n,{[s.style]:{color:o}})}),qe=(a,t,o,i,n)=>{[...i,...n].forEach(s=>{const r=a.getNodeAttributes(s).type,d=a.getNodeAttribute(s,r);if(d.color!==void 0){const u=d.color;(t==="any"||u[0]==t[0]&&u[1]==t[1]&&u[2]==t[2]&&u[3]==t[3])&&(d.color=o)}a.mergeNodeAttributes(s,{[r]:d})})},Je=a=>{const{isOpen:t,onClose:o,isSelect:i,filter:n}=a,{t:s}=Re(),r=xe(),{selected:d,theme:u,paletteAppClip:{output:g}}=je(e=>e.runtime),V=l.useCallback(()=>{r(X()),r(Y()),r(G(h.current.export()))},[r,X,Y,G]),h=l.useRef(window.graph),B={any:s("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(J).map(([e,p])=>[e,s(p.metadata.displayName).toString()]))},R={any:s("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(S).map(([e,p])=>[e,s(p.metadata.displayName).toString()]))},I={any:s("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(U).map(([e,p])=>[e,s(p.metadata.displayName).toString()]))},T={id:"any",theme:[ve.Other,"other","#ffffff",Ee.black],value:s("header.settings.procedures.changeType.any")},[C,M]=l.useState(!1),[A,Z]=l.useState("any"),[x,F]=l.useState($.ShmetroBasic),[j,W]=l.useState(!1),[v,ee]=l.useState("any"),[E,te]=l.useState(K.SingleColor),[L,k]=l.useState(!1),[O,se]=l.useState("any"),[N,ne]=l.useState(Le.Diagonal),[w,z]=l.useState(!1),[f,D]=l.useState(T),[P,ae]=l.useState(u),[oe,H]=l.useState(!1);l.useEffect(()=>{oe&&g&&(ae(g),H(!1))},[g==null?void 0:g.toString()]);const[ie,ce]=l.useState([]),le=[{id:"changeStationType",title:s("header.settings.procedures.changeStationType.title"),onClose:()=>M(!C),field:[{type:"select",label:s("header.settings.procedures.changeStationType.changeFrom"),options:I,value:A,disabledOptions:[x],onChange:e=>Z(e)},{type:"select",label:s("header.settings.procedures.changeStationType.changeTo"),options:I,value:x,disabledOptions:["any",A],onChange:e=>F(e)}]},{id:"changeLineStyleType",title:s("header.settings.procedures.changeLineStyleType.title"),onClose:()=>W(!j),field:[{type:"select",label:s("header.settings.procedures.changeLineStyleType.changeFrom"),options:R,value:v,disabledOptions:[E],onChange:e=>ee(e)},{type:"select",label:s("header.settings.procedures.changeLineStyleType.changeTo"),options:R,value:E,disabledOptions:["any",v],onChange:e=>te(e)}]},{id:"changeLinePathType",title:s("header.settings.procedures.changeLinePathType.title"),onClose:()=>k(!L),field:[{type:"select",label:s("header.settings.procedures.changeLinePathType.changeFrom"),options:B,value:O,disabledOptions:[N],onChange:e=>se(e)},{type:"select",label:s("header.settings.procedures.changeLinePathType.changeTo"),options:B,value:N,disabledOptions:["any","simple",O],onChange:e=>ne(e)}]},{id:"changeColor",title:s("header.settings.procedures.changeColor.title"),onClose:()=>z(!w),field:[{type:"custom",label:s("header.settings.procedures.changeColor.changeFrom"),component:c.jsx(Oe,{data:ie,displayHandler:e=>c.jsx(Ne,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,p)=>p.id.toLowerCase().includes(e.toLowerCase())||Object.values(p.id).some(m=>m.toLowerCase().includes(e.toLowerCase())),value:f.value,onChange:e=>D(e)})},{type:"custom",label:s("header.settings.procedures.changeColor.changeTo"),component:c.jsx(we,{theme:P,onClick:()=>{H(!0),r(Pe(u))}})}]}];l.useEffect(()=>{t&&(M(!1),W(!1),k(!1),z(!1),ce([T,...Ie(h.current,i?[...d].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):h.current.nodes(),i?[...d].filter(e=>e.startsWith("line")):h.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),D(T))},[t]);const re=()=>{const e=n!=null&&n.includes("station")?[...d].filter(y=>y.startsWith("stn")):i?[]:h.current.filterNodes(y=>y.startsWith("stn")),p=n!=null&&n.includes("misc-node")?[...d].filter(y=>y.startsWith("misc_node")):i?[]:h.current.filterNodes(y=>y.startsWith("misc_node")),m=i?[...d].filter(y=>y.startsWith("line")):h.current.edges();(!n||n.includes("station"))&&C&&We(h.current,A,x,e),(!n||n.includes("line"))&&j&&He(h.current,v,E,u,m),(!n||n.includes("line"))&&L&&ze(h.current,O,N,m),w&&((!n||n.includes("line"))&&_e(h.current,f.id==="any"?"any":f.theme,P,m),(!n||n.includes("misc-node")||n.includes("station"))&&qe(h.current,f.id==="any"?"any":f.theme,P,e,p)),V(),o()};return c.jsxs(de,{isOpen:t,onClose:o,size:"md",scrollBehavior:"inside",children:[c.jsx(ue,{}),c.jsxs(he,{children:[c.jsxs(pe,{children:[c.jsx(_,{as:"b",fontSize:"xl",children:s(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),c.jsx(ye,{})]}),c.jsx(ge,{children:c.jsx(fe,{allowMultiple:!0,children:le.map(e=>c.jsxs(me,{children:[c.jsxs(be,{onClick:e.onClose,children:[c.jsx(Se,{as:"span",flex:"1",textAlign:"left",children:c.jsx(_,{as:"b",fontSize:"md",children:e.title})}),c.jsx(Te,{})]}),c.jsx(Ce,{pb:4,children:c.jsx(Be,{fields:e.field,minW:270})})]},e.id))})}),c.jsxs(Ae,{children:[c.jsx(q,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:s("cancel")}),c.jsx(q,{colorScheme:"red",mr:"1",onClick:re,isDisabled:!C&&!j&&!L&&!w,children:s("apply")})]})]})]})};export{Je as C,De as a,Me as b,ke as c};
