import{j as e,$ as L,a0 as z,a1 as ne,s as w,A as J,M as K,m as Q,n as X,p as Y,r as ee,q as B,ae as se}from"./chakra-594c63ee.js";import{c as A,j as C,d as v,D as P,aj as U,z as S,A as b,t as D,N as k,q as ae,v as re,ak as F,al as H,y as N,n as V,am as ie,an as oe,ao as le,ap as ce,p as q}from"./index-2a1688f4.js";import{b as l}from"./react-2c0b8364.js";import{b as de}from"./graph-5c967dec.js";import{s as $}from"./stations-ad6b9935.js";import{d as pe,e as ue,f as he}from"./change-types-98760cbc.js";import{u as G,e as ge}from"./clipboard-66a55036.js";import{m as me}from"./misc-nodes-140b4a21.js";function fe(){const{t:s}=A(),a=C(),{selected:r}=v(t=>t.runtime),i=l.useRef(window.graph),n=t=>{a(P()),a(U(t))};return e.jsxs(L,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[s("panel.details.selected")," ",r.length]}),e.jsx(ne,{m:"var(--chakra-space-1)",children:r.map(t=>{if(!t.startsWith("stn")&&!t.startsWith("misc_node"))return;const o=i.current.getNodeAttributes(t),c=o.type,d=t.startsWith("stn")?o[c].names.join("/"):c;return e.jsx(w,{width:"100%",size:"sm",variant:"solid",onClick:()=>n(t),overflow:"hidden",maxW:"270",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:d},t)})})]})}function xe(){const{t:s}=A(),a=C(),r=l.useCallback(()=>{a(S()),a(b(o.current.export()))},[a,S,b]),{selected:i,theme:n}=v(x=>x.runtime),t=i.at(0),o=l.useRef(window.graph),[c,d]=l.useState(!1),p=l.useRef(null),u=Object.fromEntries(Object.entries(D).map(([x,_])=>[x,s(_.metadata.displayName).toString()])),[h,g]=l.useState(o.current.getEdgeAttribute(t,"type")),[y,m]=l.useState(void 0),f=Object.fromEntries(Object.entries(k).map(([x,_])=>[x,s(_.metadata.displayName).toString()])),[j,I]=l.useState(o.current.getEdgeAttribute(t,"style")),[T,W]=l.useState(void 0),E=Object.values(ae).filter(x=>!k[j].metadata.supportLinePathType.includes(x)),R=Object.values(re).filter(x=>!k[x].metadata.supportLinePathType.includes(h)),O=()=>{y&&(pe(o.current,t,y),g(o.current.getEdgeAttribute(t,"type")),r())},te=()=>{T&&(ue(o.current,t,T,n),I(o.current.getEdgeAttribute(t,"style")),r())},M=x=>{x&&(y?(O(),m(void 0)):T&&(te(),W(void 0))),d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(H,{options:u,disabledOptions:E,defaultValue:h,value:h,onChange:({target:{value:x}})=>{m(x),d(!0)}})}),e.jsx(F,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(H,{options:f,disabledOptions:R,defaultValue:j,value:j,onChange:({target:{value:x}})=>{W(x),d(!0)}})}),e.jsx(J,{isOpen:c,leastDestructiveRef:p,onClose:()=>M(!1),children:e.jsx(K,{children:e.jsxs(Q,{children:[e.jsx(X,{children:s("warning")}),e.jsx(Y,{children:s("panel.details.changeLineTypeContent")}),e.jsxs(ee,{children:[e.jsx(w,{ref:p,onClick:()=>M(!1),children:s("cancel")}),e.jsx(w,{ml:"2",colorScheme:"red",onClick:()=>M(!0),children:s("panel.details.changeType")})]})]})})})]})}function ye(){const{t:s}=A(),a=C(),r=l.useCallback(()=>{a(N()),a(b(t.current.export()))},[a,N,b]),{selected:i}=v(f=>f.runtime),n=i.at(0),t=l.useRef(window.graph),[o,c]=l.useState(!1),d=l.useRef(null),[p,u]=l.useState(void 0),h=t.current.getNodeAttribute(n,"type"),g=Object.fromEntries(Object.entries($).map(([f,j])=>[f,s(j.metadata.displayName).toString()])),y=()=>{p&&(he(t.current,n,p),r())},m=f=>{f&&y(),u(void 0),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.stationType"),minW:"276",children:e.jsx(H,{options:g,disabledOptions:[h],value:h,onChange:({target:{value:f}})=>{u(f),c(!0)}})}),e.jsx(J,{isOpen:o,leastDestructiveRef:d,onClose:()=>m(!1),children:e.jsx(K,{children:e.jsxs(Q,{children:[e.jsx(X,{children:s("warning")}),e.jsx(Y,{children:s("panel.details.changeStationTypeContent")}),e.jsxs(ee,{children:[e.jsx(w,{ref:d,onClick:()=>m(!1),children:s("cancel")}),e.jsx(w,{ml:"2",colorScheme:"red",onClick:()=>m(!0),children:s("panel.details.changeType")})]})]})})})]})}function be(){const{t:s}=A(),a=C(),r=l.useCallback(()=>{a(N()),a(S()),a(b(t.current.export()))},[a,S,b]),{selected:i}=v(d=>d.runtime),n=i.at(0),t=l.useRef(window.graph),o=d=>{const p=Math.min(Math.max(d,-5),5);t.current.hasNode(n)&&t.current.setNodeAttribute(n,"zIndex",p),t.current.hasEdge(n)&&t.current.setEdgeAttribute(n,"zIndex",p),r()},c=[];return i.length===0||(i.length===1?(c.push({type:"input",label:s("panel.details.info.id"),value:n,minW:276}),c.push({type:"select",label:s("panel.details.info.zIndex"),value:n?t.current.hasNode(n)?t.current.getNodeAttribute(n,"zIndex"):t.current.hasEdge(n)?t.current.getEdgeAttribute(n,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(d,p)=>[p-5,(p-5).toString()])),onChange:d=>o(Number(d))})):i.length>1&&c.push({type:"input",label:s("panel.details.info.type"),value:"multiple selection",minW:276})),e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.info.title")}),e.jsx(V,{fields:c,minW:130}),i.length===1&&n.startsWith("stn")&&t.current.hasNode(n)&&t.current.getNodeAttribute(n,"type")in $&&e.jsx(ye,{}),i.length===1&&n.startsWith("line")&&t.current.hasEdge(n)&&t.current.getEdgeAttribute(n,"type")in D&&t.current.getEdgeAttribute(n,"style")in k&&e.jsx(xe,{}),i.length>1&&e.jsx(fe,{})]})}function je(){const{t:s}=A(),a=C(),{selected:r}=v(j=>j.runtime),i=r.at(0),n=l.useRef(window.graph),[t,o]=l.useState("undefined"),[c,d]=l.useState("undefined"),[p,u]=l.useState("undefined"),[h,g]=l.useState("undefined");l.useEffect(()=>{var j,I,T,W;if(i!=null&&i.startsWith("line")){const[E,R]=n.current.extremities(i);if(o(E),d(R),E.startsWith("stn")){const O=n.current.getNodeAttribute(E,"type");u((I=(j=n.current.getNodeAttribute(E,O))==null?void 0:j.names.at(0))!=null?I:"undefined")}if(R.startsWith("stn")){const O=n.current.getNodeAttribute(R,"type");g((W=(T=n.current.getNodeAttribute(R,O))==null?void 0:T.names.at(0))!=null?W:"undefined")}}},[r]);const y=G(()=>{a(P()),a(U(t))}),m=G(()=>{a(P()),a(U(c))}),f=[{type:"custom",label:s("panel.details.lineExtremities.source"),component:e.jsx(w,{flex:1,size:"sm",variant:"link",onClick:y,children:t}),minW:"full"},{type:"input",label:s("panel.details.lineExtremities.sourceName"),value:p,minW:"full"},{type:"custom",label:s("panel.details.lineExtremities.target"),component:e.jsx(w,{flex:1,size:"sm",variant:"link",onClick:m,children:c}),minW:"full"},{type:"input",label:s("panel.details.lineExtremities.targetName"),value:h,minW:"full"}];return e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.lineExtremities.title")}),e.jsx(V,{fields:f,minW:130})]})}function we(){const{t:s}=A(),a=C(),r=l.useCallback(()=>{a(N()),a(S()),a(b(o.current.export()))},[a,N,S,b]),{selected:i,refresh:{nodes:n}}=v(u=>u.runtime),t=i.at(0),o=l.useRef(window.graph),[c,d]=l.useState({x:0,y:0});l.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const u=o.current.getNodeAttribute(t,"x"),h=o.current.getNodeAttribute(t,"y");d({x:u,y:h})}},[n,i]);const p=[{type:"input",label:s("panel.details.nodePosition.pos.x"),value:c.x.toString(),validator:u=>!Number.isNaN(u),onChange:u=>{o.current.mergeNodeAttributes(t,{x:Number(u)}),r()}},{type:"input",label:s("panel.details.nodePosition.pos.y"),value:c.y.toString(),validator:u=>!Number.isNaN(u),onChange:u=>{o.current.mergeNodeAttributes(t,{y:Number(u)}),r()}}];return e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.nodePosition.title")}),e.jsx(V,{fields:p,minW:130})]})}const Z={...$,...me},Se=()=>{var d;const s=C(),{selected:a}=v(p=>p.runtime),{t:r}=A(),i=a.at(0),n=window.graph.getNodeAttribute(i,"type"),t=n in Z&&Z[n].attrsComponent,o=(d=window.graph.getNodeAttribute(i,n))!=null?d:{},c=(p,u)=>{const h=window.graph.getNodeAttribute(p,"type");window.graph.mergeNodeAttributes(p,{[h]:u}),s(N()),s(b(window.graph.export()))};return t?e.jsx(t,{id:i,attrs:o,handleAttrsUpdate:c}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:r("panel.details.unknown.error",{category:r("panel.details.unknown.node")})})},Ne=()=>{var g,y;const s=C(),{selected:a}=v(m=>m.runtime),{t:r}=A(),i=a.at(0),n=window.graph.getEdgeAttribute(i,"type"),t=(g=window.graph.getEdgeAttribute(i,n))!=null?g:{},o=n in D&&D[n].attrsComponent,c=window.graph.getEdgeAttribute(i,"style"),d=(y=window.graph.getEdgeAttribute(i,c))!=null?y:{},p=c in k&&k[c].attrsComponent,u=(m,f)=>{window.graph.mergeEdgeAttributes(m,{[n]:f}),s(S()),s(b(window.graph.export()))},h=(m,f)=>{window.graph.mergeEdgeAttributes(m,{[c]:f}),s(S()),s(b(window.graph.export()))};return e.jsxs(e.Fragment,{children:[o?e.jsx(o,{id:i,attrs:t,handleAttrsUpdate:u}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:r("panel.details.unknown.error",{category:r("panel.details.unknown.linePath")})}),p?e.jsx(p,{id:i,attrs:d,handleAttrsUpdate:h}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:r("panel.details.unknown.error",{category:r("panel.details.unknown.lineStyle")})})]})},Oe=()=>{const{t:s}=A(),a=C(),r=l.useRef(window.graph),i=l.useCallback(()=>{a(N()),a(S()),a(b(r.current.export()))},[a,N,S,b]),{selected:n,mode:t}=v(h=>h.runtime),o=n.at(0),c=()=>a(P()),d=h=>{const g=structuredClone(r.current.getNodeAttributes(h));g.x+=50,g.y+=50;const y=h.startsWith("stn")?`stn_${q(10)}`:`misc_node_${q(10)}`;r.current.addNode(y,g),a(N()),a(b(r.current.export()))},p=h=>{const g=new Set(h),y=de(r.current,g),m=ge(r.current,g,new Set(y));navigator.clipboard.writeText(m)},u=h=>{a(P()),h.forEach(g=>{r.current.hasNode(g)?r.current.dropNode(g):r.current.hasEdge(g)&&r.current.dropEdge(g)}),i()};return e.jsxs(ie,{isOpen:n.length>0&&!t.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(oe,{onClose:c,children:s("panel.details.header")}),e.jsxs(le,{children:[e.jsx(be,{}),n.length===1&&r.current.hasNode(o)&&e.jsx(we,{}),n.length===1&&r.current.hasEdge(o)&&e.jsx(je,{}),n.length===1&&e.jsxs(L,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.specificAttrsTitle")}),window.graph.hasNode(o)&&e.jsx(Se,{}),window.graph.hasEdge(o)&&e.jsx(Ne,{})]})]}),e.jsx(ce,{children:e.jsxs(se,{children:[n.length===1&&r.current.hasNode(n.at(0))&&e.jsx(w,{size:"sm",variant:"outline",onClick:()=>d(n.at(0)),children:s("panel.details.footer.duplicate")}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>p(n),children:s("panel.details.footer.copy")}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>u(n),children:s("panel.details.footer.remove")})]})})]})};export{Oe as default};
