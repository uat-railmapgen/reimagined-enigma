System.register(["./chakra-legacy--ElhKRU8.js","./index-legacy-XK9c6h2z.js","./react-legacy-CB7hQk4J.js","./clipboard-legacy-E-BwqDqT.js","./master-manager-legacy-CGUJeKWB.js","./misc-nodes-legacy-DTLTlSoQ.js"],(function(e,t){"use strict";var n,r,o,s,i,a,l,c,d,u,h,y,p,f,x,g,m,v,b,P,A,w,k,E,N,j,D,I,S,C,_,M,$,z,W,T,K,L,R,O,U,B,F,Y,X,V,Q,q,Z,G,H,J,ee,te;return{setters:[e=>{n=e.j},e=>{r=e.k,o=e.l,s=e.ao,i=e.ap,a=e.aq,l=e.S,c=e.ar,d=e.c,u=e.d,h=e.as,y=e.at,p=e.au,f=e.T,x=e.av,g=e.aw,m=e.ax,v=e.ay,b=e.q,P=e.t,A=e.n,w=e.m,k=e.o,E=e.r,N=e.E,j=e.v,D=e.y,I=e.U,S=e.az,C=e.p,_=e.aA,M=e.a0,$=e.a1,z=e.A,W=e.z,T=e.a9,K=e.al,L=e.am},e=>{R=e.b},e=>{O=e.u,U=e.e,B=e.i},e=>{F=e.s,Y=e.g,X=e.b,V=e.c,Q=e.e,q=e.u,Z=e.f,G=e.F,H=e.l,J=e.h,ee=e.j},e=>{te=e.m}],execute:function(){const t=(e,t,n,r,o,s,i)=>{if(!("offsetFrom"in s)||!("offsetTo"in s))return;if(Number.isNaN(s.offsetFrom)||Number.isNaN(s.offsetTo))return;if(s.offsetFrom===s.offsetTo)return ne(e,t,n,r,o)?i<0?{x1:t,y1:n,x2:r,y2:o,offset:s.offsetFrom}:t===r?{x1:t+5*i,y1:n,x2:r+5*i,y2:o,offset:s.offsetFrom}:n===o?{x1:t,y1:n+5*i,x2:r,y2:o+5*i,offset:s.offsetFrom}:{x1:t+5*Math.SQRT1_2*i,y1:n+5*Math.SQRT1_2*i,x2:r+5*Math.SQRT1_2*i,y2:o+5*Math.SQRT1_2*i,offset:s.offsetFrom}:void 0;const[a,l]=[s.offsetFrom,s.offsetTo];for(let c=0;c<Math.PI;c+=Math.PI/8)for(let s=c,i=0;i<2;i++,s+=Math.PI){const[i,d,u,h]=[Math.sin(c)*a,Math.cos(c)*a,Math.sin(s)*l,Math.cos(s)*l];if(ne(e,t+i,n+d,r+u,o+h))return{x1:t+i,y1:n+d,x2:r+u,y2:o+h,offset:0}}},ne=(e,t,n,o,s)=>!(t!==o&&n!==s||![r.Diagonal,r.Perpendicular].includes(e))||!(1!==Math.abs((s-n)/(o-t))||![r.Diagonal,r.RotatePerpendicular].includes(e)),re=(e,n)=>{if(!n.every((t=>e.hasEdge(t))))return;const s=n.map((n=>{var s,i,a;const[l,c]=e.extremities(n),d=e.getNodeAttributes(l),u=e.getNodeAttributes(c),{type:h,parallelIndex:y}=e.getEdgeAttributes(n),p=null!==(s=e.getEdgeAttribute(n,h))&&void 0!==s?s:o[h].defaultAttrs,f=t(h,d.x,d.y,u.x,u.y,p,y);if(f){const{x1:e,y1:t,x2:n,y2:s,offset:i}=f;return o[r.Simple].generatePath(e,n,t,s,{offset:i})}return null!==(i=null===(a=o[h])||void 0===a?void 0:a.generatePath(d.x,u.x,d.y,u.y,p))&&void 0!==i?i:`M ${d.x} ${d.y} L ${u.x} ${u.y}`}));let i=`${s[0]} `;for(let t=1;t<n.length;t+=1)i+=s[t].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return i},oe=e=>[...e.nodeEntries()].map((e=>e.node.startsWith("stn")?{id:e.node,type:"station",station:e.attributes}:{id:e.node,type:"misc-node",miscNode:e.attributes})),se=e=>{const n={},a=[],l={},c=[];for(const s of e.edgeEntries()){const[e,i,d,u]=[s.sourceAttributes.x,s.sourceAttributes.y,s.targetAttributes.x,s.targetAttributes.y],h=t(s.attributes.type,e,i,d,u,s.attributes[s.attributes.type],s.attributes.parallelIndex);if(h);else if(s.attributes.parallelIndex>=0){a.push(s);continue}if(""===s.attributes.reconcileId)if(h){const e=s.edge,t=s.attributes,{x1:i,y1:a,x2:l,y2:c,offset:d}=h;n[e]={id:e,attr:t,path:o[r.Simple].generatePath(i,l,a,c,{offset:d})}}else c.push(s);else{const e=s.attributes.reconcileId;e in l?l[e].push(s):l[e]=[s]}}const d=new Set;for(;a.length;){const t=a.pop();if(d.has(t.edge))continue;const{normal:r,parallel:o}=s(e,t);if(!o.length)continue;o.forEach((e=>d.add(e.edge))),c.push(...r);const l=i(o);for(const e of o){const t=e.edge;n[t]={id:e.edge,attr:e.attributes,path:l[t]}}}const{allReconciledLines:u,danglingLines:h}=((e,t)=>{const n=[],r=[];return Object.values(t).forEach((t=>{if(1===t.length)return void r.push(...t.map((e=>e.edge)));const o=e.getEdgeAttribute(t.at(0),"type");if(!t.every((t=>e.getEdgeAttribute(t,"type")===o)))return void r.push(...t.map((e=>e.edge)));const s=e.getEdgeAttribute(t.at(0),"style");if(!t.every((t=>e.getEdgeAttribute(t,"style")===s)))return void r.push(...t.map((e=>e.edge)));const i={},a=new Set,l=new Set,c=Object.fromEntries(t.map((t=>{var n,r;const[o,s]=e.extremities(t);return i[o]=(null!==(n=i[o])&&void 0!==n?n:0)+1,i[s]=(null!==(r=i[s])&&void 0!==r?r:0)+1,a.add(o),l.add(s),[o,[t.edge,s]]}))),d=Array.from(a).filter((e=>1===i[e])),u=Array.from(l).filter((e=>1===i[e]));if(1!==d.length||1!==u.length)return void r.push(...t.map((e=>e.edge)));const h=d[0],y=u[0];if(h===y)return void r.push(...t.map((e=>e.edge)));const p=[c[h][0]];let f=c[h][1];for(let e=1;e<t.length;e+=1){var x;const e=null===(x=c[f])||void 0===x?void 0:x.at(1);if(!e)return void r.push(...t.map((e=>e.edge)));p.push(c[f][0]),f=e}f===y&&p.length===t.length?n.push(p):r.push(...t.map((e=>e.edge)))})),{allReconciledLines:n,danglingLines:r}})(e,l);for(const t of u){const r=re(e,t);if(!r)continue;const o=t[0];n[o]={id:o,attr:e.getEdgeAttributes(o),path:r}}for(const t of h){const s=e.getEdgeAttributes(t),[i,a]=e.extremities(t),l=e.getNodeAttributes(i),c=e.getNodeAttributes(a);n[t]={id:t,attr:s,path:o[r.Simple].generatePath(l.x,c.x,l.y,c.y,o[r.Simple].defaultAttrs)}}for(const t of c){const e=t.edge,r=t.attributes.type,s=t.attributes,[i,a,l,c]=[t.sourceAttributes.x,t.sourceAttributes.y,t.targetAttributes.x,t.targetAttributes.y];n[e]=r in o?{id:e,attr:s,path:o[r].generatePath(i,l,a,c,s[r])}:{id:e,attr:s,path:`M ${i} ${a} L ${l} ${c}`}}return Object.values(n).map((e=>({id:e.id,type:"line",line:e})))},ie=e=>{const{id:t,x:r,y:o,handlePointerDown:s,handlePointerMove:i,handlePointerUp:a}=e,l=R.useCallback((e=>s(t,e)),[t,s]),c=R.useCallback((e=>i(t,e)),[t,i]),d=R.useCallback((e=>a(t,e)),[t,a]);return n.jsx("g",{id:t,transform:`translate(${r-6.4} ${o-6.4})scale(0.025)`,onPointerDown:l,onPointerMove:c,onPointerUp:d,style:{cursor:"move"},children:n.jsx("path",{id:`stn_core_${t}`,fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},ae=e=>{const{id:t,path:r,handlePointerDown:o}=e,s=R.useCallback((e=>o(t,e)),[t,o]);return n.jsx("path",{id:t,d:r,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onPointerDown:s})},le=R.memo((e=>{const{elements:t,handlePointerDown:r,handlePointerMove:o,handlePointerUp:s,handleEdgePointerDown:i}=e,l=Object.fromEntries(Array.from({length:21},((e,t)=>[t-10,{pre:[],main:[],post:[]}])));for(const P of t)if("line"===P.type){var c,d,u,h;const e=P.line.attr.type,t=P.line.attr.style,r=P.line.attr[t],o=null===(c=a[t])||void 0===c?void 0:c.preComponent;o&&l[P.line.attr.zIndex].pre.push(n.jsx(o,{id:P.id,type:e,path:P.line.path,styleAttrs:r,newLine:!1,handlePointerDown:i},`${P.id}.pre`));const s=null!==(d=null===(u=a[t])||void 0===u?void 0:u.component)&&void 0!==d?d:ae;l[P.line.attr.zIndex].main.push(n.jsx(s,{id:P.id,type:e,path:P.line.path,styleAttrs:r,newLine:!1,handlePointerDown:i},P.id));const y=null===(h=a[t])||void 0===h?void 0:h.postComponent;y&&l[P.line.attr.zIndex].post.push(n.jsx(y,{id:P.id,type:e,path:P.line.path,styleAttrs:r,newLine:!1,handlePointerDown:i},`${P.id}.post`))}else if("station"===P.type){var y,p,f,x;const e=P.station,t=e.type,i=null===(y=F[t])||void 0===y?void 0:y.preComponent;i&&l[P.station.zIndex].pre.push(n.jsx(i,{id:P.id,x:e.x,y:e.y,attrs:e,handlePointerDown:r,handlePointerMove:o,handlePointerUp:s},`${P.id}.pre`));const a=null!==(p=null===(f=F[t])||void 0===f?void 0:f.component)&&void 0!==p?p:ie;l[P.station.zIndex].main.push(n.jsx(a,{id:P.id,x:e.x,y:e.y,attrs:e,handlePointerDown:r,handlePointerMove:o,handlePointerUp:s},P.id));const c=null===(x=F[t])||void 0===x?void 0:x.postComponent;c&&l[P.station.zIndex].post.push(n.jsx(c,{id:P.id,x:e.x,y:e.y,attrs:e,handlePointerDown:r,handlePointerMove:o,handlePointerUp:s},`${P.id}.post`))}else if("misc-node"===P.type){var g,m,v,b;const e=P.miscNode,t=e.type,i=null===(g=te[t])||void 0===g?void 0:g.preComponent;i&&l[P.miscNode.zIndex].pre.push(n.jsx(i,{id:P.id,x:e.x,y:e.y,attrs:e[t],handlePointerDown:r,handlePointerMove:o,handlePointerUp:s},`${P.id}.pre`));const a=null!==(m=null===(v=te[t])||void 0===v?void 0:v.component)&&void 0!==m?m:ie;l[P.miscNode.zIndex].main.push(n.jsx(a,{id:P.id,x:e.x,y:e.y,attrs:e[t],handlePointerDown:r,handlePointerMove:o,handlePointerUp:s},P.id));const c=null===(b=te[t])||void 0===b?void 0:b.postComponent;c&&l[P.miscNode.zIndex].post.push(n.jsx(c,{id:P.id,x:e.x,y:e.y,attrs:e[t],handlePointerDown:r,handlePointerMove:o,handlePointerUp:s},`${P.id}.post`))}return Array.from({length:21},((e,t)=>(t-10).toString())).map((e=>[...l[e].pre,...l[e].main,...l[e].post])).flat()}),((e,t)=>e.elements===t.elements)),ce=[...Object.values(l),c.Virtual,c.Master,c.LondonArrow],de=()=>{const e=d(),t=R.useRef(window.graph),{telemetry:{project:s},preference:{autoParallel:i,usePolyline:a}}=u((e=>e.app)),{svgViewBoxZoom:l,svgViewBoxMin:c}=u((e=>e.param)),{selected:C,refresh:{nodes:_,edges:M},mode:$,active:z,keepLastPath:W,theme:T,polylines:K}=u((e=>e.runtime)),[L,U]=R.useState({x:0,y:0}),[B,q]=R.useState({x:0,y:0}),[Z,G]=R.useState([]),H=O(((n,r)=>{r.stopPropagation(),"select"===$&&e(h("free"));const o=r.currentTarget,{x:s,y:i}=y(r);o.setPointerCapture(r.pointerId),G([]),U({x:s,y:i}),e(p(n)),r.shiftKey?C.has(n)?e(x(n)):e(g(n)):C.has(n)||e(f(new Set([n]))),e(m(Y(t.current)))})),J=O(((n,r)=>{const{x:o,y:s}=y(r);if("free"===$&&z===n){if(a!==r.altKey){const e=t.current.getNodeAttribute(n,"x"),r=t.current.getNodeAttribute(n,"y"),i=e-(L.x-o)*l/100,a=r-(L.y-s)*l/100;let c=i,d=a;if(X(n,t.current))if(0!==Z.length&&Object.values(Z).forEach((e=>{V(e,i,a)>=5&&G(Z.filter((t=>t!==e)))})),Z.length<2&&Object.values(K).forEach((e=>{const{l:t,d:n}=Q(i,a,e,[...C,...Z.map((e=>e.node))]),r=0===Z.length||!Z.some((e=>e.a===t.a&&e.b===t.b));n<3&&Z.length<2&&r&&G([...Z,t])})),1===Z.length){const e=Z[0];0==e.a?d=-e.c/e.b:0==e.b?c=-e.c/e.a:d=-e.a/e.b*c+-e.c/e.b}else if(2===Z.length){const e=Z[0],t=Z[1],n=e.a*t.b-t.a*e.b;0!==n&&(c=-(e.c*t.b-t.c*e.b)/n,d=-(e.a*t.c-t.a*e.c)/n)}const u=c-e,h=d-r;C.forEach((e=>{t.current.hasNode(e)&&t.current.updateNodeAttributes(e,(e=>({...e,x:v(e.x+u,.01),y:v(e.y+h,.01)})))}))}else G([]),C.forEach((e=>{t.current.hasNode(e)&&t.current.updateNodeAttributes(e,(e=>({...e,x:v(e.x-(L.x-o)*l/100,5),y:v(e.y-(L.y-s)*l/100,5)})))}));e(b()),e(P())}else $.startsWith("line")&&q({x:(L.x-o)*l/100,y:(L.y-s)*l/100})})),ee=O(((n,r)=>{if($.startsWith("line")){W||e(h("free"));const n=t.current.hasNode(z)&&ce.includes(t.current.getNodeAttribute(z,"type"));["stn_core_","virtual_circle_"].forEach((e=>{var a;const l=null===(a=document.elementsFromPoint(r.clientX,r.clientY)[0].attributes)||void 0===a||null===(a=a.getNamedItem("id"))||void 0===a?void 0:a.value,c=null==l?void 0:l.startsWith(e);if(n&&c){const n=$.slice(5),r=`line_${A(10)}`,[a,c]=[z,l.slice(e.length)],d=i?w(t.current,n,a,c,"from"):-1;t.current.addDirectedEdgeWithKey(r,a,c,{visible:!0,zIndex:0,type:n,[n]:structuredClone(o[n].defaultAttrs),style:k.SingleColor,[k.SingleColor]:{color:T},reconcileId:"",parallelIndex:d}),s&&E.event(N.ADD_LINE,{type:n})}})),e(P()),e(j(t.current.export()))}else if("free"===$&&z){const{x:n,y:o}=y(r);L.x-n==0&&L.y-o==0||e(j(t.current.export()))}G([]),e(p(void 0))})),ne=O(((n,r)=>{if(r.stopPropagation(),r.shiftKey||e(D()),r.shiftKey&&C.has(n)?e(x(n)):e(g(n)),$.startsWith("station")||$.startsWith("misc-node-virtual")||$.startsWith("misc-node-master")){const o=r.clientX-document.getElementById("canvas").getBoundingClientRect().left,a=r.clientY-document.getElementById("canvas").getBoundingClientRect().top,d=$.startsWith("station"),u=A(10),y=d?`stn_${u}`:`misc_node_${u}`,p=d?$.slice(8):$.slice(10),{x:x,y:g}=I(o,a,l,c),m=d?structuredClone(F[p].defaultAttrs):structuredClone(te[p].defaultAttrs);"color"in m&&(m.color=T),t.current.addNode(y,{visible:!0,zIndex:0,x:v(x,5),y:v(g,5),type:p,[p]:m});const w=t.current.getEdgeAttributes(n),{zIndex:k,type:D,style:S}=w,C=w[D],_=w[S],[M,z]=t.current.extremities(n),W=i?0:-1;t.current.addDirectedEdgeWithKey(`line_${A(10)}`,M,y,{visible:!0,zIndex:k,type:D,[D]:structuredClone(C),style:S,[S]:structuredClone(_),reconcileId:"",parallelIndex:W}),t.current.addDirectedEdgeWithKey(`line_${A(10)}`,y,z,{visible:!0,zIndex:k,type:D,[D]:structuredClone(C),style:S,[S]:structuredClone(_),reconcileId:"",parallelIndex:W}),t.current.dropEdge(n),e(b()),e(P()),e(j(t.current.export())),s&&(E.event(N.ADD_STATION,{type:p}),E.event(N.ADD_LINE,{type:D})),e(h("free")),e(f(new Set([y])))}})),re=R.useMemo((()=>[...se(t.current),...oe(t.current)]),[M,_]),ie=S.component,ae=e=>{if(0===e.a)return[-1e4,1e4,-e.c/e.b,-e.c/e.b];if(0===e.b)return[-e.c/e.a,-e.c/e.a,-1e4,1e4];{const t=-e.a/e.b,n=-e.c/e.b;return[-1e4,1e4,-1e4*t+n,1e4*t+n]}};return n.jsxs(n.Fragment,{children:[n.jsx(le,{elements:re,handlePointerDown:H,handlePointerMove:J,handlePointerUp:ee,handleEdgePointerDown:ne}),$.startsWith("line")&&z&&"background"!==z&&n.jsx(ie,{id:"line_create_in_progress___no_use",type:$.slice(5),path:o[$.slice(5)].generatePath(t.current.getNodeAttribute(z,"x"),t.current.getNodeAttribute(z,"x")-B.x,t.current.getNodeAttribute(z,"y"),t.current.getNodeAttribute(z,"y")-B.y,o[$.slice(5)].defaultAttrs),styleAttrs:{color:T},newLine:!0,handlePointerDown:()=>{}}),0!==Z.length&&Z.map(((e,t)=>n.jsx("path",{d:o[r.Simple].generatePath(...ae(e),o[r.Simple].defaultAttrs),stroke:"cyan",strokeWidth:l/100},`line_polyline_${t}`)))]})};e("default",(()=>{const e=d(),t=R.useRef(window.graph),r=()=>{e(b()),e(P()),e(j(t.current.export()))},{activeSubscriptions:o}=u((e=>e.account)),{telemetry:{project:s}}=u((e=>e.app)),{svgViewBoxZoom:i,svgViewBoxMin:a}=u((e=>e.param)),{mode:l,lastTool:c,active:x,selected:g,keepLastPath:m,theme:w,refresh:{nodes:k},masterNodesCount:S,parallelLinesCount:Y}=u((e=>e.runtime)),X=q(),{height:V,width:Q}=C(X),ne=!o.RMP_CLOUD&&S+1>_,re=!o.RMP_CLOUD&&Y+1>M;R.useEffect((()=>{const e=Z(t.current);Object.entries(e).filter((([e,t])=>t&&e in G)).forEach((([e])=>H(e)))}),[k]);const[oe,se]=R.useState({x:0,y:0}),[ie,ae]=R.useState({x:0,y:0}),[le,ce]=R.useState({x:0,y:0}),[ue,he]=R.useState({x:0,y:0}),ye=O((n=>{const{x:o,y:c}=y(n);if(l.startsWith("station")){e(h("free"));const n=`stn_${A(10)}`,d=l.slice(8),u=structuredClone(F[d].defaultAttrs);"color"in u&&(u.color=w);const{x:y,y:p}=I(o,c,i,a);t.current.addNode(n,{visible:!0,zIndex:0,x:v(y,5),y:v(p,5),type:d,[d]:u}),r(),s&&E.event(N.ADD_STATION,{type:d}),e(f(new Set([n])))}else if(l.startsWith("misc-node")){e(h("free"));const n=`misc_node_${A(10)}`,d=l.slice(10),{x:u,y:y}=I(o,c,i,a);t.current.addNode(n,{visible:!0,zIndex:0,x:v(u,5),y:v(y,5),type:d,[d]:structuredClone(te[d].defaultAttrs)}),r(),s&&E.event(N.ADD_STATION,{type:d}),e(f(new Set([n])))}else"free"===l||l.startsWith("line")?(l.startsWith("line")&&(e(h("free")),m&&e($(!1))),ce({x:o,y:c}),he(a),n.shiftKey||(e(p("background")),e(D()))):"select"===l&&(se(I(o,c,i,a)),ae(I(o,c,i,a)))})),pe=O((t=>{if("select"===l){if(0!=oe.x&&0!=oe.y){const{x:e,y:n}=y(t);ae(I(e,n,i,a))}}else if("background"===x){const{x:n,y:r}=y(t);e(z({x:ue.x+(le.x-n)*i/100,y:ue.y+(le.y-r)*i/100}))}})),fe=O((n=>{if("select"===l){const{x:r,y:o}=y(n),{x:s,y:l}=I(r,o,i,a),c=J(t.current,oe.x,oe.y,s,l),d=ee(t.current,new Set(c));e(f(new Set([...n.shiftKey?g:[],...c,...d]))),e(h("free")),se({x:0,y:0}),ae({x:0,y:0})}"background"!==x||n.shiftKey||e(p(void 0))})),xe=O((t=>{let n=i;t.deltaY>0&&i+10<400?n=i+10:t.deltaY<0&&i-10>0&&(n=i-10),e(W(n));const{x:r,y:o}=y(t),s=t.currentTarget.getBoundingClientRect(),[l,c]=[r/s.width,o/s.height];e(z({x:a.x+r*i/100-Q*n/100*l,y:a.y+o*i/100-V*n/100*c}))})),ge=O((async n=>{if(T?"Backspace"===n.key:"Delete"===n.key)g.size>0&&(g.forEach((e=>{t.current.hasNode(e)?t.current.dropNode(e):t.current.hasEdge(e)&&t.current.dropEdge(e)})),e(D()),r());else if(n.key.startsWith("Arrow")){const t=100,r=n.key.endsWith("Left")?-1:n.key.endsWith("Right")?1:0,o=n.key.endsWith("Up")?-1:n.key.endsWith("Down")?1:0;e(z(I(t*r,t*o,i,a)))}else if("i"===n.key||"j"===n.key||"k"===n.key||"l"===n.key){const e=10,o=("j"===n.key?-1:"l"===n.key?1:0)*e,s=("i"===n.key?-1:"k"===n.key?1:0)*e;g.size>0&&g.forEach((e=>{t.current.hasNode(e)&&(t.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)+o)),t.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)+s)),r())}))}else if("f"===n.key&&c)e(h(c));else if("z"===n.key&&(T?n.metaKey&&!n.shiftKey:n.ctrlKey))T&&n.preventDefault(),e(K()),e(b()),e(P());else if("s"===n.key)e(h("select"));else if("c"!==n.key&&"x"!==n.key||!(T?n.metaKey&&!n.shiftKey:n.ctrlKey))if("v"===n.key&&(T?n.metaKey&&!n.shiftKey:n.ctrlKey)){const n=await navigator.clipboard.readText(),{x:o,y:s}=I(Q/2,V/2,i,a),{nodes:l,edges:c}=B(n,t.current,ne,re,v(o,5),v(s,5));r();const d=structuredClone(l);c.forEach((e=>d.add(e))),e(f(d))}else(T&&"z"===n.key&&n.metaKey&&n.shiftKey||!T&&"y"===n.key&&n.ctrlKey)&&(e(L()),e(b()),e(P()));else{const o=U(t.current,g);navigator.clipboard.writeText(o),"x"===n.key&&(e(D()),g.forEach((e=>{t.current.hasNode(e)?t.current.dropNode(e):t.current.hasEdge(e)&&t.current.dropEdge(e)})),r())}})),[me,ve]=R.useState(0),be=O((t=>{if(2===t.touches.length){e(p(void 0));const[n,r]=[t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY];ve(n*n+r*r)}})),Pe=O((t=>{if(0!==me&&2===t.touches.length){const[n,r]=[t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY],o=n*n+r*r;let s=i;o-me<0&&i+10<=390?s=i+10:o-me>0&&i-10>=10&&(s=i-10),e(W(s)),ve(o);const l=t.currentTarget.getBoundingClientRect(),[c,d]=[(t.touches[0].clientX+t.touches[1].clientX)/2-l.left,(t.touches[0].clientY+t.touches[1].clientY)/2-l.top],[u,h]=[c/l.width,d/l.height];e(z({x:a.x+c*i/100-Q*s/100*u,y:a.y+d*i/100-V*s/100*h}))}})),Ae=O((e=>{0!==me&&ve(0)})),[we,ke]=R.useState({sx:0,sy:0,ex:0,ey:0});return R.useEffect((()=>{ke({sx:oe.x<=ie.x?oe.x:ie.x,ex:oe.x>ie.x?oe.x:ie.x,sy:oe.y<=ie.y?oe.y:ie.y,ey:oe.y>ie.y?oe.y:ie.y})}),[ie.x,ie.y]),n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none",touchAction:"none"},height:V,width:Q,viewBox:`${a.x} ${a.y} ${Q*i/100} ${V*i/100}`,onPointerDown:ye,onPointerMove:pe,onPointerUp:fe,onTouchStart:be,onTouchMove:Pe,onTouchEnd:Ae,onWheel:xe,tabIndex:0,onKeyDown:ge,children:[n.jsx(de,{}),"select"===l&&0!=oe.x&&0!=oe.y&&n.jsx("rect",{x:we.sx,y:we.sy,width:we.ex-we.sx,height:we.ey-we.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),n.jsx("defs",{children:n.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[n.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),n.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})}))}}}));
