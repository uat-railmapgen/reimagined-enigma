System.register(["./chakra-legacy-DbXIViDh.js","./index-legacy-v6iH6f4z.js","./react-legacy-B9RkHKhm.js","./index-legacy-DMxGTjc9.js","./stations-legacy-y8VntOk-.js","./graph-legacy-Dlpp7SJN.js","./change-type-modal-legacy-Chj0VZTl.js"],(function(e,t){"use strict";var s,n,r,i,o,a,l,c,d,h,u,p,m,x,g,j,f,w,b,y,v,S,z,C,k,O,E,A,M,_,N,H,R,W,L,T,I,P,B,G,U,Z,D,K,Y,V,F,q,J,X,Q,$,ee,te,se,ne,re,ie,oe,ae,le,ce,de,he,ue,pe,me,xe,ge,je,fe,we,be,ye,ve,Se,ze,Ce,ke,Oe,Ee,Ae,Me,_e,Ne,He,Re,We,Le,Te,Ie,Pe,Be,Ge,Ue,Ze,De,Ke,Ye,Ve,Fe,qe,Je,Xe,Qe,$e,et,tt,st,nt,rt,it,ot,at,lt,ct,dt,ht,ut,pt,mt,xt,gt,jt,ft,wt,bt,yt,vt,St,zt,Ct,kt,Ot,Et,At,Mt,_t,Nt,Ht,Rt,Wt,Lt,Tt,It,Pt;return{setters:[e=>{s=e.j,n=e.at,r=e.$,i=e.au,o=e.a1,a=e.a2,l=e.a3,c=e.g,d=e.av,h=e.a4,u=e.B,p=e.aw,m=e.ax,x=e.ay,g=e.az,j=e.aA,f=e.as,w=e.h,b=e.O,y=e.a5,v=e.aB,S=e.aC,z=e.aD,C=e.a7,k=e.aE,O=e.a6,E=e.aF,A=e.aG,M=e.af,_=e.aH,N=e.aI,H=e.U,R=e.aJ,W=e.aK,L=e.aL,T=e.al,I=e.aM,P=e.aN,B=e.ak,G=e.aO,U=e.aP,Z=e.aQ,D=e.aR,K=e.aS,Y=e.aT,V=e.aU,F=e.d,q=e.R,J=e.q,X=e.Z,Q=e.W,$=e.m,ee=e.a8,te=e.a9},e=>{se=e.u,ne=e.r,re=e.a,ie=e.E,oe=e.M,ae=e.c,le=e.b,ce=e.S,de=e.C,he=e.d,ue=e.n,pe=e.L,me=e.R,xe=e.e,ge=e.f,je=e.g,fe=e.h,we=e.i,be=e.j,ye=e.k,ve=e.s,Se=e.l,ze=e.m,Ce=e.o,ke=e.p,Oe=e.q,Ee=e.t,Ae=e.v,Me=e.w,_e=e.x,Ne=e.y,He=e.z,Re=e.A,We=e.B,Le=e.D,Te=e.F,Ie=e.G,Pe=e.H,Be=e.I,Ge=e.J,Ue=e.K,Ze=e.N,De=e.O,Ke=e.P,Ye=e.T,Ve=e.Q,Fe=e.U,qe=e.V,Je=e.W,Xe=e.X,Qe=e.Y,$e=e.Z,et=e._,tt=e.$,st=e.a0,nt=e.a1,rt=e.a2,it=e.a3,ot=e.a4,at=e.a5,lt=e.a6,ct=e.a7,dt=e.a8,ht=e.a9,ut=e.aa,pt=e.ab,mt=e.ac,xt=e.ad,gt=e.ae,jt=e.af,ft=e.ag,wt=e.ah,bt=e.ai,yt=e.aj,vt=e.ak,St=e.al,zt=e.am,Ct=e.an},e=>{kt=e.u,Ot=e.b,Et=e.r,At=e.T},e=>{Mt=e.I},e=>{_t=e.F,Nt=e.l,Ht=e.m,Rt=e.a,Wt=e.i,Lt=e.s,Tt=e.u},e=>{It=e.f},e=>{Pt=e.C}],execute:function(){e("default",(function(){return s.jsxs(s.Fragment,{children:[s.jsx(un,{}),s.jsx(pn,{})]})}));var t=function(e){return se(ne.ready(),e)},Bt={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Gt=e=>{const{isOpen:t,onClose:f}=e,{t:w}=kt(),b=ne.getAppVersion();return s.jsxs(n,{isOpen:t,onClose:f,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:w("header.about.title")}),s.jsx(a,{}),s.jsxs(l,{paddingBottom:10,children:[s.jsxs(c,{direction:"row",children:[s.jsx(d,{boxSize:"128px",src:"/rmp//logo192.png"}),s.jsxs(c,{direction:"column",width:"100%",alignItems:"center",justifyContent:"center",children:[s.jsx(h,{fontSize:"xl",as:"b",children:w("header.about.rmp")}),s.jsx(h,{children:b}),s.jsx(h,{}),s.jsx(h,{fontSize:"sm",children:w("header.about.railmapgen")})]})]}),s.jsx(u,{margin:5,children:s.jsx(h,{fontSize:"xl",children:w("header.about.desc")})}),s.jsx(p,{as:"h5",size:"sm",mt:3,mb:2,children:w("header.about.contributors")}),s.jsx(p,{as:"h6",size:"xs",my:2,children:w("header.about.coreContributors")}),s.jsxs(m,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"https://github.com/thekingofcity.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"thekingofcity"}),s.jsx(h,{fontSize:"sm",children:w("header.about.content1")}),s.jsx(h,{fontSize:"sm",align:"right",mb:1,children:w("header.about.content2")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/langonginc","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"https://github.com/langonginc.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"langonginc"}),s.jsx(h,{fontSize:"sm",children:w("header.about.langonginc")}),s.jsx(h,{fontSize:"sm",align:"right",mb:1,children:"--Avicii"})]})]})]}),s.jsx(p,{as:"h6",size:"xs",my:2,children:w("header.about.styleContributors")}),s.jsxs(m,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/203IhzElttil","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"https://github.com/203IhzElttil.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"203IhzElttil"}),s.jsx(h,{fontSize:"sm",mb:1,children:w("header.about.203IhzElttil")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/Swiftiecott","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"https://github.com/Swiftiecott.png",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:"Swiftiecott"}),s.jsx(h,{fontSize:"sm",mb:1,children:w("header.about.Swiftiecott")})]})]})]}),s.jsx(p,{as:"h5",size:"sm",mt:3,mb:2,children:w("header.about.contactUs")}),s.jsxs(m,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"data:image/svg+xml,%3csvg%20width='98'%20height='96'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M48.854%200C21.839%200%200%2022%200%2049.217c0%2021.756%2013.993%2040.172%2033.405%2046.69%202.427.49%203.316-1.059%203.316-2.362%200-1.141-.08-5.052-.08-9.127-13.59%202.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015%204.934.326%207.523%205.052%207.523%205.052%204.367%207.496%2011.404%205.378%2014.235%204.074.404-3.178%201.699-5.378%203.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283%200-5.378%201.94-9.778%205.014-13.2-.485-1.222-2.184-6.275.486-13.038%200%200%204.125-1.304%2013.426%205.052a46.97%2046.97%200%200%201%2012.214-1.63c4.125%200%208.33.571%2012.213%201.63%209.302-6.356%2013.427-5.052%2013.427-5.052%202.67%206.763.97%2011.816.485%2013.038%203.155%203.422%205.015%207.822%205.015%2013.2%200%2018.905-11.404%2023.06-22.324%2024.283%201.78%201.548%203.316%204.481%203.316%209.126%200%206.6-.08%2011.897-.08%2013.526%200%201.304.89%202.853%203.316%202.364%2019.412-6.52%2033.405-24.935%2033.405-46.691C97.707%2022%2075.788%200%2048.854%200z'%20fill='%2324292f'/%3e%3c/svg%3e",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.about.github")}),s.jsx(h,{fontSize:"sm",children:w("header.about.githubContent")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2023.0.1,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%20270%20270'%20style='enable-background:new%200%200%20270%20270;'%20xml:space='preserve'%3e%3cstyle%20type='text/css'%3e%20.st0{fill:%23E01E5A;}%20.st1{fill:%2336C5F0;}%20.st2{fill:%232EB67D;}%20.st3{fill:%23ECB22E;}%20%3c/style%3e%3cg%3e%3cg%3e%3cpath%20class='st0'%20d='M99.4,151.2c0,7.1-5.8,12.9-12.9,12.9c-7.1,0-12.9-5.8-12.9-12.9c0-7.1,5.8-12.9,12.9-12.9h12.9V151.2z'/%3e%3cpath%20class='st0'%20d='M105.9,151.2c0-7.1,5.8-12.9,12.9-12.9s12.9,5.8,12.9,12.9v32.3c0,7.1-5.8,12.9-12.9,12.9%20s-12.9-5.8-12.9-12.9V151.2z'/%3e%3c/g%3e%3cg%3e%3cpath%20class='st1'%20d='M118.8,99.4c-7.1,0-12.9-5.8-12.9-12.9c0-7.1,5.8-12.9,12.9-12.9s12.9,5.8,12.9,12.9v12.9H118.8z'/%3e%3cpath%20class='st1'%20d='M118.8,105.9c7.1,0,12.9,5.8,12.9,12.9s-5.8,12.9-12.9,12.9H86.5c-7.1,0-12.9-5.8-12.9-12.9%20s5.8-12.9,12.9-12.9H118.8z'/%3e%3c/g%3e%3cg%3e%3cpath%20class='st2'%20d='M170.6,118.8c0-7.1,5.8-12.9,12.9-12.9c7.1,0,12.9,5.8,12.9,12.9s-5.8,12.9-12.9,12.9h-12.9V118.8z'/%3e%3cpath%20class='st2'%20d='M164.1,118.8c0,7.1-5.8,12.9-12.9,12.9c-7.1,0-12.9-5.8-12.9-12.9V86.5c0-7.1,5.8-12.9,12.9-12.9%20c7.1,0,12.9,5.8,12.9,12.9V118.8z'/%3e%3c/g%3e%3cg%3e%3cpath%20class='st3'%20d='M151.2,170.6c7.1,0,12.9,5.8,12.9,12.9c0,7.1-5.8,12.9-12.9,12.9c-7.1,0-12.9-5.8-12.9-12.9v-12.9H151.2z'/%3e%3cpath%20class='st3'%20d='M151.2,164.1c-7.1,0-12.9-5.8-12.9-12.9c0-7.1,5.8-12.9,12.9-12.9h32.3c7.1,0,12.9,5.8,12.9,12.9%20c0,7.1-5.8,12.9-12.9,12.9H151.2z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.about.slack")}),s.jsx(h,{fontSize:"sm",children:w("header.about.slackContent")}),s.jsx(h,{fontSize:"sm",as:"i",children:"#rmp, #gallery, #rmg, #palette-and-templates"})]})]})]})]})]})]})};function Ut(e){return f({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M12 21a9 9 0 0 0 9 -9a9 9 0 0 0 -9 -9a9 9 0 0 0 -9 9a9 9 0 0 0 9 9z"},child:[]},{tag:"path",attr:{d:"M12 12m-4.5 0a4.5 4.5 0 1 0 9 0a4.5 4.5 0 1 0 -9 0"},child:[]}]})(e)}function Zt(e){return f({tag:"svg",attr:{version:"1.1",viewBox:"0 0 17 17"},child:[{tag:"g",attr:{},child:[]},{tag:"path",attr:{d:"M13 10v-10h-13v13h13v-3zM1 1h11v8h-0.755l-2.564-3.319-1.159 1.214-2.248-3.881-3.576 5.986h-0.698v-8zM9.982 9h-7.119l2.398-4.014 2.064 3.564 1.275-1.337 1.382 1.787zM1 12v-2h11v2h-11zM17 3v13h-13v-1.984h1v0.984h11v-11h-2v-1h3z"},child:[]}]})(e)}const Dt=e=>{const{isOpen:t,onClose:f}=e,{t:w}=kt(),{telemetry:{project:b}}=re((e=>e.app)),y=e=>new URLSearchParams({title:`Donation: New ${e} request for [city name]`,body:`Hi, I'd like to have new ${e}, and here is my support.\n\n\x3c!-- your donation entry --\x3e\n\n\x3c!-- reference (images or URLs) --\x3e\n\n`}).toString();return Ot.useEffect((()=>{t&&b&&ne.event(ie.OPEN_DONATION,{})}),[t]),s.jsxs(n,{isOpen:t,onClose:f,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:w("header.donation.title")}),s.jsx(a,{}),s.jsxs(l,{paddingBottom:10,children:[s.jsxs(c,{direction:"row",alignItems:"center",justifyContent:"space-around",children:[s.jsx(h,{fontSize:"96px",fontFamily:"serif",children:"I"}),s.jsx(Mt,{size:"64px",color:"red"}),s.jsx(d,{boxSize:"96px",src:"/rmp//logo192.png"})]}),s.jsx(u,{margin:5,children:s.jsx(h,{fontSize:"xl",children:w("header.donation.content")})}),s.jsx(p,{as:"h5",size:"sm",mb:2,children:w("header.donation.rewards")}),s.jsxs(m,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>{ne.isStandaloneWindow()?window.open("/rmp-gallery/#/donation","_blank"):ne.openApp({appId:"rmp-gallery",hash:"/donation"})},cursor:"pointer",children:[s.jsx(g,{icon:s.jsx(Zt,{}),size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.donation.gallery")}),s.jsx(h,{fontSize:"sm",children:w("header.donation.galleryContent")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues/new?"+y("stations/nodes"),"_blank"),cursor:"pointer",children:[s.jsx(g,{icon:s.jsx(Ut,{}),size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.donation.nodes")}),s.jsx(h,{fontSize:"sm",children:w("header.donation.nodesContent")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://github.com/railmapgen/rmp/issues/new?"+y("features"),"_blank"),cursor:"pointer",children:[s.jsx(g,{icon:s.jsx(oe,{}),size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.donation.features")}),s.jsx(h,{fontSize:"sm",children:w("header.donation.featuresContent")})]})]})]}),s.jsx(p,{as:"h5",size:"sm",mt:3,mb:2,children:w("header.donation.methods")}),s.jsxs(m,{children:[s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://opencollective.com/rail-map-toolkit","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"/rmp/assets/opencollective-icon-Ciasch0w.webp",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.donation.openCollective")}),s.jsx(h,{fontSize:"sm",children:w("header.donation.viaUSD")})]})]}),s.jsxs(x,{size:"lg",w:"85%",onClick:()=>window.open("https://afdian.com/a/rail-map-toolkit","_blank"),cursor:"pointer",children:[s.jsx(g,{src:"data:image/png;base64,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",size:"lg",my:2,ml:-1,mr:2}),s.jsxs(j,{display:"block",width:"100%",pb:1,children:[s.jsx(h,{fontSize:"lg",fontWeight:"bold",mb:1,children:w("header.donation.afdian")}),s.jsx(h,{fontSize:"sm",children:w("header.donation.viaCNY")})]})]})]})]})]})]})};
/*!
             * canvas-size
             * v2.0.0
             * https://github.com/jhildenbiddle/canvas-size
             * (c) 2015-2024 John Hildenbiddle <http://hildenbiddle.com>
             * MIT license
             */
function Kt(e){const t=e.sizes.shift(),s=Math.max(Math.ceil(t[0]),1),n=Math.max(Math.ceil(t[1]),1),r=[s-1,n-1,1,1],i=performance.now(),o="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;let a,l;o?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(s,n)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=s,l.height=n);const c=a.getContext("2d"),d=l.getContext("2d");d&&(d.fillRect.apply(d,r),c.drawImage(l,s-1,n-1,1,1,0,0,1,1));const h=c&&0!==c.getImageData(0,0,1,1).data[3],u=parseInt(performance.now()-i);return[a,l].forEach((e=>{e.height=0,e.width=0})),o?(postMessage({width:s,height:n,testTime:u,isTestPass:h}),!h&&e.sizes.length&&setTimeout((()=>{Kt(e)}),0)):h?e.onSuccess({width:s,height:n,testTime:u}):(e.onError({width:s,height:n,testTime:u}),e.sizes.length&&setTimeout((()=>{Kt(e)}),0)),h}const Yt={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Vt={max:null,min:1,sizes:[],step:1024,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Ft={};function qt(e){const t=e.width===e.height,s=1===e.height,n=1===e.width,r=[];if(e.width&&e.height){const i=e.min||Vt.min,o=e.step||Vt.step;let a=Math.max(e.width,e.height);for(;a>=i;){const e=t||s?a:1,i=t||n?a:1;r.push([e,i]),a-=o}}else e.sizes.forEach((e=>{const i=t||s?e:1,o=t||n?e:1;r.push([i,o])}));return r}function Jt(e){const t="undefined"!=typeof window,s=t&&"Promise"in window,n=t&&"HTMLCanvasElement"in window,r=t&&"OffscreenCanvas"in window,i=URL.createObjectURL(new Blob([])).slice(-36),o=performance.now(),{onError:a,onSuccess:l,...c}=e,d=()=>parseInt(performance.now()-o);let h=null;if(!n)return!1;if(e.useWorker&&r){const e=`\n            var canvasTest = ${Kt.toString()};\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        `,t=new Blob([e],{type:"application/javascript"}),s=URL.createObjectURL(t);h=new Worker(s),URL.revokeObjectURL(s),h.onmessage=function(e){const{width:t,height:s,testTime:n,isTestPass:r}=e.data,o={width:t,height:s,testTime:n,totalTime:d()};r?(Ft[i].onSuccess(o),delete Ft[i]):Ft[i].onError(o)}}return s?new Promise((t=>{const s={...e,onError(s){let{width:n,height:r,testTime:i}=s;const o={width:n,height:r,testTime:i,totalTime:d()};let l;if(0===e.sizes.length)l=!0;else{const[[t,s]]=e.sizes.slice(-1);l=n===t&&r===s}a(o),l&&t({...o,success:!1})},onSuccess(e){let{width:s,height:n,testTime:r}=e;const i={width:s,height:n,testTime:r,totalTime:d()};l(i),t({...i,success:!0})}};if(h){const{onError:e,onSuccess:t}=s;Ft[i]={onError:e,onSuccess:t},h.postMessage(c)}else Kt(s)})):h?(Ft[i]={onError:a,onSuccess:l},void h.postMessage(c)):Kt(e)}const Xt={maxArea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=qt({width:e.max,height:e.max,min:e.min,step:e.step,sizes:[...Yt.area]});return Jt({...Vt,...e,sizes:t})},maxHeight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=qt({width:1,height:e.max,min:e.min,step:e.step,sizes:[...Yt.height]});return Jt({...Vt,...e,sizes:t})},maxWidth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=qt({width:e.max,height:1,min:e.min,step:e.step,sizes:[...Yt.width]});return Jt({...Vt,...e,sizes:t})},test(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={...Vt,...e};return t.sizes=[...t.sizes],t.width&&t.height&&(t.sizes=[[t.width,t.height]]),Jt(t)}},Qt=(e,t,s)=>{const n=new Blob([s],{type:t});$t(e,n)},$t=(e,t)=>{const s=window.URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s)},es=async(e,t,s,n)=>{const{xMin:r,yMin:i,xMax:o,yMax:a}=ae(e),[l,c]=[o-r,a-i],d=document.getElementById("canvas").cloneNode(!0);[...d.children].filter((t=>e.hasNode(t.id)&&e.getNodeAttribute(t.id,"type")===le.Virtual)).forEach((e=>d.removeChild(e))),t||d.appendChild(ns(o-400,a-120)),d.setAttribute("viewBox",`${r} ${i} ${l} ${c}`),d.setAttribute("width",l.toString()),d.setAttribute("height",c.toString()),Object.entries({".rmp-name-outline":["paint-order","stroke","stroke-linejoin"]}).forEach((([e,t])=>{const s=document.querySelector(e);if(null===s)return;const r=window.getComputedStyle(s);d.querySelectorAll(e).forEach((s=>{if(".rmp-name-outline"===e&&1.1===n){const t=s.insertAdjacentElement("afterend",s.cloneNode(!0));t&&(t.classList.remove(e.slice(1)),0===t.classList.length&&s.removeAttribute("class"),t.removeAttribute("stroke-width"))}t.forEach((e=>{s.setAttribute(e,r.getPropertyValue(e))})),s.classList.remove(e.slice(1)),0===s.classList.length&&s.removeAttribute("class")}))})),d.querySelectorAll('[fill="url(#opaque)"]').forEach((e=>{e.setAttribute("fill","white"),e.setAttribute("fill-opacity","0")}));const h=It(e);return await ts(d,e,h,s),await ss(d,e,h),{elem:d,width:l,height:c}},ts=async(e,t,s,n)=>{const r=new Set;if(Object.keys(_t).filter((e=>s[e])).forEach((e=>r.add(e))),t.filterNodes(((e,t)=>e.startsWith("misc_node_")&&t.type===le.Text)).map((e=>t.getNodeAttribute(e,le.Text).language)).map((e=>Nt[e])).filter((e=>e!==ce.ShmetroBasic)).forEach((e=>r.add(e))),n)[".rmp-name__zh",".rmp-name__en"].forEach((t=>{e.querySelectorAll(t).forEach((e=>{e.classList.remove(t.slice(1)),0===e.classList.length&&e.removeAttribute("class")}))})),r.forEach((t=>{_t[t].className.forEach((t=>{e.querySelectorAll(t).forEach((e=>{e.classList.remove(t.slice(1)),0===e.classList.length&&e.removeAttribute("class")}))}))}));else{const t=document.createElement("style");for(let e=0;e<document.styleSheets.length;e+=1){var i;if(null!==(i=document.styleSheets[e].href)&&void 0!==i&&i.endsWith("styles/fonts.css")){t.textContent=[...document.styleSheets[e].cssRules].map((e=>e.cssText)).join("\n");break}}e.prepend(t),await Promise.all([...r.values()].map((e=>_t[e])).map((async({cssName:t,cssFont:s})=>{try{e.prepend(await Ht(s,t))}catch(n){alert("Failed to load fonts. Fonts in the exported PNG will be missing."),console.error(n)}})))}},ss=async(e,t,s)=>{if(s[le.Facilities]){const s=t.filterNodes(((e,t)=>t.type===le.Facilities)),n=Object.fromEntries(Object.values(Rt).map((e=>[e,[]])));s.forEach((e=>{var s;const r=null===(s=t.getNodeAttribute(e,le.Facilities))||void 0===s?void 0:s.type;r&&n[r].push(e)}));const r=Object.entries(n).filter((([e,t])=>t.length>0)).map((([e,t])=>e)),i=await Promise.all((await Promise.all(r.map((async e=>await fetch(`/rmp//images/facilities/${e}.svg`))))).map((e=>e.text())));r.forEach(((t,s)=>{const r=document.createElement("div");r.innerHTML=i[s];const o=r.querySelector("svg"),a=document.createElementNS("http://www.w3.org/2000/svg","symbol");for(const e of o.attributes)a.setAttribute(e.name,e.value);for(;o.firstChild;)a.appendChild(o.firstChild);o.replaceWith(a),a.id=t,e.appendChild(a),n[t].forEach((s=>{const n=e.querySelector(`#${s}`),r=null==n?void 0:n.querySelector("image");if(r){n.removeChild(r);const e=document.createElementNS("http://www.w3.org/2000/svg","use");e.setAttribute("href",`#${t}`),e.setAttribute("height",a.getAttribute("height")),e.setAttribute("width",a.getAttribute("width")),n.appendChild(e)}})),r.remove()}))}},ns=(e,t)=>{const s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("transform",`translate(${e}, ${t})scale(2)`);const n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("width","40"),n.setAttribute("height","40"),n.setAttribute("x","-50"),n.setAttribute("y","-20");const r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("font-family","Arial, sans-serif"),r.setAttribute("font-size","16"),r.appendChild(document.createTextNode("Rail Map Painter"));const i=document.createElementNS("http://www.w3.org/2000/svg","text");return i.setAttribute("font-family","Arial, sans-serif"),i.setAttribute("font-size","10"),i.setAttribute("y","10"),i.appendChild(document.createTextNode("https://railmapgen.github.io/rmp/")),s.appendChild(n),s.appendChild(r),s.appendChild(i),s};var rs=(e=>(e.left="l",e.right="r",e))(rs||{}),is=(e=>(e.through="through",e.nonThrough="nonthrough",e))(is||{}),os=(e=>(e.local="local",e.express="express",e.direct="direct",e))(os||{}),as=(e=>(e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro",e))(as||{}),ls=(e=>(e.sh="sh",e.sh2020="sh2020",e))(ls||{});const cs=new Set,ds=new Set,hs=new Set,us=new Set,ps=new Map,ms=new Map,xs=new Set,gs=new Map,js=new Map;let fs=[],ws=0;const bs=new Map,ys=new Map,vs=new Set,Ss={name:["LEFT END","LEFT END"],num:"00",services:[os.local],parents:[],children:["lineend"],transfer:{groups:[{}],tick_direc:rs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355},zs={name:["RIGHT END","RIGHT END"],num:"00",services:[os.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:rs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355},Cs={svgWidth:{destination:1500,runin:1500,railmap:1500,indoor:1500},svg_height:400,style:as.SHMetro,y_pc:50,padding:10,branchSpacingPct:33,direction:rs.right,platform_num:"1",theme:[de.Shanghai,"sh1","#E3002B",he.white],line_name:["地鐵線","Metro Line"],current_stn_idx:"jlaMj2",stn_list:{},namePosMTR:{isStagger:!0,isFlip:!0},customiseMTRDest:{isLegacy:!1,terminal:!1},line_num:"1",psd_num:"1",info_panel_type:ls.sh,direction_gz_x:40,direction_gz_y:70,coline:{},loop:!1,loop_info:{bank:!0,left_and_right_factor:0,bottom_factor:1}},ks={name:["",""],num:"",services:[os.local],parents:[],children:[],transfer:{groups:[{}],tick_direc:rs.right,paid_area:!0},loop_pivot:!1,one_line:!0,int_padding:355},Os=e=>`${e[0]}/${e[1]}=${e[2]}${e[3]}`,Es=e=>pe.includes(e),As=(e,t)=>{const[s,n]=e.extremities(t),r=e.getEdgeAttributes(t),i=r.style;if(s!=n&&Es(i)){const e=(e=>{if(Es(e.style))return structuredClone(e[e.style].color)})(r);us.has(Os(e))||(hs.add(e),us.add(Os(e)),ps.set(e,s),ms.set(Os(e),new Set)),ms.get(Os(e)).add(s),ms.get(Os(e)).add(n),js.has(s)?fs.push({target:n,next:js.get(s),color:e}):fs.push({target:n,next:-1,color:e}),js.set(s,ws),ws++,js.has(n)?fs.push({target:s,next:js.get(n),color:e}):fs.push({target:s,next:-1,color:e}),js.set(n,ws),ws++}},Ms=(e,t,s)=>{if(ms.get(Os(s)).has(e)){ms.get(Os(s)).delete(e);for(let t=js.get(e);-1!=t;t=fs[t].next){const n=fs[t].target,r=fs[t].color;Os(r)==Os(s)&&Ms(n,e,s)}}},_s=(e,t,s)=>{if(cs.has(e))return;cs.add(e);let n=0;const r=new Set;for(let i=js.get(e);-1!=i;i=fs[i].next){const o=fs[i].target,a=fs[i].color;Os(a)==Os(s)&&(r.has(o)||(r.add(o),n++,o!=t&&_s(o,e,s)))}bs.set(e,n)},Ns=(e,t)=>{const s=e.stn_list.lineend.parents;s.push(t),e.stn_list.lineend.parents=structuredClone(s).reverse(),e.stn_list.lineend.branch={...e.stn_list.lineend.branch,left:2==e.stn_list.lineend.parents.length?[is.through,s[1]]:void 0}},Hs=(e,t,s)=>{if(vs.has(e))return[];vs.add(e);const n=[];for(let r=js.get(e);-1!=r;r=fs[r].next){const i=fs[r].target,o=fs[r].color;i!=t&&Os(o)==Os(s)&&(i.startsWith("stn")?n.push(i):n.push(...Hs(i,e,s)))}return n},Rs=(e,t,s,n,r,i,o)=>{if(cs.has(e)&&(!e.startsWith("misc_node_")&&null==o.stn_list[e]||e.startsWith("misc_node_")&&!ds.has(e)||o.loop))return[];if(cs.has(e)&&null!=o.stn_list[e]&&((e,t)=>{let s=0;for(let n=js.get(e);-1!=n;n=fs[n].next){fs[n].target;const e=fs[n].color;Os(e)==Os(t)&&s++}return s})(e,i)-1>=2){var a;const s=[...o.stn_list[e].parents,t];if(null==o.stn_list[s[1]]){const e=s[0];s[0]=s[1],s[1]=e}o.stn_list[e].parents=structuredClone(s).reverse(),o.stn_list[e].branch={...o.stn_list[e].branch,left:[is.through,s[1]]};const n=[];for(const i of o.stn_list[e].children)i!=t&&n.push(i);o.stn_list[e].children=structuredClone(n),null===(a=o.stn_list[e].branch)||void 0===a||delete a.right;const r=[];for(const t of o.stn_list.lineend.parents)t!=e&&r.push(t);return o.stn_list.lineend.parents=structuredClone(r).reverse(),o.stn_list.lineend.branch={...o.stn_list.lineend.branch,left:2==o.stn_list.lineend.parents.length?[is.through,r[1]]:void 0},0==n.length&&(o.stn_list[e].children=["lineend"],Ns(o,e)),[e]}cs.add(e);const l=[],c=[],d=[],h=new Set,u=new Set;for(let p=js.get(e);-1!=p;p=fs[p].next){const a=fs[p].target,c=fs[p].color;if(a!=s){if(Os(c)==Os(i)){if(u.has(a))continue;if(u.add(a),e.startsWith("misc_node_")){const s=Rs(a,t,e,n+1,r,i,o);0!=s.length&&l.push(...s)}else{const t=Rs(a,e,e,n+1,r,i,o);0!=t.length&&l.push(...t)}}if(!h.has(Os(c))&&Os(c)!=Os(i)){h.add(Os(c));const e={theme:c,name:[`ch_${Os(c)}`,`en_${Os(c)}`]};d.push(e)}}}if(2==l.length){for(let e=0;e<2;e++)"lineend"==l[e]&&l.splice(e,1);if(o.stn_list[l[1]].parents.length>=2){const e=l[0];l[0]=l[1],l[1]=e}}if(cs.has(e)&&null!=o.stn_list[e]){const s=[];for(const t of o.stn_list.lineend.parents)t!=e&&s.push(t);o.stn_list.lineend.parents=structuredClone(s).reverse(),o.stn_list.lineend.branch={...o.stn_list.lineend.branch,left:2==o.stn_list.lineend.parents.length?[is.through,s[1]]:void 0},0==l.length&&(vs.clear(),c.push(...Hs(e,t,i)))}if(e.startsWith("misc_node_"))return ds.add(e),l;{const s=r.getNodeAttributes(e).type,a=r.getNodeAttributes(e)[s];if(o.stn_list[e]=structuredClone(ks),o.stn_list[e].name=[a.names[0],a.names[1]],o.stn_list[e].num=String(n),r.getNodeAttributes(e).type==ce.GzmtrBasic){const t=a;o.stn_list[e].num=t.stationCode,o.stn_list[e].secondaryName=t.secondaryNames}if(r.getNodeAttributes(e).type==ce.GzmtrInt){const t=a,s=t.transfer[0];for(const n of s)if(Os(n)==Os(i)){o.stn_list[e].num=String(n[5]);break}o.stn_list[e].secondaryName=t.secondaryNames}return 0!=l.length?(o.stn_list[e].children=structuredClone(l).reverse(),2==l.length&&(o.stn_list[e].branch={...o.stn_list[e].branch,right:[is.through,l[1]]})):(o.stn_list[e].children=["lineend"],Ns(o,e)),c.push(t),o.stn_list[e].parents=structuredClone(c).reverse(),2==c.length&&(o.stn_list[e].branch={...o.stn_list[e].branch,left:[is.through,c[1]]}),0!=d.length&&(o.stn_list[e].transfer.groups[0].lines=structuredClone(d)),[e]}},Ws=(e,t,s,n)=>{const r=structuredClone(Cs);let i;switch("LOOP"==n&&(r.loop=!0),e.getNodeAttributes(s).type){case ce.GzmtrBasic:case ce.GzmtrInt:i=as.GZMTR;break;case ce.MTR:i=as.MTR;break;default:i=as.SHMetro}r.theme=structuredClone(t),r.style=i,r.stn_list.linestart=structuredClone(Ss),r.stn_list.lineend=structuredClone(zs),cs.clear(),ds.clear();const o=Rs(s,"linestart","linestart",1,e,t,r);return r.current_stn_idx=o[0],r.stn_list.linestart.children=[o[0]],Object.keys(r.stn_list).length<=3||r.stn_list.lineend.parents.length>=3?void 0:structuredClone(r)},Ls=(e,t,s,n)=>{var r;e.line_name=t,e.line_num=String(s),Qt(`RMG_${r=t,""!=r[0]&&""!=r[1]?r[0]+"_"+r[1]:""!=r[0]?r[0]:""!=r[1]?r[1]:`${(new Date).valueOf()}`}.json`,"application/json",((e,t)=>{let s=e;return t.forEach(((e,t)=>{const n=new RegExp(`ch_${t}`,"g"),r=new RegExp(`en_${t}`,"g");s=s.replace(n,e[0]),s=s.replace(r,e[1])})),s})(JSON.stringify(e),n))},Ts={LINE:"#33ccff",BRANCH:"#007B61",LOOP:"#ff6666"},Is=e=>{const{isOpen:t,onClose:c}=e,{t:d}=kt(),u=Ot.useRef(window.graph),[p,m]=Ot.useState(!1),[x,g]=Ot.useState([[Cs,"",""]]),[j,f]=Ot.useState(["","",""]),[v,S]=Ot.useState(new Map),[z,C]=Ot.useState(new Map),[k,O]=Ot.useState([]);Ot.useEffect((()=>{if(t){const e=(e=>{cs.clear(),hs.clear(),us.clear(),ps.clear(),ms.clear(),xs.clear(),gs.clear(),js.clear(),fs=[],ws=0,bs.clear(),ys.clear(),e.filterEdges((e=>e.startsWith("line"))).forEach((t=>{Es(e.getEdgeAttributes(t).style)&&As(e,t)}));let t=0;e.forEachNode((e=>{ys.set(e,++t)})),ys.set("lineend",++t);const s=[];for(const n of hs){let e=0;for(;0!=ms.get(Os(n)).size;){let t="line_root";ms.get(Os(n)).forEach((e=>{"line_root"==t&&(t=e)})),Ms(t,"line_root",n);const s={theme:n,index:++e};xs.add(s),gs.set(s,t)}}for(const n of xs){const{theme:t}=n;cs.clear(),bs.clear(),_s(gs.get(n),"line_root",t);let r=!0,i="LINE";const o=[];for(const[e,s]of bs)1==s&&o.push(e),3==s&&(i="BRANCH"),s>3&&(r=!1);if(!r)continue;0==o.length&&(i="LOOP",o.push(ps.get(t)));const a=[];for(const s of o){const n=Ws(e,t,s,i);null!=n&&a.push([n,n.stn_list[n.current_stn_idx].name[0],n.stn_list[n.current_stn_idx].name[1]])}0!=a.length&&s.push({id:ue(10),theme:t,param:structuredClone(a),type:i})}return s})(u.current),t=new Map;e.forEach((({id:e,theme:s})=>{t.set(Os(s),e)})),O(e),S(t)}}),[t]);const E=(e,t)=>document.getElementById("2RMG_"+t+"_"+e).value.trim();return s.jsxs(n,{isOpen:t,onClose:c,size:"2xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:s.jsx(h,{as:"b",fontSize:"xl",children:d("header.download.2rmg.title")})}),s.jsx(a,{}),s.jsxs(l,{children:[s.jsx(h,{fontSize:"sm",mt:"3",lineHeight:"100%",children:d("header.download.2rmg.info1")}),s.jsx(h,{fontSize:"sm",mt:"3",lineHeight:"100%",children:d("header.download.2rmg.info2")}),s.jsx("br",{}),0===k.length?s.jsx(h,{fontSize:"md",children:d("header.download.2rmg.noline")}):s.jsx("table",{children:s.jsx("tbody",{children:k.map((({id:e,theme:t,param:n,type:r})=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(me,{name:"other"==t[0]&&"other"==t[1]?t[2]:t[1],bg:t[2],fg:t[3]})}),s.jsx("td",{children:s.jsx(w,{placeholder:d("header.download.2rmg.placeholder.chinese"),id:`2RMG_nameCh_${e}`,size:"sm"})}),s.jsx("td",{children:s.jsx(w,{placeholder:d("header.download.2rmg.placeholder.english"),id:`2RMG_nameEn_${e}`,size:"sm"})}),s.jsx("td",{children:s.jsx(w,{placeholder:d("header.download.2rmg.placeholder.lineCode"),id:`2RMG_lineNum_${e}`,size:"sm"})}),s.jsx("td",{children:s.jsx(me,{name:d(`header.download.2rmg.type.${r.toLowerCase()}`),bg:Ts[r],fg:he.white})}),s.jsx("td",{children:s.jsx(b,{colorScheme:"blue",variant:"ghost",mr:"1",onClick:()=>{const t=E(e,"nameCh"),s=E(e,"nameEn"),r=E(e,"lineNum"),i=new Map;v.forEach(((e,t)=>{i.set(t,[E(e,"nameCh"),E(e,"nameEn")])})),g(n),f([t,s,r]),C(i),m(!0)},size:"sm",children:s.jsx(xe,{})})})]},JSON.stringify(t))))})})]}),s.jsx(y,{children:s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:d("close")})})]}),s.jsx(Ps,{isOpen:p,onClose:()=>m(!1),param:x,nameList:j,interchangeName:z})]})},Ps=e=>{const{isOpen:t,onClose:c,param:d,nameList:u,interchangeName:p}=e,{t:m}=kt(),[x,g]=Ot.useState("");return Ot.useEffect((()=>{""!=u[0]&&""!=u[1]?g(u[0]+"/"+u[1]):""!=u[0]?g(u[0]):""!=u[1]?g(u[1]):g("")}),[...u]),s.jsxs(n,{isOpen:t,onClose:c,size:"md",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:s.jsxs(h,{as:"b",fontSize:"xl",children:[m("header.download.2rmg.download")," ",x]})}),s.jsx(a,{}),s.jsx(l,{children:s.jsxs(v,{children:[s.jsx(h,{fontSize:"sm",mb:"2",lineHeight:"100%",children:m("header.download.2rmg.downloadInfo")}),d.map((([e,t,n])=>s.jsxs(b,{onClick:()=>{Ls(e,[u[0],u[1]],u[2],p)},overflow:"hidden",size:"md",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:[t.replaceAll("\\","⏎"),"/",n.replaceAll("\\","⏎")]},`${t}${n}`)))]})}),s.jsx(y,{children:s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:m("close")})})]})]})},Bs=e=>{const{isOpen:t,onClose:c}=e,{t:d}=kt();return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:d("header.download.termsAndConditions")}),s.jsx(a,{}),s.jsx(l,{children:s.jsxs(S,{children:[s.jsxs(z,{children:["The layout of the elements on the signage or rail map, is designed by"," ",s.jsxs(C,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["Shanghai Shentong Metro Group ",s.jsx(k,{as:ge})]}),", ",s.jsxs(C,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["Guangzhou Metro Group ",s.jsx(k,{as:ge})]})," or ",s.jsxs(C,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["MTR Corporation ",s.jsx(k,{as:ge})]}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the generated images for commercial purposes, if it is required to do so.",s.jsx("br",{}),"标志版或路线图的元素或布局，基于你所选择的风格，为",s.jsxs(C,{color:"teal.500",href:"https://www.shmetro.com/",isExternal:!0,children:["上海申通地铁集团 ",s.jsx(k,{as:ge})]}),"，",s.jsxs(C,{color:"teal.500",href:"https://www.gzmtr.com/",isExternal:!0,children:["广州地铁集团公司 ",s.jsx(k,{as:ge})]}),"或",s.jsxs(C,{color:"teal.500",href:"https://www.mtr.com.hk/",isExternal:!0,children:["港铁公司 ",s.jsx(k,{as:ge})]}),"所设计。在产生的图像用作商业用途前，你应向相关公司取得适当之许可证或授权。"]}),s.jsxs(z,{children:["The elements including shapes and lines on the image are drawn by"," ",s.jsxs(C,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",s.jsx(k,{as:ge})]})," and ",s.jsxs(C,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",s.jsx(k,{as:ge})]}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside.",s.jsx("br",{}),"图像的元素，包括图形及线条，均由",s.jsxs(C,{color:"teal.500",href:"https://www.github.com/thekingofcity",isExternal:!0,children:["thekingofcity ",s.jsx(k,{as:ge})]}),"及",s.jsxs(C,{color:"teal.500",href:"https://www.github.com/wongchito",isExternal:!0,children:["Chito Wong ",s.jsx(k,{as:ge})]}),"基于上述公司设计标准或准则绘制。你可将其用于任何目的，但我们建议你于使用同时附以我们的名字以及本网站地址。"]}),s.jsxs(z,{children:["Due to copyright, licensing and other legal restrictions, Rail Map Painter uses"," ",s.jsxs(C,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["GenYoMin provided by ButTaiwan ",s.jsx(k,{as:ge})]}),", and Vegur instead of MTRSung and Myriad Pro respectively to display and generate MTR-style signage. You shall grant appropriate permit or license from the manufacturers before using those generated images for commercial purposes.",s.jsx("br",{}),"由于著作权及其他法律限制，铁路路线图绘制器使用由",s.jsxs(C,{color:"teal.500",href:"https://github.com/ButTaiwan/genyo-font",isExternal:!0,children:["ButTaiwan提供的源樣明體 ",s.jsx(k,{as:ge})]}),"，以及Vegur，以代替港铁样式标志牌所使用的地铁宋及Myriad Pro。在产生之图像用作商业用途前，你应向字型生产厂商取得适当之许可证或授权。"]}),s.jsxs(z,{children:["The exported images in PNG or SVG format may be modified, published, or used for other purposes except commercial use, under the conditions above.",s.jsx("br",{}),"输出的PNG或SVG图像可基于上述条款，在非商业使用时，用于修改、发行或其他用途。"]}),s.jsxs(z,{children:["All flag emojis shown on Windows platforms are designed by"," ",s.jsxs(C,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",s.jsx(k,{as:ge})]})," ","– the open-source emoji and icon project. License:",s.jsxs(C,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",s.jsx(k,{as:ge})]}),s.jsx("br",{}),"于Windows作业系统上显示的国旗Emoji为",s.jsxs(C,{color:"teal.500",href:"https://openmoji.org/",isExternal:!0,children:["OpenMoji ",s.jsx(k,{as:ge})]}),"所设计。许可证：",s.jsxs(C,{color:"teal.500",href:"https://creativecommons.org/licenses/by-sa/4.0/",isExternal:!0,children:["CC BY-SA 4.0 ",s.jsx(k,{as:ge})]})]}),s.jsxs(z,{children:["We reserve the rights, without prior notice, to modify, add, or remove these terms. The Chinese translation is for reference only. In case of any discrepancy between the English version and the Chinese version, the English version shall prevail.",s.jsx("br",{}),"我们保留修改、新增或移除上述条款之权利，而无需另行通知。中文译本仅供参考，文义如与英文有歧异，概以英文本为准。"]})]})})]})]})};function Gs(){const e=O("white","var(--chakra-colors-gray-800)"),t=je(),{telemetry:{app:c,project:d}}=re((e=>e.app)),u=re((e=>e.param)),{t:p}=kt(),m=Ot.useRef(window.graph),[x,g]=Ot.useState("png"),j={png:p("header.download.png"),svg:p("header.download.svg")},[f,w]=Ot.useState(2),[v,S]=Ot.useState({width:1,height:1,benchmark:.001}),[z,L]=Ot.useState(200),T=[10,25,33,50,67,75,100,125,150,175,200,250,300,400,500,750,1e3],I=Object.fromEntries(T.map((e=>[e,`${e}%`]))),[P,B]=Ot.useState([]),[G,U]=Ot.useState(!1),Z=[{type:"select",label:p("header.download.format"),value:x,options:j,onChange:e=>g("png"===e?"png":"svg")}],D=[{type:"select",label:p("header.download.svgVersion"),value:f,options:{1.1:p("header.download.svg1.1"),2:p("header.download.svg2")},onChange:e=>{w(e),1.1===e&&X(!0)}}],K=[{type:"select",label:p("header.download.scale"),value:z,options:I,disabledOptions:P,onChange:e=>L(e)},{type:"switch",label:p("header.download.transparent"),isChecked:G,onChange:U}],[Y,V]=Ot.useState(!1),[F,q]=Ot.useState(!1),[J,X]=Ot.useState(!1),[Q,$]=Ot.useState(!1),[ee,te]=Ot.useState(!1),[se,oe]=Ot.useState(!1);return Ot.useEffect((()=>{(async()=>{const e=await Xt.maxArea({usePromise:!0,useWorker:!0});S(e)})()}),[]),Ot.useEffect((()=>{if(Y){const{xMin:e,yMin:t,xMax:s,yMax:n}=ae(m.current),[r,i]=[s-e,n-t],o=T.filter((e=>r*e/100>v.width&&i*e/100>v.height));B(o)}}),[Y]),s.jsxs(E,{id:"download",children:[s.jsx(A,{as:M,size:"sm",variant:"ghost",icon:s.jsx(xe,{})}),s.jsxs(_,{children:[s.jsx(N,{icon:s.jsx(fe,{}),onClick:()=>{c&&ne.event(ie.DOWNLOAD_PARAM,d?{"#nodes":m.current.order,"#edges":m.current.size}:{}),Qt(`RMP_${(new Date).valueOf()}.json`,"application/json",ve(u))},children:p("header.download.config")}),s.jsxs(N,{icon:s.jsx(we,{}),onClick:()=>oe(!0),children:[p("header.download.2rmg.title"),s.jsx(H,{ml:"1",colorScheme:"green",children:"New"})]}),s.jsx(N,{icon:s.jsx(be,{}),onClick:()=>V(!0),children:p("header.download.image")})]}),s.jsxs(n,{size:"xl",isOpen:Y,onClose:()=>V(!1),children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:p("header.download.image")}),s.jsx(a,{}),s.jsxs(l,{children:[s.jsx(ye,{fields:Z}),"svg"===x&&s.jsx(ye,{fields:D}),"png"===x&&s.jsx(ye,{fields:K}),"png"===x&&P.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(h,{as:"i",fontSize:"sm",children:p("header.download.disabledScaleOptions")}),s.jsx("br",{}),s.jsx(h,{as:"i",fontSize:"sm",children:p("header.download.disabledScaleOptionsWorkarounds")}),s.jsxs(C,{color:"teal.500",onClick:()=>window.open("https://github.com/RazrFalcon/resvg","_blank"),children:["RazrFalcon/resvg ",s.jsx(k,{as:ge})]}),s.jsx("br",{})]}),s.jsx("br",{}),s.jsx(R,{isChecked:J,isDisabled:"svg"===x&&1.1===f,onChange:e=>X(e.target.checked),children:s.jsx(h,{children:p("header.download.useSystemFonts")})}),s.jsx(R,{isChecked:Q,onChange:e=>$(e.target.checked),children:s.jsxs(h,{children:[p("header.download.shareInfo1"),s.jsxs(C,{color:"teal.500",onClick:()=>window.open("https://railmapgen.github.io/rmp","_blank"),children:[p("header.about.rmp")," ",s.jsx(k,{as:ge})]}),p("header.download.shareInfo2")]})}),s.jsx(R,{isChecked:ee,onChange:e=>te(e.target.checked),children:s.jsxs(h,{children:[p("header.download.termsAndConditionsInfo"),s.jsxs(C,{color:"teal.500",onClick:()=>q(!0),children:[p("header.download.termsAndConditions")," ",s.jsx(k,{as:ge})]}),p("header.download.period")]})})]}),s.jsx(y,{children:s.jsx(W,{children:s.jsx(b,{colorScheme:"teal",variant:"outline",size:"sm",isDisabled:!ee||P.includes(z),onClick:async()=>{V(!1),c&&ne.event(ie.DOWNLOAD_IMAGES,d?{numberOfNodes:m.current.order,numberOfEdges:m.current.size}:{});const{elem:s,width:n,height:r}=await es(m.current,Q,J,f),i=s.outerHTML.replace(/&nbsp;/g," ");if("svg"===x)return void Qt(`RMP_${(new Date).valueOf()}.svg`,"image/svg+xml",i);document.body.appendChild(s);const o="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)));document.body.removeChild(s),s.remove();const a=document.createElement("canvas"),[l,h]=[n*z/100,r*z/100];a.width=l,a.height=h;const u=a.getContext("2d");G||(u.fillStyle=e,u.fillRect(0,0,l,h));const g=new Image;g.onload=()=>{setTimeout((()=>{u.drawImage(g,0,0,l,h),a.toBlob((e=>{e?$t(`RMP_${(new Date).valueOf()}.png`,e):t(Se({status:"error",message:p("header.download.imageTooBig")}))}),"image/png")}),Wt()?2e3:0)},g.src=o},children:p("header.download.confirm")})})}),s.jsx(Bs,{isOpen:F,onClose:()=>q(!1)})]})]}),s.jsx(Is,{isOpen:se,onClose:()=>oe(!1)})]})}const Us=(e,{info_panel_type:t,line_num:s,stn_list:n,style:r,theme:i},o)=>{const a=Object.fromEntries(Object.keys(n).filter((e=>!["linestart","lineend"].includes(e))).map((e=>[e,`stn_${ue(10)}`])));Object.entries(n).filter((([e,t])=>!["linestart","lineend"].includes(e))).forEach((([t,s])=>{const n=e.filterNodes(((e,t)=>Object.values(ce).includes(t.type)&&t[t.type].names[0]===s.name[0]));0!==n.length&&(a[t]=n[0])})),Object.entries(n).filter((([e,t])=>!["linestart","lineend"].includes(e))).filter((([t,s])=>0===e.filterNodes(((e,t)=>Object.values(ce).includes(t.type)&&t[t.type].names[0]===s.name[0])).length)).forEach((([n,o],l)=>{let c=ce.ShmetroBasic;const d=o.transfer.groups,h=d.map((e=>{var t;return null!==(t=e.lines)&&void 0!==t?t:[]})).flat();r===as.SHMetro?c=h.length>0?ce.ShmetroInt:t===ls.sh2020?ce.ShmetroBasic2020:ce.ShmetroBasic:r===as.GZMTR?c=h.length>0?ce.GzmtrInt:ce.GzmtrBasic:r===as.MTR&&(c=ce.MTR);const u={...structuredClone(Lt[c].defaultAttrs),names:o.name};if(c===ce.ShmetroBasic2020)u.color=i;else if(c===ce.GzmtrBasic)u.color=i,u.lineCode=s,u.stationCode=o.num;else if(c===ce.GzmtrInt)u.transfer=d.map(((e,t)=>{var n,r;const a=null!==(n=null===(r=e.lines)||void 0===r?void 0:r.map((e=>{var t;return[...null!==(t=e.theme)&&void 0!==t?t:i,"1","01"]})))&&void 0!==n?n:[];return 0===t?[[...i,s,o.num],...a]:a}));else if(c===ce.MTR){var p;null!==(p=d[0].lines)&&void 0!==p&&p.length?u.transfer=[[[...i,"",""],...d[0].lines.map((e=>{var t;return[...null!==(t=e.theme)&&void 0!==t?t:i,"",""]}))]]:u.transfer=[[]]}e.addNode(a[n],{visible:!0,zIndex:0,x:100+50*l,y:1e3,type:c,[c]:u})})),Object.entries(n).filter((([e,t])=>!["linestart","lineend"].includes(e))).forEach((([t,s])=>{s.children.filter((e=>!["linestart","lineend"].includes(e))).forEach((s=>{const n=ze.Diagonal,[r,l]=[a[t],a[s]],c=o?Ce(e,n,r,l,"from"):-1;e.addDirectedEdgeWithKey(`line_${ue(10)}`,r,l,{visible:!0,zIndex:0,type:n,[ze.Diagonal]:structuredClone(ke[ze.Diagonal].defaultAttrs),style:Oe.SingleColor,[Oe.SingleColor]:{color:i},reconcileId:"",parallelIndex:c})}))}))},Zs="rmg-bridge--",Ds={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Ks(e){const{isOpen:t,onClose:n,onImport:r}=e,[i]=Et.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:ne.getAppName(),parentId:i});return Et.useEffect((()=>{const e=new BroadcastChannel(Zs+i);return e.onmessage=e=>{const{event:t,data:s}=e.data;console.log("[rmp] Received event from RMG app clip:",t),"CLOSE"===t?n():"IMPORT"===t&&r(s)},()=>e.close()}),[]),s.jsx(Ee,{isOpen:t,onClose:n,sx:Ds,children:s.jsx("iframe",{src:o,loading:"lazy"})})}const Ys="OPEN_TEMPLATE",Vs=new BroadcastChannel("RMP_GALLERY_CHANNEL"),Fs={h:"80%",w:"80%","& iframe":{h:"100%",w:"100%"},"& div":{h:"100%",w:"100%"}};function qs(e){const{isOpen:t,onClose:n}=e,r=L(),{t:i}=kt(),o=je(),{telemetry:{app:a,project:l}}=re((e=>e.app)),c=Ot.useRef(window.graph),d=Ot.useCallback((()=>{o(Ae()),o(Me()),o(_e(c.current.export()))}),[o,Ae,Me,_e,c]),h=async(e,t)=>{var s;const n=t?`https://${t}`:"",h=await(null===(s=(await Promise.allSettled([fetch(`${n}/rmp-gallery/resources/real_world/${e}.json`),fetch(`${n}/rmp-gallery/resources/fantasy/${e}.json`)])).filter((e=>"fulfilled"===e.status)).find((e=>200===e.value.status)))||void 0===s?void 0:s.value.json());if(h){if(a){const s={id:e};l&&t&&(s.host=t),ne.event(ie.IMPORT_WORK_FROM_GALLERY,s)}(async e=>{const{version:t,...s}=JSON.parse(await Ne(JSON.stringify(e)));o(He()),c.current.clear(),c.current.import(s.graph),d();const{svgViewBoxZoom:n,svgViewBoxMin:r}=s;"number"==typeof n&&o(Re(n)),"number"==typeof r.x&&"number"==typeof r.y&&o(We(r))})(h),r({title:i("header.open.importFromRMPGallery",{id:e}),status:"success",duration:9e3,isClosable:!0})}else r({title:i("header.open.failToImportFromRMPGallery",{id:e}),status:"error",duration:9e3,isClosable:!0})};return Ot.useEffect((()=>{const e=new URL(window.location.href).searchParams;if(e.size>0){const t=e.keys().next().value,s=t.indexOf("."),n=t.substring(0,-1===s?void 0:s);let r;-1!==s&&(r=t.substring(s+1)),h(n,r)}}),[]),Ot.useEffect((()=>(Vs.onmessage=e=>{const{event:t,data:s}=e.data;t===Ys&&(h(s),n())},()=>Vs.close())),[]),s.jsxs(Ee,{isOpen:t,onClose:n,size:"full",sx:Fs,children:[s.jsx("iframe",{src:"/rmp-gallery/",loading:"lazy"}),s.jsx(T,{onClick:n,position:"fixed",top:"5px",right:"15px"})]})}function Js(){const{t:e}=kt(),t=je(),{telemetry:{project:n},preference:{autoParallel:r}}=re((e=>e.app)),i=Ot.useRef(window.graph),o=Ot.useRef(null),[a,l]=Ot.useState(!1),[c,d]=Ot.useState(!1),h=Ot.useCallback((()=>{t(Ae()),t(Me()),t(_e(i.current.export()))}),[t,Ae,Me,_e,i]),u=async e=>{const{version:s,...n}=JSON.parse(await Ne(e));t(He()),i.current.clear(),i.current.import(n.graph),h();const{svgViewBoxZoom:r,svgViewBoxMin:o}=n;"number"==typeof r&&t(Re(r)),"number"==typeof o.x&&"number"==typeof o.y&&t(We(o))};Ot.useEffect((()=>{const e=async e=>{const{type:t,key:s,from:n}=e.data;if(t===Ze.SAVE_CHANGED&&s===De.PARAM&&"rmt"===n){Ke.debug(`Received save changed event on key: ${s}`);const e=localStorage.getItem(De.PARAM);if(!e)return;await u(e)}};return Le.addEventListener("message",e),()=>Le.removeEventListener("message",e)}),[]);const p=Tt(),{height:m}=Te(p);return s.jsxs(E,{children:[s.jsx(A,{as:M,size:"sm",variant:"ghost",icon:s.jsx(Ie,{})}),s.jsxs(_,{children:[s.jsx(N,{icon:s.jsx(Pe,{}),onClick:()=>{t(He()),i.current.clear(),t(Re(100)),t(We({x:0,y:0})),h()},children:e("header.open.new")}),s.jsx("input",{id:"upload_project",ref:o,type:"file",accept:".json",hidden:!0,onChange:async s=>{var n;const r=null===(n=s.target.files)||void 0===n?void 0:n[0];if(console.log("OpenActions.handleUpload():: received file",r),"application/json"!==(null==r?void 0:r.type))t(Se({status:"error",message:e("header.open.invalidType")})),console.error("OpenActions.handleUpload():: Invalid file type! Only file in JSON format is accepted.");else try{const e=await Xs(r);await u(e)}catch(i){t(Se({status:"error",message:e("header.open.unknownError")})),console.error("OpenActions.handleUpload():: Unknown error occurred while parsing the uploaded file",i)}s.target.value=""},"data-testid":"file-upload"}),s.jsx(N,{icon:s.jsx(Ie,{}),onClick:()=>{var e;return null==o||null===(e=o.current)||void 0===e?void 0:e.click()},children:e("header.open.config")}),s.jsx(N,{icon:s.jsx(Be,{}),onClick:()=>l(!0),children:e("header.open.projectRMG")}),s.jsxs(N,{icon:s.jsx(ge,{}),onClick:()=>d(!0),children:[e("header.open.gallery"),s.jsx(H,{ml:"1",colorScheme:"green",children:"New"})]}),s.jsx(N,{icon:s.jsx(Ge,{}),onClick:async()=>{await u(await Ue()),t(We({x:-10,y:-13}));const e=Math.max(0,Math.min(400,-.132*m+117.772));t(Re(e)),ne.event(ie.LOAD_TUTORIAL,{})},children:e("header.open.tutorial")})]}),s.jsx(Ks,{isOpen:a,onClose:()=>l(!1),onImport:s=>{try{n&&ne.event(ie.IMPORT_RMG_PARAM,{}),Us(i.current,s,r),h()}catch(o){t(Se({status:"error",message:e("header.open.unknownError")})),console.error("OpenActions.handleUploadRMG():: Unknown error occurred while parsing the RMG project",o)}finally{l(!1)}}}),s.jsx(qs,{isOpen:c,onClose:()=>d(!1)})]})}const Xs=e=>new Promise((t=>{const s=new FileReader;s.onloadend=()=>t(s.result),s.readAsText(e)})),Qs=e=>{const{isOpen:t,onClose:c}=e,d=je(),{theme:h,paletteAppClip:{output:u}}=re((e=>e.runtime)),{t:p}=kt(),m=Ot.useRef(window.graph),[x,g]=Ot.useState(h),[j,f]=Ot.useState(!1);return Ot.useEffect((()=>{j&&u&&(g(u),f(!1))}),[null==u?void 0:u.toString()]),s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:p("header.settings.procedures.removeLines.title")}),s.jsx(a,{}),s.jsxs(l,{children:[p("header.settings.procedures.removeLines.content"),s.jsx(Ye,{theme:x,onClick:()=>{f(!0),d(Ve(x))}})]}),s.jsxs(y,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:p("cancel")}),s.jsx(b,{colorScheme:"red",onClick:()=>{m.current.filterEdges(((e,t,s,n,r,i,o)=>pe.includes(t.style)&&JSON.stringify(t[t.style].color)===JSON.stringify(x))).forEach((e=>m.current.dropEdge(e))),d(Me()),d(_e(m.current.export())),c()},children:p("remove")})]})]})]})},$s=e=>{const{isOpen:t,onClose:c}=e,d=je(),{t:h}=kt(),u=Ot.useRef(window.graph),[p,m]=Ot.useState(1),x=[{type:"input",label:h("header.settings.procedures.scale.factor"),value:p.toString(),variant:"number",onChange:e=>m(Number(e)),minW:"full"}];return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:h("header.settings.procedures.scale.title")}),s.jsx(a,{}),s.jsxs(l,{children:[h("header.settings.procedures.scale.content"),s.jsx(ye,{fields:x})]}),s.jsxs(y,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:h("cancel")}),s.jsx(b,{colorScheme:"red",onClick:()=>{u.current.forEachNode(((e,t)=>{u.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)*p)),u.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)*p))})),d(Ae()),d(Me()),d(_e(u.current.export())),c()},children:h("apply")})]})]})]})},en=e=>{const{isOpen:t,onClose:c}=e,d=je(),{t:h}=kt(),u=Ot.useRef(window.graph),[p,m]=Ot.useState(0),[x,g]=Ot.useState(0),j=[{type:"input",label:h("header.settings.procedures.translate.x"),value:p.toString(),variant:"number",onChange:e=>m(Number(e)),minW:"full"},{type:"input",label:h("header.settings.procedures.translate.y"),value:x.toString(),variant:"number",onChange:e=>g(Number(e)),minW:"full"}];return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:h("header.settings.procedures.translate.title")}),s.jsx(a,{}),s.jsxs(l,{children:[h("header.settings.procedures.translate.content"),s.jsx(ye,{fields:j})]}),s.jsxs(y,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:h("cancel")}),s.jsx(b,{colorScheme:"red",onClick:()=>{u.current.forEachNode(((e,t)=>{u.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)+p)),u.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)+x))})),d(Ae()),d(Me()),d(_e(u.current.export())),c()},children:h("apply")})]})]})]})},tn=e=>{const{isOpen:t,onClose:c}=e,d=je(),{activeSubscriptions:u}=re((e=>e.account)),{t:p}=kt();return s.jsxs(n,{isOpen:t,onClose:c,size:"5xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:p("header.settings.procedures.unlockSimplePath.title")}),s.jsx(a,{}),s.jsxs(l,{children:[s.jsx(h,{mb:"2",children:p("header.settings.procedures.unlockSimplePath.content1")}),s.jsx(h,{mb:"2",children:p("header.settings.procedures.unlockSimplePath.content2")}),s.jsx(h,{mb:"2",children:p("header.settings.procedures.unlockSimplePath.content3")})]}),s.jsx(y,{children:s.jsx(I,{label:p("header.settings.pro"),isOpen:!u.RMP_CLOUD,children:s.jsx(b,{onClick:()=>{d(Fe(-1))},isDisabled:!u.RMP_CLOUD,children:p("header.settings.procedures.unlockSimplePath.check")})})})]})]})},sn=e=>{const{isOpen:t,onClose:c}=e,d=je(),u=L(),{t:p}=kt(),m=Ot.useRef(window.graph),[x,g]=Ot.useState(!1);return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:p("header.settings.procedures.updateColor.title")}),s.jsx(a,{}),s.jsx(l,{children:s.jsx(h,{children:p("header.settings.procedures.updateColor.content")})}),s.jsxs(y,{children:[s.jsx(b,{colorScheme:"blue",variant:"outline",mr:"1",onClick:c,children:p("cancel")}),s.jsx(b,{colorScheme:"red",onClick:async()=>{g(!0);const e=JSON.stringify(m.current.export());try{const t=await on(e);m.current.clear(),m.current.import(t),d(Ae()),d(Me()),d(_e(m.current.export())),u({title:p("header.settings.procedures.updateColor.success"),status:"success",duration:9e3,isClosable:!0})}catch(t){console.error(`[rmp] Error in updating all colors: ${t}`),u({title:p("header.settings.procedures.updateColor.error",{e:t}),status:"error",duration:9e3,isClosable:!0})}g(!1),c()},isLoading:x,children:p("apply")})]})]})]})},nn=e=>e.length>=4&&e.every((e=>"string"==typeof e))&&!!e[2].match(/^#[0-9a-fA-F]{6}$/)&&Object.values(he).includes(e[3]),rn=(e,t,s)=>{const n=t.split(".");let r=e;for(let i=0;i<n.length-1;i++)r=r[n[i]];r[n[n.length-1]]=s},on=async e=>{const t=JSON.parse(e),s=(new Date).getTime(),n=(e=>{const t=[],s=(e,n)=>{if(Array.isArray(e)&&nn(e))t.push({path:n||"",value:e});else for(const r in e){const i=e[r],o=n?`${n}.${r}`:r;Array.isArray(i)?nn(i)?t.push({path:o,value:i}):i.forEach(((e,t)=>s(e,`${o}.${t}`))):i&&"object"==typeof i&&s(i,o)}};return s(e),t})(t);console.log("[rmp] Found all themes pending for update",n);let r,i=!1;const o=new Promise(((e,s)=>{r=setTimeout((()=>{i=!0,s("Executing time exceeds 10000ms")}),1e4),(async()=>{for(const{path:e,value:s}of n){if(i)throw new Error("Update aborted");const[n,r,o,a,...l]=s,c=await qe([n,r,o,a]);rn(t,e,[...c,...l])}})().then(e).catch(s)}));try{return await o,console.log(`[rmp] Themes update completed, elapsed time ${((new Date).getTime()-s)/1e3} sec`),t}finally{clearTimeout(r)}},an={width:"100%",justifyContent:"space-between"},ln={fontFamily:"-apple-system"},cn=e=>{const{isOpen:t,onClose:c}=e,{activeSubscriptions:d}=re((e=>e.account)),{telemetry:{app:p},preference:{autoParallel:x}}=re((e=>e.app)),{keepLastPath:g,parallelLinesCount:j}=re((e=>e.runtime)),f=je(),{t:w}=kt(),y=O("primary.500","primary.300"),[v,S]=Ot.useState(!1),[z,E]=Ot.useState(!1),[A,M]=Ot.useState(!1),[_,N]=Ot.useState(!1),[R,W]=Ot.useState(!1),[L,T]=Ot.useState(!1),F=ne.isAllowAnalytics(),q=j>(d.RMP_CLOUD?Je:Xe);return s.jsxs(n,{isOpen:t,onClose:c,size:"xl",scrollBehavior:"inside",trapFocus:!1,children:[s.jsx(r,{}),s.jsxs(i,{children:[s.jsx(o,{children:w("header.settings.title")}),s.jsx(a,{}),s.jsx(l,{children:s.jsxs(m,{divider:s.jsx(P,{borderColor:"gray.200"}),children:[s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:w("header.settings.preference.title")}),s.jsxs(u,{mt:"3",children:[s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:w("header.settings.preference.keepLastPath")}),s.jsx(B,{isChecked:g,onChange:({target:{checked:e}})=>f(Qe(e))})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{children:w("header.settings.preference.autoParallel")}),s.jsx(I,{label:w("header.settings.proLimitExceed"),children:s.jsx(H,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})}),s.jsx(B,{isDisabled:q,isChecked:x,onChange:({target:{checked:e}})=>f($e(e))})]})]})]}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:w("header.settings.procedures.title")}),s.jsxs(u,{mt:"3",children:[s.jsx(b,{sx:an,rightIcon:s.jsx(et,{}),onClick:()=>S(!0),children:w("header.settings.procedures.translate.title")}),s.jsx(en,{isOpen:v,onClose:()=>S(!1)}),s.jsx(b,{sx:an,rightIcon:s.jsx(et,{}),onClick:()=>E(!0),children:w("header.settings.procedures.scale.title")}),s.jsx($s,{isOpen:z,onClose:()=>E(!1)}),s.jsxs(b,{sx:an,rightIcon:s.jsx(et,{}),onClick:()=>M(!0),children:[w("header.settings.procedures.changeType.title"),s.jsx(I,{label:w("header.settings.pro"),children:s.jsx(H,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),s.jsx(Pt,{isOpen:A,onClose:()=>M(!1),isSelect:!1}),s.jsx(b,{sx:an,rightIcon:s.jsx(et,{}),onClick:()=>N(!0),children:w("header.settings.procedures.removeLines.title")}),s.jsx(Qs,{isOpen:_,onClose:()=>N(!1)}),s.jsx(b,{sx:an,rightIcon:s.jsx(et,{}),onClick:()=>W(!0),children:w("header.settings.procedures.updateColor.title")}),s.jsx(sn,{isOpen:R,onClose:()=>W(!1)}),s.jsxs(b,{sx:an,rightIcon:s.jsx(et,{}),onClick:()=>T(!0),children:[w("header.settings.procedures.unlockSimplePath.title"),s.jsx(I,{label:w("header.settings.pro"),children:s.jsx(H,{ml:"1",color:"gray.50",background:"radial-gradient(circle, #3f5efb, #fc466b)",mr:"auto",children:"PRO"})})]}),s.jsx(tn,{isOpen:L,onClose:()=>T(!1)})]})]}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:w("header.settings.shortcuts.title")}),s.jsx(u,{mt:"3",children:s.jsxs(G,{children:[s.jsx(U,{children:s.jsxs(Z,{children:[s.jsx(D,{children:w("header.settings.shortcuts.keys")}),s.jsx(D,{children:w("header.settings.shortcuts.description")})]})}),s.jsxs(K,{children:[s.jsxs(Z,{children:[s.jsx(Y,{children:s.jsx(V,{children:"f"})}),s.jsx(Y,{children:w("header.settings.shortcuts.f")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:s.jsx(V,{children:"s"})}),s.jsx(Y,{children:w("header.settings.shortcuts.s")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:s.jsxs(u,{display:"flex",flexDirection:"row",children:[s.jsx(tt,{}),s.jsx(st,{}),s.jsx(nt,{}),s.jsx(rt,{})]})}),s.jsx(Y,{children:w("header.settings.shortcuts.arrows")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:s.jsxs(u,{display:"flex",flexDirection:"row",children:[s.jsx(V,{children:"i"}),s.jsx(V,{children:"j"}),s.jsx(V,{children:"k"}),s.jsx(V,{children:"l"})]})}),s.jsx(Y,{children:w("header.settings.shortcuts.ijkl")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:it?s.jsx(V,{sx:ln,children:"⇧"}):s.jsx(V,{children:"shift"})}),s.jsx(Y,{children:w("header.settings.shortcuts.shift")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:it?s.jsx(V,{sx:ln,children:"⌥"}):s.jsx(V,{children:"alt"})}),s.jsx(Y,{children:w("header.settings.shortcuts.alt")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:it?s.jsx(V,{sx:ln,children:"⌫"}):s.jsx(V,{children:"delete"})}),s.jsx(Y,{children:w("header.settings.shortcuts.delete")})]}),s.jsxs(Z,{children:[s.jsxs(Y,{children:[it?s.jsx(V,{sx:ln,children:"⌘"}):s.jsx(V,{children:"ctrl"})," + ",s.jsx(V,{children:"x"})]}),s.jsx(Y,{children:w("header.settings.shortcuts.cut")})]}),s.jsxs(Z,{children:[s.jsxs(Y,{children:[it?s.jsx(V,{sx:ln,children:"⌘"}):s.jsx(V,{children:"ctrl"})," + ",s.jsx(V,{children:"c"})]}),s.jsx(Y,{children:w("header.settings.shortcuts.copy")})]}),s.jsxs(Z,{children:[s.jsxs(Y,{children:[it?s.jsx(V,{sx:ln,children:"⌘"}):s.jsx(V,{children:"ctrl"})," + ",s.jsx(V,{children:"v"})]}),s.jsx(Y,{children:w("header.settings.shortcuts.paste")})]}),s.jsxs(Z,{children:[s.jsxs(Y,{children:[it?s.jsx(V,{sx:ln,children:"⌘"}):s.jsx(V,{children:"ctrl"})," + ",s.jsx(V,{children:"z"})]}),s.jsx(Y,{children:w("header.settings.shortcuts.undo")})]}),s.jsxs(Z,{children:[s.jsx(Y,{children:it?s.jsxs(s.Fragment,{children:[s.jsx(V,{sx:ln,children:"⇧"})," + ",s.jsx(V,{sx:ln,children:"⌘"})," + ",s.jsx(V,{children:"z"})]}):s.jsxs(s.Fragment,{children:[s.jsx(V,{children:"ctrl"})," + ",s.jsx(V,{children:"y"})]})}),s.jsx(Y,{children:w("header.settings.shortcuts.redo")})]})]})]})})]}),s.jsxs(u,{width:"100%",mb:"3",children:[s.jsx(h,{as:"b",fontSize:"xl",children:w("header.settings.telemetry.title")}),s.jsxs(u,{mt:"3",children:[s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:w("header.settings.telemetry.essential")}),s.jsx(B,{isChecked:F,isDisabled:!0})]}),s.jsx(h,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:w("header.settings.telemetry.essentialInfo")}),s.jsxs(C,{color:y,fontSize:"sm",lineHeight:"100%",href:"https://support.google.com/analytics/answer/11593727",isExternal:!0,children:[w("header.settings.telemetry.essentialLink")," ",s.jsx(k,{as:ge})]}),s.jsxs(u,{display:"flex",mb:"1",children:[s.jsx(h,{flex:"1",children:w("header.settings.telemetry.additional")}),s.jsx(B,{isChecked:p,onChange:({target:{checked:e}})=>f(ot(e))})]}),s.jsx(h,{fontSize:"sm",lineHeight:"100%",color:"gray.600",children:w("header.settings.telemetry.additionalInfo")})]})]})]})})]})]})},dn=()=>{const[e,t]=Ot.useState(!1),{svgViewBoxZoom:n}=re((e=>e.param)),r=je(),i=[{type:"slider",label:"",value:400-n,min:10,max:390,step:1,onChange:e=>r(Re(400-e)),leftIcon:s.jsx(lt,{}),rightIcon:s.jsx(at,{}),minW:160}];return s.jsxs(F,{isOpen:e,onOpen:()=>t(!0),onClose:()=>t(!1),children:[s.jsx(q,{children:s.jsx(M,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:s.jsx(at,{}),onClick:()=>t(!e)})}),s.jsx(J,{children:s.jsx(X,{children:s.jsx(ye,{fields:i,noLabel:!0})})})]})},hn=()=>{const[e,t]=Ot.useState(!1),{t:n}=kt(),r=je(),i=Ot.useRef(window.graph),o=Tt(),{width:a,height:l}=Te(o),[c,d]=Ot.useState([]);return Ot.useEffect((()=>{e&&d(i.current.nodes().filter((e=>e.startsWith("stn"))).map((e=>{const t=i.current.getNodeAttributes(e);return{id:e,value:t[t.type].names.join("/")}})))}),[e]),s.jsxs(F,{isOpen:e,onOpen:()=>t(!0),onClose:()=>t(!1),children:[s.jsx(q,{children:s.jsx(M,{"aria-label":"zoom",variant:"ghost",size:"sm",icon:s.jsx(ct,{}),onClick:()=>t(!e)})}),s.jsx(J,{children:s.jsx(X,{children:s.jsx(dt,{label:n("header.search"),children:s.jsx(ht,{data:c,displayHandler:e=>s.jsx(H,{children:e.value}),filter:(e,t)=>t.value.toLowerCase().includes(e.toLowerCase())||Object.values(t.value).some((t=>t.toLowerCase().includes(e.toLowerCase()))),value:"",onChange:e=>(e=>{r(ut(new Set([e])));const t=Math.max(0,Math.min(400,-.132*l+117.772)),{x:s,y:n}=pt((a-300)/2,l/2,t,{x:-i.current.getNodeAttribute(e,"x"),y:-i.current.getNodeAttribute(e,"y")});r(Re(t)),r(We({x:-s,y:-n}))})(e.id)})})})})]})};function un(){const{t:e}=kt(),n=je(),{telemetry:{app:r}}=re((e=>e.app)),{past:i,future:o}=re((e=>e.param)),{isDonationModalOpen:a}=re((e=>e.runtime)),[l,c]=Ot.useState(!1),[d,h]=Ot.useState(!1),u=t(ne.getEnv),m=t(ne.getAppVersion);return Ot.useEffect((()=>{r&&u!==mt.DEV&&ne.event(ie.APP_LOAD,{isStandaloneWindow:ne.isStandaloneWindow()})}),[u]),s.jsxs(xt,{children:[s.jsx(p,{as:"h4",size:"md",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:e("header.about.rmp")}),s.jsx(gt,{environment:u,version:m,popoverHeader:u===mt.PRD?void 0:s.jsxs(At,{i18nKey:"header.popoverHeader",environment:u,children:["You're on ",{environment:u}," environment!"]}),popoverBody:u===mt.PRD?void 0:s.jsx(At,{i18nKey:"header.popoverBody",children:"This is a testing environment where we test the latest beta RMP."})}),s.jsxs(Q,{ml:"auto",children:[s.jsx($,{children:s.jsx(hn,{})}),s.jsx($,{children:s.jsx(M,{size:"sm",variant:"ghost","aria-label":"Undo",icon:s.jsx(jt,{}),isDisabled:0===i.length,onClick:()=>n(ft())})}),s.jsx($,{children:s.jsx(M,{size:"sm",variant:"ghost","aria-label":"Redo",icon:s.jsx(wt,{}),isDisabled:0===o.length,onClick:()=>n(bt())})}),s.jsx($,{children:s.jsx(dn,{})}),s.jsx($,{children:s.jsx(Js,{})}),s.jsx($,{children:s.jsx(Gs,{})}),ne.isStandaloneWindow()&&s.jsx($,{children:s.jsxs(E,{children:[s.jsx(A,{as:M,icon:s.jsx(yt,{}),variant:"ghost",size:"sm"}),s.jsx(_,{children:["en","zh-Hans","zh-Hant","ja","ko"].map((e=>s.jsx(N,{onClick:()=>(async e=>{ne.getI18nInstance().changeLanguage(e)})(e),children:Bt[e][e]},e)))})]})}),s.jsx($,{children:s.jsx(M,{size:"sm",variant:"ghost","aria-label":"Donation",color:"red",icon:s.jsx(Mt,{}),onClick:()=>n(vt(!0))})}),s.jsx($,{children:s.jsx(M,{size:"sm",variant:"ghost","aria-label":"Settings",icon:s.jsx(St,{}),onClick:()=>c(!0)})}),s.jsx($,{children:s.jsx(M,{size:"sm",variant:"ghost","aria-label":"Help",icon:s.jsx(zt,{}),onClick:()=>h(!0)})})]}),s.jsx(Dt,{isOpen:a,onClose:()=>n(vt(!1))}),s.jsx(cn,{isOpen:l,onClose:()=>c(!1)}),s.jsx(Gt,{isOpen:d,onClose:()=>h(!1)})]})}function pn(){const e=je(),t=re((e=>e.runtime.globalAlerts));return s.jsx(s.Fragment,{children:Object.entries(t).map((([t,{message:n,url:r,linkedApp:i}])=>s.jsxs(ee,{status:t,variant:"solid",size:"xs",pl:3,pr:1,py:0,zIndex:"1",children:[s.jsx(te,{}),i?s.jsx(C,{onClick:()=>(e=>{ne.isStandaloneWindow()?window.open(`/${e}`,"_blank"):ne.openApp({appId:e})})(i),children:n}):r?s.jsx(C,{href:r,target:"_blank",children:n}):n,s.jsx(T,{ml:"auto",onClick:()=>e(Ct(t))})]},t)))})}}}}));
