System.register(["./chakra-legacy-HBaSrP-q.js","./index-legacy-9cFBmMlo.js","./react-legacy-T1GznqXM.js","./clipboard-legacy-ZbS4kl2E.js","./stations-legacy-8_bU4C8h.js","./graph-legacy-YSvfs1GL.js","./helpers-legacy-mInQlESe.js","./misc-nodes-legacy-RHCJ4DDI.js"],(function(e,t){"use strict";var r,s,n,i,o,l,c,a,d,y,u,x,f,h,p,g,v,b,m,A,k,w,E,N,j,S,P,I,C,K,D,W,z,$,_,M,L,T,O,F,R,U,B;return{setters:[e=>{r=e.j},e=>{s=e.m,n=e.ac,i=e.l,o=e.f,l=e.a,c=e.ad,a=e.ae,d=e.$,y=e.af,u=e.ag,x=e.q,f=e.t,h=e.S,p=e.b,g=e.n,v=e.o,b=e.r,m=e.E,A=e.v,k=e.x,w=e.K,E=e.F,N=e.D,j=e.a4,S=e.a6},e=>{P=e.b},e=>{I=e.u,C=e.e,K=e.i},e=>{D=e.s,W=e.u,z=e.F,$=e.b},e=>{_=e.f,M=e.a,L=e.b},e=>{T=e.a,O=e.r,F=e.g,R=e.p,U=e.i},e=>{B=e.m}],execute:function(){const t=e=>e.filterNodes(((e,t)=>e.startsWith("stn"))).map((t=>[t,e.getNodeAttributes(t)])).filter((([e,t])=>t.visible)).sort(((e,t)=>e[1].zIndex-t[1].zIndex)).map((([e,t])=>({node:e,visible:t.visible,zIndex:t.zIndex,x:t.x,y:t.y,type:t.type,[t.type]:t[t.type]}))),V=e=>e.filterDirectedEdges(((e,t,r,s,n,i,o)=>e.startsWith("line")&&t.visible&&""===t.reconcileId)).sort(((t,r)=>e.getEdgeAttribute(t,"zIndex")-e.getEdgeAttribute(r,"zIndex"))).map((t=>{const r=e.getEdgeAttribute(t,"type"),s=e.getEdgeAttribute(t,r),n=e.getEdgeAttribute(t,"style"),i=e.getEdgeAttribute(t,n),[o,l]=e.extremities(t),c=e.getNodeAttributes(o),a=e.getNodeAttributes(l);return{edge:t,x1:c.x,y1:c.y,x2:a.x,y2:a.y,type:r,attr:s,style:n,styleAttr:i}})),Y=e=>e.filterNodes(((e,t)=>e.startsWith("misc_node"))).map((t=>[t,e.getNodeAttributes(t)])).filter((([e,t])=>t.visible)).sort(((e,t)=>e[1].zIndex-t[1].zIndex)).map((([e,t])=>({node:e,visible:t.visible,zIndex:t.zIndex,x:t.x,y:t.y,type:t.type,[t.type]:t[t.type]}))),q=e=>{const{id:t,x:s,y:n,handlePointerDown:i,handlePointerMove:o,handlePointerUp:l}=e,c=P.useCallback((e=>i(t,e)),[t,i]),a=P.useCallback((e=>o(t,e)),[t,o]),d=P.useCallback((e=>l(t,e)),[t,l]);return r.jsx("g",{id:t,transform:`translate(${s-6.4} ${n-6.4})scale(0.025)`,onPointerDown:c,onPointerMove:a,onPointerUp:d,style:{cursor:"move"},children:r.jsx("path",{id:`stn_core_${t}`,fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},Z=e=>{const{id:t,path:s,handleClick:n}=e,i=P.useCallback((e=>n(t,e)),[t,n]);return r.jsx("path",{id:t,d:s,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onClick:i})},J=e=>{var t,i;const{id:o,type:l,attrs:c=s[l].defaultAttrs,styleType:a,styleAttrs:d=n[a].defaultAttrs,newLine:y,handleClick:u}=e,{x1:x,y1:f,x2:h,y2:p}=e,g=P.useMemo((()=>X(o,l,x,f,h,p,c)),[l,JSON.stringify(c),x,h,f,p]),v=null!==(t=null===(i=n[a])||void 0===i?void 0:i.component)&&void 0!==t?t:Z;return r.jsx(v,{id:o,type:l,path:g,styleAttrs:d,newLine:y,handleClick:u})},X=(e,t,r,n,o,l,c)=>{if(!(t in s))return`M ${r} ${n} L ${o} ${l}`;const a=G(e,t,r,n,o,l,c);if(a){const{x1:e,y1:t,x2:r,y2:n,offset:o}=a;return s[i.Simple].generatePath(e,r,t,n,{offset:o})}return s[t].generatePath(r,o,n,l,c)},G=(e,t,r,s,n,i,o)=>{if(!("offsetFrom"in o)||!("offsetTo"in o))return;if(Number.isNaN(o.offsetFrom)||Number.isNaN(o.offsetTo))return;if(o.offsetFrom===o.offsetTo)return H(t,r,s,n,i)?{x1:r,y1:s,x2:n,y2:i,offset:o.offsetFrom}:void 0;const[l,c]=[o.offsetFrom,o.offsetTo];for(let a=0;a<Math.PI;a+=Math.PI/8)for(let e=a,o=0;o<2;o++,e+=Math.PI){const[o,d,y,u]=[Math.sin(a)*l,Math.cos(a)*l,Math.sin(e)*c,Math.cos(e)*c];if(H(t,r+o,s+d,n+y,i+u))return{x1:r+o,y1:s+d,x2:n+y,y2:i+u,offset:0}}},H=(e,t,r,s,n)=>!(t!==s&&r!==n||![i.Diagonal,i.Perpendicular].includes(e))||!(1!==Math.abs((n-r)/(s-t))||![i.Diagonal,i.RotatePerpendicular].includes(e)),Q=()=>{const e=o(),w=P.useRef(window.graph),{telemetry:{project:E}}=l((e=>e.app)),{svgViewBoxZoom:N}=l((e=>e.param)),{selected:j,refresh:{nodes:S,edges:C},mode:K,active:W,keepLastPath:z,theme:$}=l((e=>e.runtime)),[_,M]=P.useState({x:0,y:0}),[L,F]=P.useState({x:0,y:0}),R=I(((t,r)=>{r.stopPropagation(),"select"===K&&e(c("free"));const s=r.currentTarget,{x:n,y:i}=T(r);s.setPointerCapture(r.pointerId),M({x:n,y:i}),e(a(t)),r.shiftKey?j.has(t)?e(y(t)):e(u(t)):j.has(t)||e(d(new Set([t])))})),U=I(((t,r)=>{const{x:s,y:n}=T(r);"free"===K&&W===t?(j.forEach((e=>{w.current.hasNode(e)&&w.current.updateNodeAttributes(e,(e=>({...e,x:O(e.x-(_.x-s)*N/100,r.altKey?1:5),y:O(e.y-(_.y-n)*N/100,r.altKey?1:5)})))})),e(x()),e(f())):K.startsWith("line")&&F({x:(_.x-s)*N/100,y:(_.y-n)*N/100})})),X=I(((t,r)=>{if(K.startsWith("line")){z||e(c("free"));const t=[...Object.values(h),p.Virtual],n=w.current.hasNode(W)&&t.includes(w.current.getNodeAttribute(W,"type"));["stn_core_","virtual_circle_"].forEach((e=>{var t;const i=null===(t=document.elementsFromPoint(r.clientX,r.clientY)[0].attributes)||void 0===t||null===(t=t.getNamedItem("id"))||void 0===t?void 0:t.value,o=null==i?void 0:i.startsWith(e);if(n&&o){const t=K.slice(5),r=`line_${g(10)}`;w.current.addDirectedEdgeWithKey(r,W,i.slice(e.length),{visible:!0,zIndex:0,type:t,[t]:structuredClone(s[t].defaultAttrs),style:v.SingleColor,[v.SingleColor]:{color:$},reconcileId:""}),E&&b.event(m.ADD_LINE,{type:t})}})),e(f()),e(A(w.current.export()))}else if("free"===K&&W){const{x:t,y:s}=T(r);_.x-t==0&&_.y-s==0||e(A(w.current.export()))}e(a(void 0))})),G=I(((t,r)=>{r.shiftKey||e(k()),r.shiftKey&&j.has(t)?e(y(t)):e(u(t))})),[H,Q]=P.useState(t(w.current)),[ee,te]=P.useState(Y(w.current)),[re,se]=P.useState(V(w.current)),[ne,ie]=P.useState([]),[oe,le]=P.useState([]);return P.useEffect((()=>{Q(t(w.current)),te(Y(w.current))}),[S]),P.useEffect((()=>{se(V(w.current));const{allReconciledLines:e,danglingLines:t}=(e=>{const t=(e=>{const t=e.filterDirectedEdges(((e,t,r,s,n,i,o)=>e.startsWith("line")&&""!==t.reconcileId)),r={};for(const s of t){const t=e.getEdgeAttribute(s,"reconcileId");t in r?r[t].push(s):r[t]=[s]}return r})(e),r=[],s=[];return Object.values(t).forEach((t=>{if(1===t.length)return void s.push(...t);const n=e.getEdgeAttribute(t.at(0),"type");if(!t.every((t=>e.getEdgeAttribute(t,"type")===n)))return void s.push(...t);const i=e.getEdgeAttribute(t.at(0),"style");if(!t.every((t=>e.getEdgeAttribute(t,"style")===i)))return void s.push(...t);const o={},l=new Set,c=new Set,a=Object.fromEntries(t.map((t=>{var r,s;const[n,i]=e.extremities(t);return o[n]=(null!==(r=o[n])&&void 0!==r?r:0)+1,o[i]=(null!==(s=o[i])&&void 0!==s?s:0)+1,l.add(n),c.add(i),[n,[t,i]]}))),d=Array.from(l).filter((e=>1===o[e])),y=Array.from(c).filter((e=>1===o[e]));if(1!==d.length||1!==y.length)return void s.push(...t);const u=d[0],x=y[0];if(u===x)return void s.push(...t);const f=[a[u][0]];let h=a[u][1];for(let e=1;e<t.length;e+=1){var p;const e=null===(p=a[h])||void 0===p?void 0:p.at(1);if(!e)return void s.push(...t);f.push(a[h][0]),h=e}h===x&&f.length===t.length?r.push(f):s.push(...t)})),{allReconciledLines:r,danglingLines:s}})(w.current);ie(e),le(t)}),[C]),r.jsxs(r.Fragment,{children:[oe.map((e=>{const[t,n]=w.current.extremities(e),o=w.current.getNodeAttributes(t),l=w.current.getNodeAttributes(n);return r.jsx(J,{id:e,x1:o.x,y1:o.y,x2:l.x,y2:l.y,newLine:!1,type:i.Simple,attrs:s[i.Simple].defaultAttrs,styleType:v.SingleColor,styleAttrs:{color:["","","#c0c0c0","#fff"]},handleClick:G},e)})),ne.map((e=>{var t,i;const o=((e,t)=>{if(!t.every((t=>e.hasEdge(t))))return;const r=t.map((t=>{var r,n,i;const[o,l]=e.extremities(t),c=e.getNodeAttributes(o),a=e.getNodeAttributes(l),d=e.getEdgeAttribute(t,"type"),y=null!==(r=e.getEdgeAttribute(t,d))&&void 0!==r?r:s[d].defaultAttrs;return null!==(n=null===(i=s[d])||void 0===i?void 0:i.generatePath(c.x,a.x,c.y,a.y,y))&&void 0!==n?n:`M ${c.x} ${c.y} L ${a.x} ${a.y}`}));let n=`${r[0]} `;for(let s=1;s<t.length;s+=1)n+=r[s].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return n})(w.current,e);if(!o)return r.jsx(r.Fragment,{});const l=e.at(0),c=w.current.getEdgeAttribute(l,"type"),a=w.current.getEdgeAttribute(l,"style"),d=w.current.getEdgeAttribute(l,a),y=null!==(t=null===(i=n[a])||void 0===i?void 0:i.component)&&void 0!==t?t:Z;return r.jsx(y,{id:l,type:c,path:o,styleAttrs:d,newLine:!1,handleClick:G},l)})),re.map((({edge:e,x1:t,y1:s,x2:n,y2:i,type:o,attr:l,style:c,styleAttr:a})=>r.jsx(J,{id:e,x1:t,y1:s,x2:n,y2:i,newLine:!1,type:o,attrs:l,styleType:c,styleAttrs:a,handleClick:G},e))),ee.map((e=>{var t,s;const{node:n,x:i,y:o,type:l}=e,c=null!==(t=null===(s=B[l])||void 0===s?void 0:s.component)&&void 0!==t?t:q;return r.jsx(c,{id:n,x:i,y:o,attrs:e[l],handlePointerDown:R,handlePointerMove:U,handlePointerUp:X},n)})),H.map((e=>{var t,s;const{node:n,x:i,y:o,type:l}=e,c=null!==(t=null===(s=D[l])||void 0===s?void 0:s.component)&&void 0!==t?t:q;return r.jsx(c,{id:n,x:i,y:o,attrs:{[l]:e[l]},handlePointerDown:R,handlePointerMove:U,handlePointerUp:X},n)})),K.startsWith("line")&&W&&r.jsx(J,{id:"create_in_progress___no_use",x1:w.current.getNodeAttribute(W,"x"),y1:w.current.getNodeAttribute(W,"y"),x2:w.current.getNodeAttribute(W,"x")-L.x,y2:w.current.getNodeAttribute(W,"y")-L.y,newLine:!0,type:K.slice(5),attrs:s[K.slice(5)].defaultAttrs,styleType:v.SingleColor,styleAttrs:{color:$}})]})};e("default",(()=>{const e=o(),t=P.useRef(window.graph),s=()=>{e(x()),e(f()),e(A(t.current.export()))},{telemetry:{project:n}}=l((e=>e.app)),{svgViewBoxZoom:i,svgViewBoxMin:y}=l((e=>e.param)),{mode:u,lastTool:h,active:p,selected:v,keepLastPath:V,theme:Y,refresh:{nodes:q}}=l((e=>e.runtime)),Z=W(),{height:J,width:X}=F(Z);P.useEffect((()=>{const e=_(t.current);Object.entries(e).filter((([e,t])=>t&&e in z)).forEach((([e])=>$(e)))}),[q]);const[G,H]=P.useState({x:0,y:0}),[ee,te]=P.useState({x:0,y:0}),[re,se]=P.useState({x:0,y:0}),[ne,ie]=P.useState({x:0,y:0}),oe=I((r=>{const{x:o,y:l}=T(r);if(u.startsWith("station")){e(c("free"));const r=`stn_${g(10)}`,a=u.slice(8),x=structuredClone(D[a].defaultAttrs);"color"in x&&(x.color=Y);const{x:f,y:h}=R(o,l,i,y);t.current.addNode(r,{visible:!0,zIndex:0,x:O(f,5),y:O(h,5),type:a,[a]:x}),s(),n&&b.event(m.ADD_STATION,{type:a}),e(d(new Set([r])))}else if(u.startsWith("misc-node")){e(c("free"));const r=`misc_node_${g(10)}`,a=u.slice(10),{x:x,y:f}=R(o,l,i,y);t.current.addNode(r,{visible:!0,zIndex:0,x:O(x,5),y:O(f,5),type:a,[a]:structuredClone(B[a].defaultAttrs)}),s(),n&&b.event(m.ADD_STATION,{type:a}),e(d(new Set([r])))}else"free"===u||u.startsWith("line")?(u.startsWith("line")&&(e(c("free")),V&&e(w(!1))),se({x:o,y:l}),ie(y),r.shiftKey||(e(a("background")),e(k()))):"select"===u&&(H(R(o,l,i,y)),te(R(o,l,i,y)))})),le=I((t=>{if("select"===u){if(0!=G.x&&0!=G.y){const{x:e,y:r}=T(t);te(R(e,r,i,y))}}else if("background"===p){const{x:r,y:s}=T(t);e(E({x:ne.x+(re.x-r)*i/100,y:ne.y+(re.y-s)*i/100}))}})),ce=I((r=>{if("select"===u){const{x:s,y:n}=T(r),{x:o,y:l}=R(s,n,i,y),a=M(t.current,G.x,G.y,o,l),u=L(t.current,new Set(a));e(d(new Set([...r.shiftKey?v:[],...a,...u]))),e(c("free")),H({x:0,y:0}),te({x:0,y:0})}"background"!==p||r.shiftKey||e(a(void 0))})),ae=I((t=>{let r=i;t.deltaY>0&&i+10<400?r=i+10:t.deltaY<0&&i-10>0&&(r=i-10),e(N(r));const{x:s,y:n}=T(t),o=t.currentTarget.getBoundingClientRect(),[l,c]=[s/o.width,n/o.height];e(E({x:y.x+s*i/100-X*r/100*l,y:y.y+n*i/100-J*r/100*c}))})),de=I((async r=>{if(U?"Backspace"===r.key:"Delete"===r.key)v.size>0&&(v.forEach((e=>{t.current.hasNode(e)?t.current.dropNode(e):t.current.hasEdge(e)&&t.current.dropEdge(e)})),e(k()),s());else if(r.key.startsWith("Arrow")){const t=100,s=r.key.endsWith("Left")?-1:r.key.endsWith("Right")?1:0,n=r.key.endsWith("Up")?-1:r.key.endsWith("Down")?1:0;e(E(R(t*s,t*n,i,y)))}else if("i"===r.key||"j"===r.key||"k"===r.key||"l"===r.key){const e=10,n=("j"===r.key?-1:"l"===r.key?1:0)*e,i=("i"===r.key?-1:"k"===r.key?1:0)*e;v.size>0&&v.forEach((e=>{t.current.hasNode(e)&&(t.current.updateNodeAttribute(e,"x",(e=>(null!=e?e:0)+n)),t.current.updateNodeAttribute(e,"y",(e=>(null!=e?e:0)+i)),s())}))}else if("f"===r.key&&h)e(c(h));else if("z"===r.key&&(U?r.metaKey&&!r.shiftKey:r.ctrlKey))U&&r.preventDefault(),e(j());else if("s"===r.key)e(c("select"));else if("c"!==r.key&&"x"!==r.key||!(U?r.metaKey&&!r.shiftKey:r.ctrlKey))if("v"===r.key&&(U?r.metaKey&&!r.shiftKey:r.ctrlKey)){const r=await navigator.clipboard.readText(),{x:n,y:o}=R(X/2,J/2,i,y),{nodes:l,edges:c}=K(r,t.current,O(n,5),O(o,5));s();const a=structuredClone(l);c.forEach((e=>a.add(e))),e(d(a))}else(U&&"z"===r.key&&r.metaKey&&r.shiftKey||!U&&"y"===r.key&&r.ctrlKey)&&e(S());else{const n=C(t.current,v);navigator.clipboard.writeText(n),"x"===r.key&&(e(k()),v.forEach((e=>{t.current.hasNode(e)?t.current.dropNode(e):t.current.hasEdge(e)&&t.current.dropEdge(e)})),s())}})),[ye,ue]=P.useState({sx:0,sy:0,ex:0,ey:0});return P.useEffect((()=>{ue({sx:G.x<=ee.x?G.x:ee.x,ex:G.x>ee.x?G.x:ee.x,sy:G.y<=ee.y?G.y:ee.y,ey:G.y>ee.y?G.y:ee.y})}),[ee.x,ee.y]),r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none"},height:J,width:X,viewBox:`${y.x} ${y.y} ${X*i/100} ${J*i/100}`,onPointerDown:oe,onPointerMove:le,onPointerUp:ce,onWheel:ae,tabIndex:0,onKeyDown:de,children:[r.jsx(Q,{}),"select"===u&&0!=G.x&&0!=G.y&&r.jsx("rect",{x:ye.sx,y:ye.sy,width:ye.ex-ye.sx,height:ye.ey-ye.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"}),r.jsx("defs",{children:r.jsxs("pattern",{id:"opaque",width:"5",height:"5",patternUnits:"userSpaceOnUse",children:[r.jsx("rect",{x:"0",y:"0",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"}),r.jsx("rect",{x:"2.5",y:"2.5",width:"2.5",height:"2.5",fill:"black",fillOpacity:"50%"})]})})]})}))}}}));
