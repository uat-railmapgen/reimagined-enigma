import{b}from"./react-DV6nCJb6.js";import{n as N,aw as j}from"./index-5KbepEXj.js";const p=typeof window<"u"?b.useInsertionEffect||b.useLayoutEffect:()=>{};function I(s){const n=b.useRef(w);p(()=>{n.current=s},[s]);const o=b.useRef(null);return o.current||(o.current=function(){return n.current.apply(this,arguments)}),o.current}function w(){throw new Error("INVALID_USEEVENT_INVOCATION: the callback from useEvent cannot be invoked before the component has mounted.")}const k=(s,n)=>{const o={},a={};let[u,E]=[0,0],d=0;n.forEach(r=>{if(s.hasNode(r)){const c=r,i=s.getNodeAttributes(c);o[c]=i,u+=i.x,E+=i.y,d++}else if(s.hasEdge(r)){const c=r,[i,h]=s.extremities(c);a[c]={attr:s.getEdgeAttributes(c),source:i,target:h}}});const l={app:"rmp",version:1,nodesWithAttrs:o,edgesWithAttrs:a,avgX:u/d,avgY:E/d};return JSON.stringify(l)},x=(s,n,o,a,u)=>{const{nodesWithAttrs:E,edgesWithAttrs:d,version:l}=JSON.parse(s);if(l!==1)throw Error("Unrecognized version: ".concat(l));const r={};Object.keys(E).filter(e=>n.hasNode(e)).forEach(e=>{const t=N(10);if(e.startsWith("stn_"))r[e]="stn_".concat(t);else if(e.startsWith("misc_node_"))r[e]="misc_node_".concat(t);else throw Error("Unrecognized node id: ".concat(e))}),Object.keys(d).filter(e=>n.hasEdge(e)).forEach(e=>r[e]="line_".concat(N(10)));const c=Object.entries(r).reduce((e,[t,f])=>e.replaceAll(t,f),s),{nodesWithAttrs:i,edgesWithAttrs:h,avgX:O,avgY:y}=JSON.parse(c),m=o?Object.fromEntries(Object.entries(i).filter(([e,t])=>t.type!==j.Master)):i,g=o?Object.fromEntries(Object.entries(h).filter(([e,{source:t,target:f}])=>t in m&&f in m)):h,[A,v]=[a-O,u-y];return Object.entries(m).forEach(([e,t])=>{t.x+=A,t.y+=v,n.addNode(e,t)}),Object.entries(g).forEach(([e,{attr:t,source:f,target:_}])=>n.addDirectedEdgeWithKey(e,f,_,t)),{nodes:new Set(Object.keys(m)),edges:new Set(Object.keys(g))}};export{k as e,x as i,I as u};
