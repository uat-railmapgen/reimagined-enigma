import{j as c,at as me,$ as be,au as Se,a1 as Ce,a4 as G,a2 as Te,a3 as Ae,aV as xe,aW as je,aX as Ee,B as Oe,aY as Le,aZ as ve,a5 as Ne,O as V,aM as Ie}from"./chakra-6oTi0Wmk.js";import{S as te,ay as $,ak as C,o as se,L as b,p as ne,g as Pe,a as J,t as K,v as Q,w as F,C as we,d as Be,m as Re,a5 as Me,R as We,T as ze,P as ke,k as Ze}from"./index-CJ24xDgf.js";import{u as _e,b as r}from"./react-BuIY-1St.js";import{s as S}from"./stations-G1QKgf7C.js";import{c as De}from"./graph-BIwTIDOh.js";const ee=[te.ShmetroBasic2020],Xe=(a,s,o)=>{const i=a.getNodeAttribute(s,"type"),n=structuredClone(a.getNodeAttribute(s,i).names);for(let l=0;l<Math.abs(S[o].defaultAttrs.names.length-n.length);l++)S[o].defaultAttrs.names.length>n.length?n.push("Stn"):n.pop();const t={...S[o].defaultAttrs,names:n};(!Object.values(ee).includes(i)||!Object.values(ee).includes(o))&&(t.nameOffsetX=a.getNodeAttribute(s,i).nameOffsetX,t.nameOffsetY=a.getNodeAttribute(s,i).nameOffsetY),$.includes(o)&&$.includes(i)&&(t.color=structuredClone(a.getNodeAttribute(s,i).color)),a.removeNodeAttribute(s,i),a.mergeNodeAttributes(s,{type:o,[o]:t})},Ye=(a,s,o,i)=>i.filter(n=>s==="any"||a.getNodeAttribute(n,"type")===s).forEach(n=>{Xe(a,n,o)}),He=(a,s,o)=>{const i=a.getEdgeAttribute(s,"type"),n=a.getEdgeAttribute(s,"style");if(C[n].metadata.supportLinePathType.includes(o)){a.removeEdgeAttribute(s,i);const t=structuredClone(se[o].defaultAttrs);a.mergeEdgeAttributes(s,{type:o,[o]:t})}},Ue=(a,s,o,i)=>i.filter(n=>s==="any"||a.getEdgeAttribute(n,"type")===s).forEach(n=>{He(a,n,o)}),qe=(a,s,o,i)=>{const n=a.getEdgeAttribute(s,"type"),t=a.getEdgeAttribute(s,"style");if(C[o].metadata.supportLinePathType.includes(n)){const l=a.getEdgeAttribute(s,"zIndex"),h=a.getEdgeAttribute(s,t);a.removeEdgeAttribute(s,t);const p=structuredClone(C[o].defaultAttrs);b.includes(t)&&b.includes(o)?p.color=h.color:b.includes(o)&&i&&(p.color=i),a.mergeEdgeAttributes(s,{style:o,[o]:p}),o===ne.River?a.setEdgeAttribute(s,"zIndex",-5):a.setEdgeAttribute(s,"zIndex",l!=null?l:0)}},Ge=(a,s,o,i,n)=>n.filter(t=>s==="any"||a.getEdgeAttribute(t,"style")===s).forEach(t=>{qe(a,t,o,i)}),Ve=(a,s,o,i)=>i.filter(n=>b.includes(a.getEdgeAttribute(n,"style"))).forEach(n=>{const t=a.getEdgeAttributes(n),l=t[t.style].color;(s==="any"||l[0]==s[0]&&l[1]==s[1]&&l[2]==s[2]&&l[3]==s[3])&&a.mergeEdgeAttributes(n,{[t.style]:{color:o}})}),$e=(a,s,o,i,n)=>{[...i,...n].forEach(t=>{const l=a.getNodeAttributes(t).type,h=a.getNodeAttribute(t,l);if(h.color!==void 0){const p=h.color;(s==="any"||p[0]==s[0]&&p[1]==s[1]&&p[2]==s[2]&&p[3]==s[3])&&(h.color=o)}a.mergeNodeAttributes(t,{[l]:h})})},Je=(a,s,o,i,n)=>{[...s,...o].forEach(t=>{a.setNodeAttribute(t,"zIndex",n)}),i.forEach(t=>{a.setEdgeAttribute(t,"zIndex",n)})},st=a=>{const{isOpen:s,onClose:o,isSelect:i,filter:n}=a,{t}=_e(),l=Pe(),{selected:h,theme:p,paletteAppClip:{output:y}}=J(e=>e.runtime),{activeSubscriptions:R}=J(e=>e.account),ae=r.useCallback(()=>{l(K()),l(Q()),l(F(u.current.export()))},[l,K,Q,F]),u=r.useRef(window.graph),M={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(se).map(([e,d])=>[e,t(d.metadata.displayName).toString()]))},W={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(C).map(([e,d])=>[e,t(d.metadata.displayName).toString()]))},z={any:t("header.settings.procedures.changeType.any"),...Object.fromEntries(Object.entries(S).map(([e,d])=>[e,t(d.metadata.displayName).toString()]))},T={id:"any",theme:[we.Other,"other","#ffffff",Be.black],value:t("header.settings.procedures.changeType.any")},[A,k]=r.useState(!1),[Z,_]=r.useState(0),[x,D]=r.useState(!1),[j,oe]=r.useState("any"),[E,ie]=r.useState(te.ShmetroBasic),[O,X]=r.useState(!1),[L,ce]=r.useState("any"),[v,le]=r.useState(ne.SingleColor),[N,Y]=r.useState(!1),[I,re]=r.useState("any"),[P,de]=r.useState(Re.Diagonal),[w,H]=r.useState(!1),[m,U]=r.useState(T),[B,ue]=r.useState(p),[he,q]=r.useState(!1);r.useEffect(()=>{he&&y&&(ue(y),q(!1))},[y==null?void 0:y.toString()]);const[pe,ge]=r.useState([]),fe=[{id:"changeZIndex",title:t("header.settings.procedures.changeZIndex"),onClose:()=>k(!A),field:[{type:"select",label:t("panel.details.info.zIndex"),value:Z,options:Object.fromEntries(Array.from({length:11},(e,d)=>[d-5,(d-5).toString()])),onChange:e=>_(Number(e))}]},{id:"changeStationType",title:t("header.settings.procedures.changeStationType.title"),onClose:()=>D(!x),field:[{type:"select",label:t("header.settings.procedures.changeStationType.changeFrom"),options:z,value:j,disabledOptions:[E],onChange:e=>oe(e)},{type:"select",label:t("header.settings.procedures.changeStationType.changeTo"),options:z,value:E,disabledOptions:["any",j],onChange:e=>ie(e)}]},{id:"changeLineStyleType",title:t("header.settings.procedures.changeLineStyleType.title"),onClose:()=>X(!O),field:[{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeFrom"),options:W,value:L,disabledOptions:[v],onChange:e=>ce(e)},{type:"select",label:t("header.settings.procedures.changeLineStyleType.changeTo"),options:W,value:v,disabledOptions:["any",L],onChange:e=>le(e)}]},{id:"changeLinePathType",title:t("header.settings.procedures.changeLinePathType.title"),onClose:()=>Y(!N),field:[{type:"select",label:t("header.settings.procedures.changeLinePathType.changeFrom"),options:M,value:I,disabledOptions:[P],onChange:e=>re(e)},{type:"select",label:t("header.settings.procedures.changeLinePathType.changeTo"),options:M,value:P,disabledOptions:["any","simple",I],onChange:e=>de(e)}]},{id:"changeColor",title:t("header.settings.procedures.changeColor.title"),onClose:()=>H(!w),field:[{type:"custom",label:t("header.settings.procedures.changeColor.changeFrom"),component:c.jsx(Me,{data:pe,displayHandler:e=>c.jsx(We,{name:e.value,fg:e.theme[3],bg:e.theme[2],title:e.theme[1],sx:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis"}}),filter:(e,d)=>d.id.toLowerCase().includes(e.toLowerCase())||Object.values(d.id).some(f=>f.toLowerCase().includes(e.toLowerCase())),value:m.value,onChange:e=>U(e)})},{type:"custom",label:t("header.settings.procedures.changeColor.changeTo"),component:c.jsx(ze,{theme:B,onClick:()=>{q(!0),l(ke(p))}})}]}];r.useEffect(()=>{s&&(k(!1),D(!1),X(!1),Y(!1),H(!1),_(0),ge([T,...De(u.current,i?[...h].filter(e=>e.startsWith("stn")||e.startsWith("misc_node")):u.current.nodes(),i?[...h].filter(e=>e.startsWith("line")):u.current.edges()).map(e=>({id:e.toString(),theme:e,value:e[1]==="other"?e[2]:e[1]}))]),U(T))},[s]);const ye=()=>{const e=n!=null&&n.includes("station")?[...h].filter(g=>g.startsWith("stn")):i?[]:u.current.filterNodes(g=>g.startsWith("stn")),d=n!=null&&n.includes("misc-node")?[...h].filter(g=>g.startsWith("misc_node")):i?[]:u.current.filterNodes(g=>g.startsWith("misc_node")),f=i?[...h].filter(g=>g.startsWith("line")):u.current.edges();(!n||n.includes("station"))&&x&&Ye(u.current,j,E,e),(!n||n.includes("line"))&&O&&Ge(u.current,L,v,p,f),(!n||n.includes("line"))&&N&&Ue(u.current,I,P,f),w&&((!n||n.includes("line"))&&Ve(u.current,m.id==="any"?"any":m.theme,B,f),(!n||n.includes("misc-node")||n.includes("station"))&&$e(u.current,m.id==="any"?"any":m.theme,B,e,d)),A&&Je(u.current,e,d,f,Z),ae(),o()};return c.jsxs(me,{isOpen:s,onClose:o,size:"md",scrollBehavior:"inside",children:[c.jsx(be,{}),c.jsxs(Se,{children:[c.jsxs(Ce,{children:[c.jsx(G,{as:"b",fontSize:"xl",children:t(i?"panel.details.multipleSelection.change":"header.settings.procedures.changeType.title")}),c.jsx(Te,{})]}),c.jsx(Ae,{children:c.jsx(xe,{allowMultiple:!0,children:fe.map(e=>c.jsxs(je,{children:[c.jsxs(Ee,{onClick:e.onClose,children:[c.jsx(Oe,{as:"span",flex:"1",textAlign:"left",children:c.jsx(G,{as:"b",fontSize:"md",children:e.title})}),c.jsx(Le,{})]}),c.jsx(ve,{pb:4,children:c.jsx(Ze,{fields:e.field,minW:270})})]},e.id))})}),c.jsxs(Ne,{children:[c.jsx(V,{colorScheme:"blue",variant:"outline",mr:"1",onClick:o,children:t("cancel")}),c.jsx(Ie,{label:t("header.settings.pro"),isOpen:!R.RMP_CLOUD,children:c.jsx(V,{colorScheme:"red",mr:"1",onClick:ye,isDisabled:!R.RMP_CLOUD||!A&&!x&&!O&&!N&&!w,children:t("apply")})})]})]})]})};export{st as C,qe as a,Xe as b,He as c};
