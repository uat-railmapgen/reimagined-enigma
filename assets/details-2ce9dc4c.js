import{j as e,$ as k,a0 as z,a1 as se,s as S,A as K,M as Q,m as X,n as Y,p as ee,r as te,q as B,ae}from"./chakra-594c63ee.js";import{c as v,j as A,d as C,D as P,ah as U,z as w,A as y,t as M,N as O,q as ie,v as re,aj as F,ak as H,y as N,n as V,al as oe,am as ce,an as le,ao as de,p as q}from"./index-707af454.js";import{b as l}from"./react-2c0b8364.js";import{b as pe}from"./graph-ea6bdc37.js";import{s as $}from"./stations-a4a6bed3.js";import{d as he,e as ue,f as ge}from"./change-types-2195d040.js";import{u as G,e as me}from"./clipboard-007c443d.js";import{m as fe}from"./misc-nodes-19b8113c.js";function xe(){const{t:s}=v(),i=A(),{selected:a}=C(t=>t.runtime),r=l.useRef(window.graph),n=t=>{i(P()),i(U(t))};return e.jsxs(k,{children:[e.jsxs(z,{as:"h5",size:"sm",children:[s("panel.details.selected")," ",a.length]}),e.jsx(se,{m:"var(--chakra-space-1)",children:a.map(t=>{const o=r.current.getNodeAttributes(t),d=o.type,c=t.startsWith("stn")?o[d].names.join("/"):d;return e.jsx(S,{width:"100%",size:"sm",variant:"solid",onClick:()=>n(t),overflow:"hidden",maxW:"270",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"ruby",children:c},t)})})]})}function Z(){const{t:s}=v(),i=A(),a=l.useCallback(()=>{i(w()),i(y(o.current.export()))},[i,w,y]),{selected:r,theme:n}=C(f=>f.runtime),t=r.at(0),o=l.useRef(window.graph),[d,c]=l.useState(!1),u=l.useRef(null),p=Object.fromEntries(Object.entries(M).map(([f,_])=>[f,s(_.metadata.displayName).toString()])),[h,g]=l.useState(o.current.getEdgeAttribute(t,"type")),[m,x]=l.useState(void 0),b=Object.fromEntries(Object.entries(O).map(([f,_])=>[f,s(_.metadata.displayName).toString()])),[j,I]=l.useState(o.current.getEdgeAttribute(t,"style")),[T,W]=l.useState(void 0),E=Object.values(ie).filter(f=>!O[j].metadata.supportLinePathType.includes(f)),R=Object.values(re).filter(f=>!O[f].metadata.supportLinePathType.includes(h)),L=()=>{m&&(he(o.current,t,m),g(o.current.getEdgeAttribute(t,"type")),a())},ne=()=>{T&&(ue(o.current,t,T,n),I(o.current.getEdgeAttribute(t,"style")),a())},D=f=>{f&&(m?(L(),x(void 0)):T&&(ne(),W(void 0))),c(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.linePathType"),minW:"276",children:e.jsx(H,{options:p,disabledOptions:E,defaultValue:h,value:h,onChange:({target:{value:f}})=>{x(f),c(!0)}})}),e.jsx(F,{label:s("panel.details.info.lineStyleType"),minW:"276",children:e.jsx(H,{options:b,disabledOptions:R,defaultValue:j,value:j,onChange:({target:{value:f}})=>{W(f),c(!0)}})}),e.jsx(K,{isOpen:d,leastDestructiveRef:u,onClose:()=>D(!1),children:e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Y,{children:s("warning")}),e.jsx(ee,{children:s("panel.details.changeLineTypeContent")}),e.jsxs(te,{children:[e.jsx(S,{ref:u,onClick:()=>D(!1),children:s("cancel")}),e.jsx(S,{ml:"2",colorScheme:"red",onClick:()=>D(!0),children:s("panel.details.changeType")})]})]})})})]})}function ye(){const{t:s}=v(),i=A(),a=l.useCallback(()=>{i(N()),i(y(t.current.export()))},[i,N,y]),{selected:r}=C(b=>b.runtime),n=r.at(0),t=l.useRef(window.graph),[o,d]=l.useState(!1),c=l.useRef(null),[u,p]=l.useState(void 0),h=t.current.getNodeAttribute(n,"type"),g=Object.fromEntries(Object.entries($).map(([b,j])=>[b,s(j.metadata.displayName).toString()])),m=()=>{u&&(ge(t.current,n,u),a())},x=b=>{b&&m(),p(void 0),d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(F,{label:s("panel.details.info.stationType"),minW:"276",children:e.jsx(H,{options:g,disabledOptions:[h],value:h,onChange:({target:{value:b}})=>{p(b),d(!0)}})}),e.jsx(K,{isOpen:o,leastDestructiveRef:c,onClose:()=>x(!1),children:e.jsx(Q,{children:e.jsxs(X,{children:[e.jsx(Y,{children:s("warning")}),e.jsx(ee,{children:s("panel.details.changeStationTypeContent")}),e.jsxs(te,{children:[e.jsx(S,{ref:c,onClick:()=>x(!1),children:s("cancel")}),e.jsx(S,{ml:"2",colorScheme:"red",onClick:()=>x(!0),children:s("panel.details.changeType")})]})]})})})]})}function be(){const{t:s}=v(),i=A(),a=l.useCallback(()=>{i(N()),i(w()),i(y(t.current.export()))},[i,w,y]),{selected:r}=C(c=>c.runtime),n=r.at(0),t=l.useRef(window.graph),o=c=>{const u=Math.min(Math.max(c,-5),5);t.current.hasNode(n)&&t.current.setNodeAttribute(n,"zIndex",u),t.current.hasEdge(n)&&t.current.setEdgeAttribute(n,"zIndex",u),a()},d=[];return r.length===0||(r.length===1?(d.push({type:"input",label:s("panel.details.info.id"),value:r.length>0?r.join(", "):"undefined",minW:276}),d.push({type:"select",label:s("panel.details.info.zIndex"),value:n?t.current.hasNode(n)?t.current.getNodeAttribute(n,"zIndex"):t.current.hasEdge(n)?t.current.getEdgeAttribute(n,"zIndex"):0:0,options:Object.fromEntries(Array.from({length:11},(c,u)=>[u-5,(u-5).toString()])),onChange:c=>o(Number(c))})):r.length>1&&d.push({type:"input",label:s("panel.details.info.type"),value:"multiple selection",minW:276})),e.jsxs(k,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.info.title")}),e.jsx(V,{fields:d,minW:130}),r.length===1&&n.startsWith("stn")&&t.current.hasNode(n)&&t.current.getNodeAttribute(n,"type")in $&&e.jsx(ye,{}),r.length===1&&n.startsWith("line")&&t.current.hasEdge(n)&&t.current.getEdgeAttribute(n,"type")in M&&t.current.getEdgeAttribute(n,"style")in O&&e.jsx(Z,{}),r.length===1&&n.startsWith("line")&&t.current.hasEdge(n)&&e.jsx(Z,{}),r.length>1&&e.jsx(xe,{})]})}function je(){const{t:s}=v(),i=A(),{selected:a}=C(j=>j.runtime),r=a.at(0),n=l.useRef(window.graph),[t,o]=l.useState("undefined"),[d,c]=l.useState("undefined"),[u,p]=l.useState("undefined"),[h,g]=l.useState("undefined");l.useEffect(()=>{var j,I,T,W;if(r!=null&&r.startsWith("line")){const[E,R]=n.current.extremities(r);if(o(E),c(R),E.startsWith("stn")){const L=n.current.getNodeAttribute(E,"type");p((I=(j=n.current.getNodeAttribute(E,L))==null?void 0:j.names.at(0))!=null?I:"undefined")}if(R.startsWith("stn")){const L=n.current.getNodeAttribute(R,"type");g((W=(T=n.current.getNodeAttribute(R,L))==null?void 0:T.names.at(0))!=null?W:"undefined")}}},[a]);const m=G(()=>{i(P()),i(U(t))}),x=G(()=>{i(P()),i(U(d))}),b=[{type:"custom",label:s("panel.details.lineExtremities.source"),component:e.jsx(S,{flex:1,size:"sm",variant:"link",onClick:m,children:t})},{type:"custom",label:s("panel.details.lineExtremities.target"),component:e.jsx(S,{flex:1,size:"sm",variant:"link",onClick:x,children:d})},{type:"input",label:s("panel.details.lineExtremities.sourceName"),value:u},{type:"input",label:s("panel.details.lineExtremities.targetName"),value:h}];return e.jsxs(k,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.lineExtremities.title")}),e.jsx(V,{fields:b,minW:130})]})}function Se(){const{t:s}=v(),i=A(),a=l.useCallback(()=>{i(N()),i(w()),i(y(o.current.export()))},[i,N,w,y]),{selected:r,refresh:{nodes:n}}=C(p=>p.runtime),t=r.at(0),o=l.useRef(window.graph),[d,c]=l.useState({x:0,y:0});l.useEffect(()=>{if(t!=null&&t.startsWith("stn")||t!=null&&t.startsWith("misc_node_")){const p=o.current.getNodeAttribute(t,"x"),h=o.current.getNodeAttribute(t,"y");c({x:p,y:h})}},[n,r]);const u=[{type:"input",label:s("panel.details.nodePosition.pos.x"),value:d.x.toString(),validator:p=>!Number.isNaN(p),onChange:p=>{o.current.mergeNodeAttributes(t,{x:Number(p)}),a()}},{type:"input",label:s("panel.details.nodePosition.pos.y"),value:d.y.toString(),validator:p=>!Number.isNaN(p),onChange:p=>{o.current.mergeNodeAttributes(t,{y:Number(p)}),a()}}];return e.jsxs(k,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.nodePosition.title")}),e.jsx(V,{fields:u,minW:130})]})}const J={...$,...fe},we=()=>{var d;const s=A(),{selected:i}=C(c=>c.runtime),a=i.at(0),r=window.graph.getNodeAttribute(a,"type"),n=r in J&&J[r].attrsComponent,t=(d=window.graph.getNodeAttribute(a,r))!=null?d:{},o=(c,u)=>{const p=window.graph.getNodeAttribute(c,"type");window.graph.mergeNodeAttributes(c,{[p]:u}),s(N()),s(y(window.graph.export()))};return n?e.jsx(n,{id:a,attrs:t,handleAttrsUpdate:o}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:"Oops :( We can't recognize this node. Maybe it is created in a newer version?"})},Ne=()=>{var h,g;const s=A(),{selected:i}=C(m=>m.runtime),a=i.at(0),r=window.graph.getEdgeAttribute(a,"type"),n=(h=window.graph.getEdgeAttribute(a,r))!=null?h:{},t=r in M&&M[r].attrsComponent,o=window.graph.getEdgeAttribute(a,"style"),d=(g=window.graph.getEdgeAttribute(a,o))!=null?g:{},c=o in O&&O[o].attrsComponent,u=(m,x)=>{window.graph.mergeEdgeAttributes(m,{[r]:x}),s(w()),s(y(window.graph.export()))},p=(m,x)=>{window.graph.mergeEdgeAttributes(m,{[o]:x}),s(w()),s(y(window.graph.export()))};return e.jsxs(e.Fragment,{children:[t?e.jsx(t,{id:a,attrs:n,handleAttrsUpdate:u}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:"Oops :( We can't recognize this line type. Maybe it is created in a newer version?"}),c?e.jsx(c,{id:a,attrs:d,handleAttrsUpdate:p}):e.jsx(B,{fontSize:"xs",m:"var(--chakra-space-1)",children:"Oops :( We can't recognize this line style. Maybe it is created in a newer version?"})]})},Le=()=>{const{t:s}=v(),i=A(),a=l.useRef(window.graph),r=l.useCallback(()=>{i(N()),i(w()),i(y(a.current.export()))},[i,N,w,y]),{selected:n,mode:t}=C(h=>h.runtime),o=n.at(0),d=()=>i(P()),c=h=>{const g=structuredClone(a.current.getNodeAttributes(h));g.x+=50,g.y+=50;const m=h.startsWith("stn")?`stn_${q(10)}`:`misc_node_${q(10)}`;a.current.addNode(m,g),i(N()),i(y(a.current.export()))},u=h=>{const g=new Set(h),m=pe(a.current,g),x=me(a.current,g,new Set(m));navigator.clipboard.writeText(x)},p=h=>{i(P()),h.forEach(g=>{a.current.hasNode(g)?a.current.dropNode(g):a.current.hasEdge(g)&&a.current.dropEdge(g)}),r()};return e.jsxs(oe,{isOpen:n.length>0&&!t.startsWith("line"),width:300,header:"Dummy header",alwaysOverlay:!0,children:[e.jsx(ce,{onClose:d,children:s("panel.details.header")}),e.jsxs(le,{children:[e.jsx(be,{}),n.length===1&&a.current.hasNode(o)&&e.jsx(Se,{}),n.length===1&&a.current.hasEdge(o)&&e.jsx(je,{}),n.length===1&&e.jsxs(k,{p:1,children:[e.jsx(z,{as:"h5",size:"sm",children:s("panel.details.specificAttrsTitle")}),window.graph.hasNode(o)&&e.jsx(we,{}),window.graph.hasEdge(o)&&e.jsx(Ne,{})]})]}),e.jsx(de,{children:e.jsxs(ae,{children:[n.length===1&&a.current.hasNode(n.at(0))&&e.jsx(S,{size:"sm",variant:"outline",onClick:()=>c(n.at(0)),children:s("panel.details.footer.duplicate")}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>u(n),children:s("panel.details.footer.copy")}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>p(n),children:s("panel.details.footer.remove")})]})})]})};export{Le as default};
