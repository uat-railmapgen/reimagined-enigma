!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e=function(){return r};var r={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(P){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,a=Object.create(o.prototype),u=new N(n||[]);return i(a,"_invoke",{value:E(t,r,u)}),a}function y(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(P){return{type:"throw",arg:P}}}r.wrap=f;var d={};function h(){}function p(){}function v(){}var g={};s(g,u,(function(){return this}));var x=Object.getPrototypeOf,m=x&&x(x(L([])));m&&m!==n&&o.call(m,u)&&(g=m);var b=v.prototype=h.prototype=Object.create(g);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(e,r){function n(i,a,u,c){var l=y(e[i],e,a);if("throw"!==l.type){var s=l.arg,f=s.value;return f&&"object"==t(f)&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,u,c)}),(function(t){n("throw",t,u,c)})):r.resolve(f).then((function(t){s.value=t,u(s)}),(function(t){return n("throw",t,u,c)}))}c(l.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new r((function(r,o){n(t,e,r,o)}))}return a=a?a.then(o,o):o()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return O()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===d)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=y(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function A(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=y(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,d;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function L(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(o.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=v,i(b,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:p,configurable:!0}),p.displayName=s(v,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,s(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},r.awrap=function(t){return{__await:t}},w(k.prototype),s(k.prototype,c,(function(){return this})),r.AsyncIterator=k,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new k(f(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),s(b,l,"Generator"),s(b,u,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=L,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},r}function r(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(l){return void r(l)}u.done?e(c):Promise.resolve(c).then(n,o)}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function i(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,r,n){return(r=function(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===t(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(s){l=!0,o=s}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}System.register(["./chakra-legacy-dae91ce7.js","./index-legacy-50a0b4ff.js","./react-legacy-57266490.js","./clipboard-legacy-0d85ed4c.js","./helpers-legacy-72125235.js","./graph-legacy-4822bfab.js","./misc-nodes-legacy-5cf5e22f.js","./stations-legacy-178b2064.js"],(function(t,n){"use strict";var l,s,f,y,d,h,p,v,g,x,m,b,w,k,E,A,j,S,N,L,O,P,I,_,C,D,T,W,z,K,M,F,R,G,B,U,Y,V,J,Z;return{setters:[function(t){l=t.j},function(t){s=t.t,f=t.N,y=t.q,d=t.j,h=t.d,p=t.af,v=t.ag,g=t.D,x=t.ah,m=t.y,b=t.z,w=t.S,k=t.e,E=t.p,A=t.v,j=t.r,S=t.E,N=t.A,L=t.Q,O=t.K,P=t.ai,I=t.J,_=t.a4,C=t.a6},function(t){D=t.r,T=t.b},function(t){W=t.u,z=t.e,K=t.i},function(t){M=t.b,F=t.r,R=t.F,G=t.p,B=t.a},function(t){U=t.f,Y=t.a,V=t.b},function(t){J=t.m},function(t){Z=t.s}],execute:function(){var n=function(t){return t.filterNodes((function(t,e){return t.startsWith("stn")})).map((function(e){return[e,t.getNodeAttributes(e)]})).filter((function(t){var e=u(t,2);e[0];return e[1].visible})).sort((function(t,e){return t[1].zIndex-e[1].zIndex})).map((function(t){var e=u(t,2),r=e[0],n=e[1];return a({node:r,visible:n.visible,zIndex:n.zIndex,x:n.x,y:n.y,type:n.type},n.type,n[n.type])}))},q=function(t){return t.filterDirectedEdges((function(t,e,r,n,o,i,a){return t.startsWith("line")&&e.visible&&""===e.reconcileId})).sort((function(e,r){return t.getEdgeAttribute(e,"zIndex")-t.getEdgeAttribute(r,"zIndex")})).map((function(e){var r=t.getEdgeAttribute(e,"type"),n=t.getEdgeAttribute(e,r),o=t.getEdgeAttribute(e,"style"),i=t.getEdgeAttribute(e,o),a=u(t.extremities(e),2),c=a[0],l=a[1],s=t.getNodeAttributes(c),f=t.getNodeAttributes(l);return{edge:e,x1:s.x,y1:s.y,x2:f.x,y2:f.y,type:r,attr:n,style:o,styleAttr:i}}))},H=function(t){return t.filterNodes((function(t,e){return t.startsWith("misc_node")})).map((function(e){return[e,t.getNodeAttributes(e)]})).filter((function(t){var e=u(t,2);e[0];return e[1].visible})).sort((function(t,e){return t[1].zIndex-e[1].zIndex})).map((function(t){var e=u(t,2),r=e[0],n=e[1];return a({node:r,visible:n.visible,zIndex:n.zIndex,x:n.x,y:n.y,type:n.type},n.type,n[n.type])}))},Q=function(t){var e,r={},n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=c(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(t.filterDirectedEdges((function(t,e,r,n,o,i,a){return t.startsWith("line")&&""!==e.reconcileId})));try{for(n.s();!(e=n.n()).done;){var o=e.value,i=t.getEdgeAttribute(o,"reconcileId");i in r?r[i].push(o):r[i]=[o]}}catch(a){n.e(a)}finally{n.f()}return r},X=function(t){var e=t.id,r=t.x,n=t.y,o=t.handlePointerDown,i=t.handlePointerMove,a=t.handlePointerUp,u=T.useCallback((function(t){return o(e,t)}),[e,o]),c=T.useCallback((function(t){return i(e,t)}),[e,i]),s=T.useCallback((function(t){return a(e,t)}),[e,a]);return l.jsx("g",{id:e,transform:"translate(".concat(r-6.4,",").concat(n-6.4,")scale(0.025)"),onPointerDown:u,onPointerMove:c,onPointerUp:s,style:{cursor:"move"},children:l.jsx("path",{id:"stn_core_".concat(e),fillRule:"evenodd",clipRule:"evenodd",d:"M256 0c70.69 0 134.7 28.66 181.02 74.98C483.34 121.31 512 185.31 512 256c0 70.69-28.66 134.7-74.98 181.02C390.7 483.34 326.69 512 256 512c-70.69 0-134.69-28.66-181.02-74.98C28.66 390.7 0 326.69 0 256c0-70.69 28.66-134.69 74.98-181.02C121.31 28.66 185.31 0 256 0zm-21.91 302.69v-2.07c.16-13.72 1.51-24.59 4.15-32.67 2.59-8.08 6.32-14.65 11.18-19.63 4.87-5.02 10.72-9.58 17.56-13.72 4.4-2.8 8.39-5.9 11.91-9.37 3.52-3.42 6.32-7.41 8.38-11.91 2.07-4.46 3.11-9.42 3.11-14.91 0-6.53-1.55-12.18-4.66-16.99-3.05-4.77-7.19-8.44-12.27-11.08-5.13-2.59-10.82-3.89-17.09-3.89-5.65 0-11.03 1.15-16.21 3.53-5.12 2.33-9.42 6-12.79 10.97-3.36 4.98-5.33 11.35-5.85 19.11h-33.56c.53-13.21 3.89-24.39 10.05-33.55 6.21-9.16 14.4-16.11 24.55-20.82 10.2-4.71 21.49-7.04 33.81-7.04 13.57 0 25.38 2.48 35.52 7.56 10.15 5.02 18.08 12.06 23.72 21.08 5.59 9 8.44 19.47 8.44 31.48 0 8.23-1.29 15.64-3.88 22.21-2.59 6.58-6.22 12.48-10.98 17.61-4.77 5.18-10.41 9.73-17.03 13.67-6.27 3.94-11.35 7.97-15.18 12.17-3.88 4.19-6.68 9.17-8.44 14.86-1.76 5.74-2.75 12.84-2.9 21.33v2.07h-31.54zm16.68 70.67c-6.06 0-11.24-2.18-15.59-6.48-4.34-4.29-6.47-9.53-6.47-15.63 0-6.01 2.12-11.19 6.47-15.49 4.35-4.3 9.53-6.47 15.59-6.47 5.95 0 11.12 2.19 15.48 6.47 4.39 4.31 6.58 9.48 6.58 15.49 0 4.04-1.05 7.76-3.06 11.08-2.02 3.35-4.66 6.07-7.97 8.03-3.31 1.96-6.99 3-11.03 3z"})})},$=function(t){var e=t.id,r=t.path,n=t.handleClick,o=T.useCallback((function(t){return n(e,t)}),[e,n]);return l.jsx("path",{id:e,d:r,fill:"none",stroke:"grey",strokeWidth:"5",strokeLinecap:"round",cursor:"pointer",onClick:o})},tt=function(t){var e,r,n=t.id,o=t.type,i=t.attrs,a=void 0===i?s[o].defaultAttrs:i,c=t.styleType,d=t.styleAttrs,h=void 0===d?f[c].defaultAttrs:d,p=t.newLine,v=t.handleClick,g=t.x1,x=t.y1,m=t.x2,b=t.y2,w=u(T.useState("M 0,0 L 0,0"),2),k=w[0],E=w[1];T.useEffect((function(){var t="M 0,0 L 0,0";if(o in s)if(["offsetFrom","offsetTo"].every((function(t){return Object.keys(a).includes(t)}))&&!Number.isNaN(a.offsetFrom)&&!Number.isNaN(a.offsetTo)&&a.offsetFrom===a.offsetTo&&((g===m||x===b)&&[y.Diagonal,y.Perpendicular].includes(o)||1===Math.abs((b-x)/(m-g))&&[y.Diagonal,y.RotatePerpendicular].includes(o))){var e=a.offsetFrom;t=s[y.Simple].generatePath(g,m,x,b,{offset:e})}else t=s[o].generatePath(g,m,x,b,a);else t="M ".concat(g,",").concat(x," L ").concat(m,",").concat(b);E(t)}),[o,JSON.stringify(a),g,m,x,b]);var A=null!==(e=null===(r=f[c])||void 0===r?void 0:r.component)&&void 0!==e?e:$;return T.useMemo((function(){return l.jsx(A,{id:n,type:o,path:k,styleAttrs:h,newLine:p,handleClick:v})}),[n,o,k,c,JSON.stringify(h),p,v])},et=function(){var t=d(),e=T.useRef(window.graph),r=h((function(t){return t.app})).telemetry.project,c=h((function(t){return t.param})).svgViewBoxZoom,L=h((function(t){return t.runtime})),O=L.selected,P=L.refresh,I=P.nodes,_=P.edges,C=L.mode,D=L.active,z=L.keepLastPath,K=L.theme,R=u(T.useState({x:0,y:0}),2),G=R[0],B=R[1],U=u(T.useState({x:0,y:0}),2),Y=U[0],V=U[1],et=W((function(e,r){r.stopPropagation(),"select"===C&&t(p("free"));var n=r.currentTarget,o=M(r),i=o.x,a=o.y;n.setPointerCapture(r.pointerId),B({x:i,y:a}),t(v(e)),!r.shiftKey&&O.length<=1&&t(g()),t(x(e))})),rt=W((function(r,n){var i=M(n),a=i.x,u=i.y;"free"===C&&D===r?(O.forEach((function(t){e.current.updateNodeAttributes(t,(function(t){return o(o({},t),{},{x:F(t.x-(G.x-a)*c/100,n.altKey?1:5),y:F(t.y-(G.y-u)*c/100,n.altKey?1:5)})}))})),t(m()),t(b())):C.startsWith("line")&&V({x:(G.x-a)*c/100,y:(G.y-u)*c/100})})),nt=W((function(n,o){if(C.startsWith("line")){z||t(p("free"));var u=[].concat(i(Object.values(w)),[k.Virtual]),c=e.current.hasNode(D)&&u.includes(e.current.getNodeAttribute(D,"type"));["stn_core_","virtual_circle_"].forEach((function(t){var n,i=null===(n=document.elementsFromPoint(o.clientX,o.clientY)[0].attributes)||void 0===n||null===(n=n.getNamedItem("id"))||void 0===n?void 0:n.value,u=null==i?void 0:i.startsWith(t);if(c&&u){var l,f=C.slice(5),y="line_".concat(E(10));e.current.addDirectedEdgeWithKey(y,D,i.slice(t.length),(a(l={visible:!0,zIndex:0,type:f},f,structuredClone(s[f].defaultAttrs)),a(l,"style",A.SingleColor),a(l,A.SingleColor,{color:K}),a(l,"reconcileId",""),l)),r&&j.event(S.ADD_LINE,{type:f})}})),t(b()),t(N(e.current.export()))}else if("free"===C)if(D){var l=M(o),f=l.x,y=l.y;G.x-f==0&&G.y-y==0?t(x(n)):t(N(e.current.export()))}else t(x(n));t(v(void 0))})),ot=W((function(e,r){t(g()),t(x(e))})),it=u(T.useState(n(e.current)),2),at=it[0],ut=it[1],ct=u(T.useState(H(e.current)),2),lt=ct[0],st=ct[1],ft=u(T.useState(q(e.current)),2),yt=ft[0],dt=ft[1],ht=u(T.useState([]),2),pt=ht[0],vt=ht[1],gt=u(T.useState([]),2),xt=gt[0],mt=gt[1];return T.useEffect((function(){ut(n(e.current)),st(H(e.current))}),[I]),T.useEffect((function(){dt(q(e.current));var t=function(t){var e=Q(t),r=[],n=[];return Object.values(e).forEach((function(e){if(1!==e.length){var o=t.getEdgeAttribute(e.at(0),"type");if(e.every((function(e){return t.getEdgeAttribute(e,"type")===o}))){var a=t.getEdgeAttribute(e.at(0),"style");if(e.every((function(e){return t.getEdgeAttribute(e,"style")===a}))){var c={},l=new Set,s=new Set,f=Object.fromEntries(e.map((function(e){var r,n,o=u(t.extremities(e),2),i=o[0],a=o[1];return c[i]=(null!==(r=c[i])&&void 0!==r?r:0)+1,c[a]=(null!==(n=c[a])&&void 0!==n?n:0)+1,l.add(i),s.add(a),[i,[e,a]]}))),y=Array.from(l).filter((function(t){return 1===c[t]})),d=Array.from(s).filter((function(t){return 1===c[t]}));if(1===y.length&&1===d.length){var h=y[0],p=d[0];if(h!==p){for(var v=[f[h][0]],g=f[h][1],x=1;x<e.length;x+=1){var m,b=null===(m=f[g])||void 0===m?void 0:m.at(1);if(!b)return void n.push.apply(n,i(e));v.push(f[g][0]),g=b}g===p&&v.length===e.length?r.push(v):n.push.apply(n,i(e))}else n.push.apply(n,i(e))}else n.push.apply(n,i(e))}else n.push.apply(n,i(e))}else n.push.apply(n,i(e))}else n.push.apply(n,i(e))})),{allReconciledLines:r,danglingLines:n}}(e.current),r=t.allReconciledLines,n=t.danglingLines;vt(r),mt(n)}),[_]),l.jsxs(l.Fragment,{children:[xt.map((function(t){var r=u(e.current.extremities(t),2),n=r[0],o=r[1],i=e.current.getNodeAttributes(n),a=e.current.getNodeAttributes(o);return l.jsx(tt,{id:t,x1:i.x,y1:i.y,x2:a.x,y2:a.y,newLine:!1,type:y.Simple,attrs:s[y.Simple].defaultAttrs,styleType:A.SingleColor,styleAttrs:{color:["","","#c0c0c0","#fff"]},handleClick:ot},t)})),pt.map((function(t){var r,n,o=function(t,e){if(e.every((function(e){return t.hasEdge(e)}))){for(var r=e.map((function(e){var r,n,o,i=u(t.extremities(e),2),a=i[0],c=i[1],l=t.getNodeAttributes(a),f=t.getNodeAttributes(c),y=t.getEdgeAttribute(e,"type"),d=null!==(r=t.getEdgeAttribute(e,y))&&void 0!==r?r:s[y].defaultAttrs;return null!==(n=null===(o=s[y])||void 0===o?void 0:o.generatePath(l.x,f.x,l.y,f.y,d))&&void 0!==n?n:"M ".concat(l.x,",").concat(l.y," L ").concat(f.x,",").concat(f.y)})),n="".concat(r[0]," "),o=1;o<e.length;o+=1)n+=r[o].replace(/M\s*-?\d+(\.\d+)?(\s*|,)-?\d+(\.*\d+)?\s*/i,"");return n}}(e.current,t);if(!o)return l.jsx(l.Fragment,{});var i=t.at(0),a=e.current.getEdgeAttribute(i,"type"),c=e.current.getEdgeAttribute(i,"style"),y=e.current.getEdgeAttribute(i,c),d=null!==(r=null===(n=f[c])||void 0===n?void 0:n.component)&&void 0!==r?r:$;return l.jsx(d,{id:i,type:a,path:o,styleAttrs:y,newLine:!1,handleClick:ot},i)})),yt.map((function(t){var e=t.edge,r=t.x1,n=t.y1,o=t.x2,i=t.y2,a=t.type,u=t.attr,c=t.style,s=t.styleAttr;return l.jsx(tt,{id:e,x1:r,y1:n,x2:o,y2:i,newLine:!1,type:a,attrs:u,styleType:c,styleAttrs:s,handleClick:ot},e)})),lt.map((function(t){var e,r,n=t.node,o=t.x,i=t.y,a=t.type,u=null!==(e=null===(r=J[a])||void 0===r?void 0:r.component)&&void 0!==e?e:X;return l.jsx(u,{id:n,x:o,y:i,attrs:t[a],handlePointerDown:et,handlePointerMove:rt,handlePointerUp:nt},n)})),at.map((function(t){var e,r,n=t.node,o=t.x,i=t.y,u=t.type,c=null!==(e=null===(r=Z[u])||void 0===r?void 0:r.component)&&void 0!==e?e:X;return l.jsx(c,{id:n,x:o,y:i,attrs:a({},u,t[u]),handlePointerDown:et,handlePointerMove:rt,handlePointerUp:nt},n)})),C.startsWith("line")&&D&&l.jsx(tt,{id:"create_in_progress___no_use",x1:e.current.getNodeAttribute(D,"x"),y1:e.current.getNodeAttribute(D,"y"),x2:e.current.getNodeAttribute(D,"x")-Y.x,y2:e.current.getNodeAttribute(D,"y")-Y.y,newLine:!0,type:C.slice(5),attrs:s[C.slice(5)].defaultAttrs,styleType:A.SingleColor,styleAttrs:{color:K}})]})};t("default",(function(){var t,n,o,c,s,f=d(),y=T.useRef(window.graph),x=function(){f(m()),f(b()),f(N(y.current.export()))},w=h((function(t){return t.app})).telemetry.project,k=h((function(t){return t.param})),A=k.svgViewBoxZoom,q=k.svgViewBoxMin,H=h((function(t){return t.runtime})),Q=H.mode,X=H.lastTool,$=H.active,tt=H.selected,rt=H.keepLastPath,nt=H.theme,ot=H.refresh.nodes,it=(o=u(D.useState({width:void 0,height:void 0}),2),c=o[0],s=o[1],D.useEffect((function(){function t(){s({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",t),t(),function(){return window.removeEventListener("resize",t)}}),[]),c),at=(null!==(t=it.height)&&void 0!==t?t:1280)-40,ut=(null!==(n=it.width)&&void 0!==n?n:720)-40;T.useEffect((function(){var t=U(y.current);Object.entries(t).filter((function(t){var e=u(t,2),r=e[0];return e[1]&&r in R})).map((function(t){var e=u(t,2),r=e[0];e[1];return r})).filter((function(t){return R[t]&&null===document.getElementById(R[t].cssName)})).map((function(t){return R[t].cssName})).filter((function(t,e,r){return e===r.findIndex((function(e){return e===t}))})).forEach((function(t){var e=document.createElement("link");e.rel="stylesheet",e.id=t,e.href="/rmp/"+"styles/".concat(t,".css"),document.head.append(e)}))}),[ot]);var ct=u(T.useState({x:0,y:0}),2),lt=ct[0],st=ct[1],ft=u(T.useState({x:0,y:0}),2),yt=ft[0],dt=ft[1],ht=u(T.useState({x:0,y:0}),2),pt=ht[0],vt=ht[1],gt=u(T.useState({x:0,y:0}),2),xt=gt[0],mt=gt[1],bt=W((function(t){var e=M(t),r=e.x,n=e.y;if(Q.startsWith("station")){f(p("free"));var o=E(10),i=Q.slice(8),u=structuredClone(Z[i].defaultAttrs);"color"in u&&(u.color=nt);var c=G(r,n,A,q),l=c.x,s=c.y;y.current.addNode("stn_".concat(o),a({visible:!0,zIndex:0,x:F(l,5),y:F(s,5),type:i},i,u)),x(),w&&j.event(S.ADD_STATION,{type:i})}else if(Q.startsWith("misc-node")){f(p("free"));var d=E(10),h=Q.slice(10),m=G(r,n,A,q),b=m.x,k=m.y;y.current.addNode("misc_node_".concat(d),a({visible:!0,zIndex:0,x:F(b,5),y:F(k,5),type:h},h,structuredClone(J[h].defaultAttrs))),x(),w&&j.event(S.ADD_STATION,{type:h})}else"free"===Q||Q.startsWith("line")?(Q.startsWith("line")&&(f(p("free")),rt&&f(L(!1))),vt({x:r,y:n}),mt(q),t.shiftKey||(f(v("background")),f(g()))):"select"===Q&&(st(G(r,n,A,q)),dt(G(r,n,A,q)))})),wt=W((function(t){if("select"===Q){if(0!=lt.x&&0!=lt.y){var e=M(t),r=e.x,n=e.y;dt(G(r,n,A,q))}}else if("background"===$){var o=M(t),i=o.x,a=o.y;f(O({x:xt.x+(pt.x-i)*A/100,y:xt.y+(pt.y-a)*A/100}))}})),kt=W((function(t){if("select"===Q){var e=M(t),r=e.x,n=e.y,o=G(r,n,A,q),a=o.x,u=o.y,c=Y(y.current,lt.x,lt.y,a,u);t.shiftKey?f(P(i(new Set([].concat(i(tt),i(c)))))):f(P(c)),f(p("free")),st({x:0,y:0}),dt({x:0,y:0})}"background"!==$||t.shiftKey||f(v(void 0))})),Et=W((function(t){var e=A;t.deltaY>0&&A+10<400?e=A+10:t.deltaY<0&&A-10>0&&(e=A-10),f(I(e));var r=M(t),n=r.x,o=r.y,i=t.currentTarget.getBoundingClientRect(),a=n/i.width,u=o/i.height;f(O({x:q.x+n*A/100-ut*e/100*a,y:q.y+o*A/100-at*e/100*u}))})),At=W(function(){var t,n=(t=e().mark((function t(r){var n,o,i,a,u,c,l,s,d,h,v,m,b;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(B?"Backspace"===r.key:"Delete"===r.key)){t.next=4;break}tt.length>0&&tt.filter((function(t){return y.current.hasNode(t)||y.current.hasEdge(t)})).forEach((function(t){f(g()),y.current.hasNode(t)?y.current.dropNode(t):y.current.dropEdge(t),x()})),t.next=51;break;case 4:if(!r.key.startsWith("Arrow")){t.next=11;break}n=r.key.endsWith("Left")?-1:r.key.endsWith("Right")?1:0,o=r.key.endsWith("Up")?-1:r.key.endsWith("Down")?1:0,f(O(G(100*n,100*o,A,q))),t.next=51;break;case 11:if("i"!==r.key&&"j"!==r.key&&"k"!==r.key&&"l"!==r.key){t.next=18;break}i=10*("j"===r.key?-1:"l"===r.key?1:0),a=10*("i"===r.key?-1:"k"===r.key?1:0),tt.length>0&&tt.filter((function(t){return y.current.hasNode(t)})).forEach((function(t){y.current.updateNodeAttribute(t,"x",(function(t){return(null!=t?t:0)+i})),y.current.updateNodeAttribute(t,"y",(function(t){return(null!=t?t:0)+a})),x()})),t.next=51;break;case 18:if("f"!==r.key||!X){t.next=22;break}f(p(X)),t.next=51;break;case 22:if("z"!==r.key||!(B?r.metaKey&&!r.shiftKey:r.ctrlKey)){t.next=27;break}B&&r.preventDefault(),f(_()),t.next=51;break;case 27:if("s"!==r.key){t.next=31;break}f(p("select")),t.next=51;break;case 31:if("c"!==r.key&&"x"!==r.key||!(B?r.metaKey&&!r.shiftKey:r.ctrlKey)){t.next=39;break}u=new Set(tt),c=V(y.current,u),l=z(y.current,u,new Set(c)),navigator.clipboard.writeText(l),"x"===r.key&&(f(g()),tt.forEach((function(t){y.current.hasNode(t)?y.current.dropNode(t):y.current.hasEdge(t)&&y.current.dropEdge(t)})),x()),t.next=51;break;case 39:if("v"!==r.key||!(B?r.metaKey&&!r.shiftKey:r.ctrlKey)){t.next=50;break}return t.next=42,navigator.clipboard.readText();case 42:s=t.sent,d=G(ut/2,at/2,A,q),h=d.x,v=d.y,m=K(s,y.current,F(h,5),F(v,5)),b=m.nodes,x(),f(g()),f(P(b)),t.next=51;break;case 50:(B&&"z"===r.key&&r.metaKey&&r.shiftKey||!B&&"y"===r.key&&r.ctrlKey)&&f(C());case 51:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function u(t){r(a,o,i,u,c,"next",t)}function c(t){r(a,o,i,u,c,"throw",t)}u(void 0)}))});return function(t){return n.apply(this,arguments)}}()),jt=u(T.useState({sx:0,sy:0,ex:0,ey:0}),2),St=jt[0],Nt=jt[1];return T.useEffect((function(){Nt({sx:lt.x<=yt.x?lt.x:yt.x,ex:lt.x>yt.x?lt.x:yt.x,sy:lt.y<=yt.y?lt.y:yt.y,ey:lt.y>yt.y?lt.y:yt.y})}),[yt.x,yt.y]),l.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"canvas",style:{position:"fixed",top:40,left:40,userSelect:"none"},height:at,width:ut,viewBox:"".concat(q.x," ").concat(q.y," ").concat(ut*A/100," ").concat(at*A/100),onPointerDown:bt,onPointerMove:wt,onPointerUp:kt,onWheel:Et,tabIndex:0,onKeyDown:At,children:[l.jsx(et,{}),"select"===Q&&0!=lt.x&&0!=lt.y&&l.jsx("rect",{x:St.sx,y:St.sy,width:St.ex-St.sx,height:St.ey-St.sy,rx:"2",stroke:"#b5b5b6",strokeWidth:"2",strokeOpacity:"0.4",fill:"#b5b5b6",opacity:"0.75"})]})}))}}}))}();
